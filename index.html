<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HoReCaMGR — ПБО 23702</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Verdana,Geneva,sans-serif;font-size:11px;background:#c0c0c0;color:#000;height:100vh;overflow:hidden;user-select:none;}
a{color:inherit;text-decoration:none;}

/* ===== PIN OVERLAY ===== */
#pinOverlay{position:fixed;inset:0;background:#808080;display:flex;align-items:center;justify-content:center;z-index:9999;}
.pinBox{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;width:330px;}
.titleBar{background:#000080;color:#fff;font-size:11px;font-weight:bold;padding:3px 6px;display:flex;justify-content:space-between;align-items:center;}
.titleBar span{font-size:10px;font-weight:normal;}
.pinBody{padding:12px;}
.pinLogoRow{display:flex;align-items:center;gap:8px;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid #808080;}
.pinLogoRow img{width:48px;height:48px;object-fit:contain;}
.pinLogoText{font-size:10px;color:#333;line-height:1.4;}
.pinLogoText strong{font-size:11px;display:block;}
.idRow{display:flex;gap:6px;align-items:center;margin-bottom:6px;}
.idRow label{white-space:nowrap;font-size:11px;min-width:90px;}
.pinIDField{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;height:22px;font-family:Verdana,sans-serif;font-size:11px;padding:2px 4px;outline:none;width:140px;}
.pinLabel{font-size:11px;margin-bottom:3px;font-weight:bold;}
.pinSubLabel{font-size:10px;color:#555;margin-bottom:8px;}
.pinField{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;width:100%;height:28px;font-family:'Courier New',monospace;font-size:16px;letter-spacing:6px;text-align:center;padding:2px 6px;margin-bottom:8px;outline:none;}
.pinGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:3px;margin-bottom:6px;}
.pinBtn{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;height:34px;font-family:Verdana,sans-serif;font-size:13px;font-weight:bold;cursor:pointer;}
.pinBtn:active{border-color:#808080 #fff #fff #808080;}
.pinBtnRow{display:flex;gap:3px;margin-bottom:4px;}
.pinBtnRow .pinBtn{flex:1;}
.pinError{color:red;font-size:10px;min-height:14px;margin-bottom:4px;text-align:center;}
.pinSep{border:none;border-top:1px solid #808080;border-bottom:1px solid #fff;margin:8px 0;}

/* ===== MAIN APP ===== */
#app{display:none;height:100vh;flex-direction:column;}

/* TITLE BAR */
.appTitleBar{background:#000080;color:#fff;padding:2px 4px;display:flex;align-items:center;gap:6px;font-size:11px;font-weight:bold;flex-shrink:0;}
.appTitleBar img{width:20px;height:20px;object-fit:contain;}

/* STATUS TOP */
.statusTop{background:#d4d0c8;border-bottom:1px solid #808080;padding:2px 6px;display:flex;gap:12px;font-size:10px;align-items:center;flex-shrink:0;}
.badge{background:#000080;color:#fff;padding:1px 5px;font-size:10px;}
.badgeRed{background:#a00000;color:#fff;padding:1px 5px;font-size:10px;}

/* MENU BAR (bottom) */
.menuBar{background:#d4d0c8;border-top:1px solid #808080;border-bottom:1px solid #808080;display:flex;align-items:stretch;padding:1px 2px;gap:1px;flex-shrink:0;}
.menuItem{padding:2px 8px;cursor:pointer;font-size:11px;position:relative;}
.menuItem:hover,.menuItem.mopen{background:#000080;color:#fff;}
.dropdown{display:none;position:absolute;bottom:100%;left:0;background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;z-index:200;min-width:190px;box-shadow:2px 2px 6px rgba(0,0,0,0.5);}
.menuItem.mopen .dropdown{display:block;}
.dropItem{padding:3px 16px;cursor:pointer;font-size:11px;white-space:nowrap;}
.dropItem:hover{background:#000080;color:#fff;}
.dropSep{border-top:1px solid #808080;border-bottom:1px solid #fff;margin:2px 0;}
.dropGray{color:#808080;padding:3px 16px;font-size:11px;}

/* TOOLBAR */
.toolbar{background:#d4d0c8;border-bottom:1px solid #808080;padding:2px 4px;display:flex;gap:2px;align-items:center;flex-shrink:0;flex-wrap:wrap;}
.toolBtn{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;padding:2px 7px;font-family:Verdana,sans-serif;font-size:10px;cursor:pointer;height:22px;white-space:nowrap;}
.toolBtn:active,.toolBtn.tbActive{border-color:#808080 #fff #fff #808080;background:#b8b4ac;}
.toolSep{width:1px;height:18px;background:#808080;margin:0 3px;flex-shrink:0;}
.toolBtnEmg{background:#c00000;color:#fff;border:2px solid;border-color:#ff8080 #600000 #600000 #ff8080;padding:2px 7px;font-family:Verdana,sans-serif;font-size:10px;cursor:pointer;height:22px;font-weight:bold;}
.toolBtnEmg:active{border-color:#600000 #ff8080 #ff8080 #600000;}

/* MAIN AREA */
.mainArea{display:flex;flex:1;overflow:hidden;background:#808080;gap:2px;padding:2px;}

/* LEFT NAV */
.leftNav{width:155px;background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;overflow-y:auto;flex-shrink:0;}
.navGroup{border-bottom:1px solid #808080;}
.navGroupTitle{background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:3px 6px;}
.navItem{padding:3px 8px;font-size:10px;cursor:pointer;border-bottom:1px solid #c8c4bc;}
.navItem:hover{background:#000080;color:#fff;}
.navItem.active{background:#000080;color:#fff;font-weight:bold;}

/* CONTENT */
.rightPanel{flex:1;display:flex;flex-direction:column;gap:2px;overflow:hidden;min-width:0;}
.contentPanel{flex:1;background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;display:flex;flex-direction:column;overflow:hidden;}
.panelTitle{background:#000080;color:#fff;font-size:11px;font-weight:bold;padding:3px 8px;border-bottom:1px solid #000040;display:flex;justify-content:space-between;align-items:center;flex-shrink:0;}
.panelTitle span{font-size:10px;font-weight:normal;}
.panelBody{flex:1;overflow:auto;padding:6px;}

/* SECTIONS */
.section{display:none;height:100%;flex-direction:column;}
.section.active{display:flex;}

/* TABLES */
.dataTable{width:100%;border-collapse:collapse;font-size:10px;}
.dataTable th{background:#000080;color:#fff;padding:3px 5px;text-align:left;font-weight:bold;white-space:nowrap;border-right:1px solid #000040;}
.dataTable td{padding:2px 5px;border-bottom:1px solid #c8c4bc;white-space:nowrap;}
.dataTable tr:nth-child(even) td{background:#eae6de;}
.dataTable tr:hover td{background:#b8d4f0;cursor:default;}
.dataTable tr.selRow td{background:#000080;color:#fff;}
.num{text-align:right;}
.red{color:#c00000;font-weight:bold;}
.green{color:#007000;}
.orange{color:#b05000;}
.bold{font-weight:bold;}

/* BOTTOM ROW */
.bottomRow{display:flex;gap:2px;height:115px;flex-shrink:0;}
.infoPanel{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;flex:1;display:flex;flex-direction:column;overflow:hidden;}
.infoPanel .panelTitle{font-size:10px;padding:2px 5px;}
.infoBody{padding:3px 5px;font-size:10px;overflow:auto;}
.infoRow{display:flex;justify-content:space-between;padding:1px 0;border-bottom:1px dotted #c0c0c0;}
.infoRow .val{font-weight:bold;}

/* STATUS BAR */
.statusBar{background:#d4d0c8;border-top:1px solid #808080;padding:2px 6px;display:flex;gap:10px;font-size:10px;flex-shrink:0;}
.statusBar .cell{border:1px solid;border-color:#808080 #fff #fff #808080;padding:1px 5px;}

/* HELP BAR */
.helpBar{background:#d4d0c8;border-top:1px solid #808080;padding:1px 6px;font-size:10px;color:#333;flex-shrink:0;}

/* TABS */
.tabRow{display:flex;border-bottom:2px solid #808080;padding:4px 4px 0;flex-shrink:0;flex-wrap:wrap;}
.tab{padding:3px 9px;border:2px solid;border-bottom:none;border-color:#fff #808080 transparent #fff;background:#b8b4ac;cursor:pointer;font-size:10px;margin-right:2px;margin-bottom:-2px;}
.tab.active{background:#d4d0c8;font-weight:bold;border-bottom:2px solid #d4d0c8;}
.tabContent{display:none;overflow:auto;padding:5px;}
.tabContent.active{display:block;}
.tabContentFull{display:none;overflow:auto;padding:5px;flex:1;}
.tabContentFull.active{display:flex;flex-direction:column;}

/* FORMS */
.formRow{display:flex;gap:6px;align-items:center;margin-bottom:5px;}
.formRow label{min-width:105px;font-size:10px;text-align:right;}
.formInput{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;height:20px;font-family:Verdana,sans-serif;font-size:10px;padding:1px 4px;outline:none;}
.formSelect{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;height:20px;font-family:Verdana,sans-serif;font-size:10px;padding:1px 2px;outline:none;}
.formTextarea{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;font-family:Verdana,sans-serif;font-size:10px;padding:3px 4px;outline:none;resize:vertical;}

/* KPI */
.kpiGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:7px;}
.kpiCard{background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;padding:4px 6px;}
.kpiLabel{font-size:9px;color:#555;}
.kpiVal{font-size:13px;font-weight:bold;font-family:'Courier New',monospace;}
.kpiSub{font-size:9px;color:#666;}
.kpiCard.kalert .kpiVal{color:#c00000;}
.kpiCard.kok .kpiVal{color:#007000;}
.kpiCard.kwarn .kpiVal{color:#b05000;}

/* PROGRESS */
.progress{height:11px;background:#fff;border:1px solid #808080;overflow:hidden;}
.progressFill{height:100%;background:#000080;}
.progressFill.pred{background:#c00000;}
.progressFill.porange{background:#b05000;}
.progressFill.pgreen{background:#007000;}

/* POS GRID */
.posGrid{display:grid;grid-template-columns:repeat(5,1fr);gap:3px;padding:4px;}
.posTerminal{border:2px solid;border-color:#fff #808080 #808080 #fff;background:#d4d0c8;padding:5px 3px;text-align:center;font-size:9px;cursor:pointer;}
.posTerminal:hover{background:#b8d4f0;}
.posTerminal.selPOS{background:#b8d4f0;border-color:#808080 #fff #fff #808080;}
.posTerminal.posOff{background:#f0d0d0;}
.posNum{font-weight:bold;font-size:11px;}
.posDot{width:8px;height:8px;border-radius:50%;margin:2px auto;}
.pdOnline{background:#00a000;}
.pdOffline{background:#c00000;}
.pdIdle{background:#b05000;}

/* EMERGENCY */
.emgPanel{background:#fff0f0;border:2px solid #c00000;padding:6px;margin-bottom:6px;}
.emgTitle{color:#c00000;font-weight:bold;font-size:11px;margin-bottom:6px;border-bottom:1px solid #c00000;padding-bottom:3px;}
.emgList{font-size:10px;}
.emgItem{display:flex;gap:6px;padding:2px 0;border-bottom:1px dotted #e0a0a0;align-items:center;}
.emgItem .et{color:#c00000;font-weight:bold;min-width:40px;}
.emgItem .ec{flex:1;}
.emgItem .es{padding:1px 4px;font-size:9px;font-weight:bold;}
.esOpen{background:#c00000;color:#fff;}
.esClosed{background:#007000;color:#fff;}

/* DIALOG */
.dlg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);z-index:1000;align-items:center;justify-content:center;}
.dlg.dlgOpen{display:flex;}
.dlgBox{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;min-width:300px;max-width:500px;max-height:90vh;display:flex;flex-direction:column;}
.dlgBody{padding:12px;font-size:11px;overflow:auto;flex:1;}
.dlgBtns{padding:6px 12px;display:flex;justify-content:flex-end;gap:5px;border-top:1px solid #808080;flex-shrink:0;}
.dlgBtn{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;padding:3px 14px;font-family:Verdana,sans-serif;font-size:11px;cursor:pointer;min-width:65px;}
.dlgBtn:active{border-color:#808080 #fff #fff #808080;}
.dlgBtnRed{background:#c00000;color:#fff;border-color:#ff6060 #600000 #600000 #ff6060;}

/* REPORT */
.reportHeader{background:#e8e4d8;border:1px solid #808080;padding:4px 8px;margin-bottom:5px;font-size:10px;}
.reportHeader table{width:100%;}
.reportHeader td{padding:1px 4px;}

/* SCROLLBAR */
::-webkit-scrollbar{width:16px;height:16px;}
::-webkit-scrollbar-track{background:#d4d0c8;}
::-webkit-scrollbar-thumb{background:#d4d0c8;border:2px solid;border-color:#fff #808080 #808080 #fff;}

/* MENU SETTINGS TABLE */
.menuItemRow td{padding:2px 5px;border-bottom:1px solid #c8c4bc;}
.menuItemRow:hover td{background:#eef0fa;}
.menuItemRow input[type=text]{width:80px;}
.menuItemRow input[type=checkbox]{width:14px;height:14px;}

/* NOTIFICATION BADGE */
.notifBadge{background:#c00000;color:#fff;border-radius:50%;width:14px;height:14px;font-size:8px;display:inline-flex;align-items:center;justify-content:center;font-weight:bold;margin-left:3px;}
</style>
</head>
<body>

<!-- ===== PIN OVERLAY ===== -->
<div id="pinOverlay">
  <div class="pinBox">
    <div class="titleBar">
      <span>АВТОРИЗАЦИЯ — ПБО 23702 HoReCaMGR</span>
      <span>v5.2.1</span>
    </div>
    <div class="pinBody">
      <div class="pinLogoRow">
        <img id="pinLogo" src="01.png" alt="" onerror="this.style.display='none'">
        <div class="pinLogoText">
          <strong>HoReCaMGR</strong>
          Корпоративная система управления рестораном<br>
          Подразделение ПБО 23702 | Сервер: RU-MSK-POS-07
        </div>
      </div>
      <div class="idRow">
        <label>ID менеджера:</label>
        <input type="text" class="pinIDField" id="managerID" maxlength="8" placeholder="000000">
      </div>
      <hr class="pinSep">
      <div class="pinLabel">PIN-код (4 цифры):</div>
      <div class="pinSubLabel">Используйте клавиатуру или нажимайте кнопки ниже</div>
      <input type="password" class="pinField" id="pinInput" maxlength="4" readonly>
      <div class="pinError" id="pinError"></div>
      <div class="pinGrid">
        <button class="pinBtn" onclick="pinPress('1')">1</button>
        <button class="pinBtn" onclick="pinPress('2')">2</button>
        <button class="pinBtn" onclick="pinPress('3')">3</button>
        <button class="pinBtn" onclick="pinPress('4')">4</button>
        <button class="pinBtn" onclick="pinPress('5')">5</button>
        <button class="pinBtn" onclick="pinPress('6')">6</button>
        <button class="pinBtn" onclick="pinPress('7')">7</button>
        <button class="pinBtn" onclick="pinPress('8')">8</button>
        <button class="pinBtn" onclick="pinPress('9')">9</button>
        <button class="pinBtn" onclick="pinClear()" style="font-size:9px;">СБРОС</button>
        <button class="pinBtn" onclick="pinPress('0')">0</button>
        <button class="pinBtn" onclick="pinBackspace()" style="font-size:11px;">&lt;--</button>
      </div>
      <div class="pinBtnRow">
        <button class="pinBtn" onclick="pinConfirm()" style="background:#000080;color:#fff;font-size:11px;">ВОЙТИ</button>
        <button class="pinBtn" onclick="pinCancel()">ОТМЕНА</button>
      </div>
      <hr class="pinSep">
      <div style="font-size:9px;color:#666;text-align:center;">Список менеджеров: Смирнова (001042/1042), Плехов (002077/7722), Петров (001055/5566)</div>
    </div>
  </div>
</div>

<!-- ===== MAIN APP ===== -->
<div id="app">

  <!-- TITLE BAR -->
  <div class="appTitleBar">
    <img src="01.png" alt="" onerror="this.style.display='none'" id="appLogo">
    NP 6.1 (WayStation active)@23702 &nbsp;|&nbsp;
    <span id="managerDisplay" style="font-weight:normal;font-size:10px;">—</span>
    <div style="flex:1;"></div>
    <span id="clockDisplay" style="font-family:'Courier New',monospace;font-size:11px;"></span>
  </div>

  <!-- STATUS TOP -->
  <div class="statusTop">
    <span>Менеджер: <strong id="mgrName">—</strong></span>
    <span class="badge" id="accessBadge">МГР</span>
    <span>Смена: <strong>#0847</strong></span>
    <span>Начало: <strong>08:00</strong></span>
    <span style="flex:1;"></span>
    <span>POS: <span style="color:green;font-weight:bold;">8/10</span></span>
    <span>Касса: <span style="color:#b05000;font-weight:bold;" id="cashDisplay">47 820 &#8381;</span></span>
    <span>Сервер: <span style="color:green;font-weight:bold;">ONLINE</span></span>
    <span>ФМ: <span style="color:green;font-weight:bold;">ОК</span></span>
    <span id="emergBadge" style="display:none;"><span class="badgeRed">!! ЭКСТР. СИТУАЦИЯ</span></span>
  </div>

  <!-- TOOLBAR -->
  <div class="toolbar">
    <button class="toolBtn" onclick="nav('dashboard')">Главная</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('pos')">Терминалы POS</button>
    <button class="toolBtn" onclick="nav('pos-settings')">Настройка POS</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('sales')">Продажи / Чеки</button>
    <button class="toolBtn" onclick="nav('cash')">Касса</button>
    <button class="toolBtn" onclick="nav('expenses')">Расходы</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('inventory')">Склад</button>
    <button class="toolBtn" onclick="nav('orders')">Заявки</button>
    <button class="toolBtn" onclick="nav('menu-settings')">Настройка меню</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('staff')">Персонал</button>
    <button class="toolBtn" onclick="nav('shift')">Смена</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('accounting')">Бухгалтерия</button>
    <button class="toolBtn" onclick="nav('reports')">Отчёты</button>
    <button class="toolBtn" onclick="nav('documents')">Документы</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="nav('settings')">Настройки</button>
    <div class="toolSep"></div>
    <button class="toolBtnEmg" onclick="nav('emergency')">ЭКСТРЕННЫЕ СИТУАЦИИ</button>
    <div class="toolSep"></div>
    <button class="toolBtn" onclick="logout()">Выход</button>
  </div>

  <!-- MAIN AREA -->
  <div class="mainArea">

    <!-- LEFT NAV -->
    <div class="leftNav">
      <div class="navGroup">
        <div class="navGroupTitle">ОБЗОР</div>
        <div class="navItem active" id="nav-dashboard" onclick="nav('dashboard')">Главная панель</div>
        <div class="navItem" id="nav-pos" onclick="nav('pos')">Статус POS</div>
        <div class="navItem" id="nav-pos-settings" onclick="nav('pos-settings')">Настройка POS</div>
        <div class="navItem" id="nav-shift" onclick="nav('shift')">Текущая смена</div>
      </div>
      <div class="navGroup">
        <div class="navGroupTitle">ПРОДАЖИ</div>
        <div class="navItem" id="nav-sales" onclick="nav('sales')">Продажи / Чеки</div>
        <div class="navItem" id="nav-menu-settings" onclick="nav('menu-settings')">Настройка меню</div>
        <div class="navItem" id="nav-cash" onclick="nav('cash')">Касса / ДС</div>
        <div class="navItem" id="nav-expenses" onclick="nav('expenses')">Учёт расходов</div>
      </div>
      <div class="navGroup">
        <div class="navGroupTitle">СКЛАД</div>
        <div class="navItem" id="nav-inventory" onclick="nav('inventory')">Инвентаризация</div>
        <div class="navItem" id="nav-orders" onclick="nav('orders')">Заявки / Поставки</div>
      </div>
      <div class="navGroup">
        <div class="navGroupTitle">ПЕРСОНАЛ</div>
        <div class="navItem" id="nav-staff" onclick="nav('staff')">Сотрудники</div>
      </div>
      <div class="navGroup">
        <div class="navGroupTitle">ФИНАНСЫ</div>
        <div class="navItem" id="nav-accounting" onclick="nav('accounting')">Бухгалтерия</div>
        <div class="navItem" id="nav-reports" onclick="nav('reports')">Отчёты</div>
        <div class="navItem" id="nav-documents" onclick="nav('documents')">Документы</div>
      </div>
      <div class="navGroup">
        <div class="navGroupTitle">СИСТЕМА</div>
        <div class="navItem" id="nav-emergency" onclick="nav('emergency')" style="color:#c00000;font-weight:bold;">!! Экстренные ситуации</div>
        <div class="navItem" id="nav-settings" onclick="nav('settings')">Настройки</div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="rightPanel">
      <div style="flex:1;overflow:hidden;position:relative;">

        <!-- ===== DASHBOARD ===== -->
        <div id="sec-dashboard" class="contentPanel section active">
          <div class="panelTitle">Главная панель управления — ПБО 23702 <span>Смена #0847 | 27.02.2026</span></div>
          <div class="panelBody">
            <div class="kpiGrid">
              <div class="kpiCard kok"><div class="kpiLabel">ВЫРУЧКА СМЕНА</div><div class="kpiVal" id="kpiRevenue">183 420 &#8381;</div><div class="kpiSub">+4.2% к норме</div></div>
              <div class="kpiCard"><div class="kpiLabel">СРЕДНИЙ ЧЕК</div><div class="kpiVal">428 &#8381;</div><div class="kpiSub">Чеков: <span id="kpiChecks">429</span></div></div>
              <div class="kpiCard kwarn"><div class="kpiLabel">НАЛИЧНЫЕ В КАССЕ</div><div class="kpiVal" id="kpiCash">47 820 &#8381;</div><div class="kpiSub">Лимит: 50 000 &#8381;</div></div>
              <div class="kpiCard"><div class="kpiLabel">БЕЗНАЛ / КАРТЫ</div><div class="kpiVal">135 600 &#8381;</div><div class="kpiSub">73.9%</div></div>
              <div class="kpiCard"><div class="kpiLabel">СОТРУДНИКОВ</div><div class="kpiVal">14 / 16</div><div class="kpiSub">-2 от нормы</div></div>
              <div class="kpiCard kok"><div class="kpiLabel">POS АКТИВНЫХ</div><div class="kpiVal">8 / 10</div><div class="kpiSub">POS-04, POS-09 offline</div></div>
              <div class="kpiCard kok"><div class="kpiLabel">ВРЕМЯ ОБСЛУЖ.</div><div class="kpiVal">2:34</div><div class="kpiSub">Норма &le;3:00</div></div>
              <div class="kpiCard kalert"><div class="kpiLabel">НАРУШЕНИЙ</div><div class="kpiVal" id="kpiIncidents">2</div><div class="kpiSub">Требует внимания</div></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;margin-bottom:6px;">
              <div>
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:3px;">ПЛАН / ФАКТ ЗА СМЕНУ (по часам)</div>
                <table class="dataTable">
                  <tr><th>Час</th><th class="num">План &#8381;</th><th class="num">Факт &#8381;</th><th class="num">%</th></tr>
                  <tr><td>08–09</td><td class="num">12 000</td><td class="num">11 840</td><td class="num green">98.7</td></tr>
                  <tr><td>09–10</td><td class="num">14 000</td><td class="num">15 320</td><td class="num green">109.4</td></tr>
                  <tr><td>10–11</td><td class="num">18 000</td><td class="num">19 100</td><td class="num green">106.1</td></tr>
                  <tr><td>11–12</td><td class="num">22 000</td><td class="num">23 450</td><td class="num green">106.6</td></tr>
                  <tr><td>12–13</td><td class="num">28 000</td><td class="num">29 870</td><td class="num green">106.7</td></tr>
                  <tr><td>13–14</td><td class="num">26 000</td><td class="num">24 610</td><td class="num red">94.7</td></tr>
                  <tr><td>14–15</td><td class="num">22 000</td><td class="num">23 100</td><td class="num green">105.0</td></tr>
                  <tr><td>15–16</td><td class="num">16 000</td><td class="num">16 130</td><td class="num green">100.8</td></tr>
                  <tr><td><strong>ИТОГО</strong></td><td class="num"><strong>158 000</strong></td><td class="num"><strong>163 420</strong></td><td class="num green bold">103.4</td></tr>
                </table>
              </div>
              <div>
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:3px;">АЛЕРТЫ И ЗАДАЧИ</div>
                <table class="dataTable">
                  <tr><th>Время</th><th>Тип</th><th>Описание</th><th>Ст.</th></tr>
                  <tr id="alertRow1"><td>15:42</td><td class="orange">СКЛАД</td><td>Булочки б/г &lt;30 шт</td><td class="red">!</td></tr>
                  <tr><td>15:18</td><td class="red">ТЕМП</td><td>Витрина #2: +6.8°C</td><td class="red">!!</td></tr>
                  <tr><td>14:55</td><td class="orange">POS</td><td>POS-04 не отвечает</td><td class="red">!</td></tr>
                  <tr><td>14:30</td><td>ПЕРСОНАЛ</td><td>Николаева — опоздание 12 мин</td><td class="orange">!</td></tr>
                  <tr><td>13:10</td><td>КАССА</td><td>Рекомендовано изъятие</td><td class="orange">^</td></tr>
                  <tr><td>12:48</td><td class="red">БЕЗОП</td><td>Нарушение санитарии</td><td class="red">!</td></tr>
                  <tr><td>11:30</td><td>СКЛАД</td><td>Получена накладная #П-4471</td><td class="green">OK</td></tr>
                </table>
                <div style="margin-top:5px;display:flex;gap:4px;">
                  <button class="toolBtn" onclick="nav('emergency')">Внести экстренную ситуацию</button>
                  <button class="toolBtn" onclick="nav('shift')">Журнал смены</button>
                </div>
              </div>
            </div>
            <div style="display:flex;gap:5px;">
              <div style="flex:1;">
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:3px;">ТОП ПРОДАЖ</div>
                <table class="dataTable">
                  <tr><th>Код</th><th>Позиция</th><th class="num">Кол-во</th><th class="num">Сумма &#8381;</th><th>Остаток</th></tr>
                  <tr><td>1042</td><td>Биг Бургер (аналог)</td><td class="num">187</td><td class="num">48 620</td><td class="green">OK</td></tr>
                  <tr><td>1018</td><td>Картофель фри (ср.)</td><td class="num">312</td><td class="num">28 080</td><td class="green">OK</td></tr>
                  <tr><td>1055</td><td>Чизбургер</td><td class="num">243</td><td class="num">24 300</td><td class="green">OK</td></tr>
                  <tr><td>2001</td><td>Coca-Cola 0.5л</td><td class="num">198</td><td class="num">19 800</td><td class="orange">Мало</td></tr>
                  <tr><td>1089</td><td>МакФлури (ваниль)</td><td class="num">94</td><td class="num">11 280</td><td class="red">Критично</td></tr>
                </table>
              </div>
              <div style="flex:1;">
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:3px;">БЫСТРЫЕ ДЕЙСТВИЯ</div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:3px;">
                  <button class="toolBtn" style="height:30px;" onclick="openCashModal('out')">Изъятие наличных</button>
                  <button class="toolBtn" style="height:30px;" onclick="openCashModal('in')">Внесение наличных</button>
                  <button class="toolBtn" style="height:30px;" onclick="nav('inventory')">Остатки склада</button>
                  <button class="toolBtn" style="height:30px;" onclick="nav('pos')">Статус терминалов</button>
                  <button class="toolBtn" style="height:30px;" onclick="nav('staff')">Персонал смены</button>
                  <button class="toolBtn" style="height:30px;" onclick="printZReport()">Z-отчёт</button>
                  <button class="toolBtn" style="height:30px;" onclick="nav('shift')">Передать смену</button>
                  <button class="toolBtnEmg" style="height:30px;" onclick="nav('emergency')">ЭКСТРЕННАЯ</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== POS TERMINALS ===== -->
        <div id="sec-pos" class="contentPanel section">
          <div class="panelTitle">Терминалы POS — управление <span>Активно: 8/10</span></div>
          <div class="panelBody">
            <div style="display:flex;gap:3px;margin-bottom:6px;flex-wrap:wrap;">
              <button class="toolBtn" onclick="posAction('restart')">Перезагрузить выбр.</button>
              <button class="toolBtn" onclick="posAction('block')">Заблокировать</button>
              <button class="toolBtn" onclick="posAction('unblock')">Разблокировать</button>
              <button class="toolBtn" onclick="posAction('cashout')">Изъятие с терм.</button>
              <button class="toolBtn" onclick="posAction('print')">Печать X-отчёта</button>
              <button class="toolBtn" onclick="posAction('update')">Обновить ПО</button>
              <button class="toolBtn" onclick="posAction('test')">Тест ФР</button>
              <button class="toolBtn" onclick="nav('pos-settings')">Настройка терм.</button>
            </div>
            <div class="posGrid" id="posGrid">
              <!-- Built by JS -->
            </div>
            <div style="margin-top:5px;font-size:10px;font-weight:bold;padding:2px 5px;background:#000080;color:#fff;margin-bottom:3px;">ЖУРНАЛ ОПЕРАЦИЙ (последние)</div>
            <table class="dataTable" id="posLogTable">
              <tr><th>Время</th><th>Терминал</th><th>Оператор</th><th>Тип</th><th class="num">Сумма &#8381;</th><th>Статус</th></tr>
              <tr><td>16:03</td><td>POS-03</td><td>Иванова А.</td><td>Продажа</td><td class="num">512</td><td class="green">OK</td></tr>
              <tr><td>16:02</td><td>POS-01</td><td>Петров С.</td><td>Продажа</td><td class="num">380</td><td class="green">OK</td></tr>
              <tr><td>16:00</td><td>POS-02</td><td>Сидорова М.</td><td>Возврат</td><td class="num red">-250</td><td class="orange">ВОЗВРАТ</td></tr>
              <tr><td>15:59</td><td>POS-04</td><td>—</td><td>Ошибка ФР</td><td class="num">—</td><td class="red">ОШИБКА</td></tr>
              <tr><td>15:57</td><td>POS-01</td><td>Петров С.</td><td>Изъятие НЛ</td><td class="num">15 000</td><td class="green">ИЗЪ</td></tr>
            </table>
          </div>
        </div>

        <!-- ===== POS SETTINGS ===== -->
        <div id="sec-pos-settings" class="contentPanel section">
          <div class="panelTitle">Настройка POS-терминалов <span>Администрирование</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'pset1')">Параметры терминалов</div>
              <div class="tab" onclick="swTab(this,'pset2')">Права операторов</div>
              <div class="tab" onclick="swTab(this,'pset3')">Фискальный регистратор</div>
              <div class="tab" onclick="swTab(this,'pset4')">Сетевые настройки</div>
            </div>
            <div id="pset1" class="tabContent active">
              <table class="dataTable">
                <tr><th>Терминал</th><th>Режим</th><th>Зона</th><th>Лимит кассы &#8381;</th><th>Звук</th><th>Дисплей покуп.</th><th>Действия</th></tr>
                <tr><td>POS-01</td><td><select class="formSelect"><option>Стандарт</option><option>Только карта</option><option>Только нал.</option></select></td><td><select class="formSelect"><option>Касса 1</option><option>Drive-thru</option><option>Зал</option></select></td><td><input class="formInput" type="text" value="15000" style="width:60px;"></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><button class="toolBtn" onclick="showMsg('Настройки POS-01 сохранены')">Сохранить</button></td></tr>
                <tr><td>POS-02</td><td><select class="formSelect"><option>Стандарт</option></select></td><td><select class="formSelect"><option>Касса 2</option></select></td><td><input class="formInput" type="text" value="15000" style="width:60px;"></td><td><input type="checkbox" checked></td><td><input type="checkbox"></td><td><button class="toolBtn" onclick="showMsg('Настройки POS-02 сохранены')">Сохранить</button></td></tr>
                <tr><td>POS-03</td><td><select class="formSelect"><option selected>Drive-thru</option></select></td><td><select class="formSelect"><option>Drive-thru</option></select></td><td><input class="formInput" type="text" value="20000" style="width:60px;"></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><button class="toolBtn" onclick="showMsg('Настройки POS-03 сохранены')">Сохранить</button></td></tr>
                <tr><td>POS-04</td><td><select class="formSelect"><option>Стандарт</option></select></td><td><select class="formSelect"><option>Касса 4</option></select></td><td><input class="formInput" type="text" value="15000" style="width:60px;"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><button class="toolBtn" onclick="showMsg('POS-04 OFFLINE — сохранение недоступно')">Сохранить</button></td></tr>
              </table>
              <div style="margin-top:8px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Настройки всех терминалов применены')">Применить всё</button>
                <button class="toolBtn" onclick="showMsg('Настройки по умолчанию восстановлены')">Сбросить к умолч.</button>
              </div>
            </div>
            <div id="pset2" class="tabContent">
              <table class="dataTable">
                <tr><th>Роль</th><th>Продажа</th><th>Возврат</th><th>Скидка</th><th>Изъятие</th><th>Внесение</th><th>X-отчёт</th><th>Z-отчёт</th></tr>
                <tr><td><strong>Менеджер</strong></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
                <tr><td><strong>Кассир</strong></td><td><input type="checkbox" checked></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox" checked></td><td><input type="checkbox"></td></tr>
                <tr><td><strong>Стажёр</strong></td><td><input type="checkbox" checked></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td><td><input type="checkbox"></td></tr>
              </table>
              <button class="toolBtn" style="margin-top:8px;" onclick="showMsg('Права операторов сохранены')">Сохранить права</button>
            </div>
            <div id="pset3" class="tabContent">
              <div class="formRow"><label>Модель ФР:</label><input class="formInput" type="text" value="АТОЛ 30Ф" style="width:180px;"></div>
              <div class="formRow"><label>Рег. номер ФР:</label><input class="formInput" type="text" value="0000411234567890" style="width:180px;"></div>
              <div class="formRow"><label>ИНН организации:</label><input class="formInput" type="text" value="7712345678" style="width:130px;"></div>
              <div class="formRow"><label>Адрес ФН:</label><input class="formInput" type="text" value="COM3" style="width:80px;"></div>
              <div class="formRow"><label>ОФД:</label><select class="formSelect" style="width:180px;"><option>Яндекс.ОФД</option><option>СБИС ОФД</option><option>Платформа ОФД</option></select></div>
              <div class="formRow"><label>Скорость COM:</label><select class="formSelect" style="width:100px;"><option>9600</option><option>19200</option><option selected>115200</option></select></div>
              <div style="margin-top:6px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Параметры ФР сохранены')">Сохранить</button>
                <button class="toolBtn" onclick="showMsg('Тест ФР: ОК')">Тест соединения</button>
                <button class="toolBtn" onclick="showMsg('Служебный чек напечатан')">Печать тест-чека</button>
              </div>
            </div>
            <div id="pset4" class="tabContent">
              <div class="formRow"><label>IP-адрес сервера:</label><input class="formInput" type="text" value="192.168.1.100" style="width:130px;"></div>
              <div class="formRow"><label>Порт:</label><input class="formInput" type="text" value="8080" style="width:60px;"></div>
              <div class="formRow"><label>Резервный сервер:</label><input class="formInput" type="text" value="192.168.1.101" style="width:130px;"></div>
              <div class="formRow"><label>Таймаут (сек):</label><input class="formInput" type="text" value="30" style="width:60px;"></div>
              <div class="formRow"><label>Ping-интервал:</label><input class="formInput" type="text" value="15" style="width:60px;"></div>
              <div style="margin-top:6px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Сетевые настройки сохранены')">Сохранить</button>
                <button class="toolBtn" onclick="showMsg('Ping: RU-MSK-POS-07 — 4ms OK')">Ping сервера</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== SALES / ЧЕКИ ===== -->
        <div id="sec-sales" class="contentPanel section">
          <div class="panelTitle">Продажи и чеки <span>Смена #0847</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'sal1')">Лента чеков</div>
              <div class="tab" onclick="swTab(this,'sal2')">Внести продажу</div>
              <div class="tab" onclick="swTab(this,'sal3')">Возвраты</div>
              <div class="tab" onclick="swTab(this,'sal4')">Скидки / Купоны</div>
            </div>
            <div id="sal1" class="tabContent active">
              <div style="display:flex;gap:4px;margin-bottom:5px;">
                <input class="formInput" type="text" placeholder="Поиск по № чека..." style="width:140px;">
                <select class="formSelect"><option>Все терминалы</option><option>POS-01</option><option>POS-02</option><option>POS-03</option></select>
                <select class="formSelect"><option>Все типы</option><option>Продажа</option><option>Возврат</option></select>
                <button class="toolBtn">Найти</button>
              </div>
              <table class="dataTable" id="salesTable">
                <tr><th>Чек №</th><th>Время</th><th>Терминал</th><th>Кассир</th><th class="num">Сумма &#8381;</th><th>Оплата</th><th>Статус</th><th>Действие</th></tr>
              </table>
            </div>
            <div id="sal2" class="tabContent">
              <div style="max-width:480px;">
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:6px;">РУЧНОЕ ВНЕСЕНИЕ ПОКУПКИ</div>
                <div class="formRow"><label>Терминал:</label><select class="formSelect" style="width:100px;"><option>POS-01</option><option>POS-02</option><option>POS-03</option></select></div>
                <div class="formRow"><label>Кассир:</label><select class="formSelect" style="width:160px;" id="saleCashier"><option>Петров С.А.</option><option>Иванова А.М.</option><option>Сидорова М.П.</option></select></div>
                <div id="saleItems" style="border:2px solid;border-color:#808080 #fff #fff #808080;background:#fff;padding:4px;min-height:80px;margin-bottom:5px;font-size:10px;">
                  <div style="color:#888;font-style:italic;">Позиции не добавлены</div>
                </div>
                <div style="display:flex;gap:4px;margin-bottom:5px;">
                  <select class="formSelect" id="saleMenuSel" style="width:260px;">
                    <optgroup label="— БУРГЕРЫ —">
                      <option value="B001|Гамбургер|55">Гамбургер — 55 ₽</option>
                      <option value="B002|Чизбургер|65">Чизбургер — 65 ₽</option>
                      <option value="B003|Биг Хит|201">Биг Хит — 201 ₽</option>
                      <option value="B004|Двойной Биг Хит|285">Двойной Биг Хит — 285 ₽</option>
                      <option value="B005|Биг Хит Бекон|279">Биг Хит Бекон — 279 ₽</option>
                      <option value="B006|Биг Спешиал|399">Биг Спешиал — 399 ₽</option>
                      <option value="B007|Биг Спешиал Перец гриль|419">Биг Спешиал Перец гриль — 419 ₽</option>
                      <option value="B008|Двойной Биг Спешиал|549">Двойной Биг Спешиал — 549 ₽</option>
                      <option value="B009|Биг Спешиал Три Сыра|439">Биг Спешиал Три Сыра — 439 ₽</option>
                      <option value="B010|Гранд|249">Гранд — 249 ₽</option>
                      <option value="B011|Гранд Чипотл|289">Гранд Чипотл — 289 ₽</option>
                      <option value="B012|Гранд Де Люкс Чипотл|295">Гранд Де Люкс Чипотл — 295 ₽</option>
                      <option value="B013|Чикен Хит Пекинский барбекю|199">Чикен Хит Пекинский барбекю — 199 ₽</option>
                      <option value="B014|Чикен Премьер Пекинский барбекю|239">Чикен Премьер Пекинский барбекю — 239 ₽</option>
                    </optgroup>
                    <optgroup label="— КАРТОФЕЛЬ И СТАРТЕРЫ —">
                      <option value="F001|Картофель фри (средний)|75">Картофель фри (средний) — 75 ₽</option>
                      <option value="F002|Картофель фри (большой)|89">Картофель фри (большой) — 89 ₽</option>
                      <option value="F003|Картофель фри (двойной)|179">Картофель фри (двойной) — 179 ₽</option>
                      <option value="F004|Картофель фри Сметана и лук|129">Картофель фри Сметана и лук — 129 ₽</option>
                      <option value="F005|Картофель по-деревенски Сметана и лук|139">Картофель по-деревенски — 139 ₽</option>
                      <option value="F006|Наггетсы (4 шт)|59">Наггетсы (4 шт) — 59 ₽</option>
                      <option value="F007|Наггетсы (6 шт)|85">Наггетсы (6 шт) — 85 ₽</option>
                      <option value="F008|Наггетсы (9 шт)|125">Наггетсы (9 шт) — 125 ₽</option>
                      <option value="F009|Куриные крылышки (6 шт)|199">Куриные крылышки (6 шт) — 199 ₽</option>
                      <option value="F010|Куриные крылышки (9 шт)|279">Куриные крылышки (9 шт) — 279 ₽</option>
                      <option value="F011|Снэк Бокс с крыльями|289">Снэк Бокс с крыльями — 289 ₽</option>
                      <option value="F012|Большой Снэк Бокс с Крыльями|399">Большой Снэк Бокс с Крыльями — 399 ₽</option>
                      <option value="F013|Большой Снэк Бокс со Стрипсами|379">Большой Снэк Бокс со Стрипсами — 379 ₽</option>
                      <option value="F014|Мега Бокс|599">Мега Бокс — 599 ₽</option>
                    </optgroup>
                    <optgroup label="— РОЛЛЫ И САЛАТЫ —">
                      <option value="R001|Биг Спешиал ролл Перец гриль|329">Биг Спешиал ролл Перец гриль — 329 ₽</option>
                      <option value="R002|Биг Спешиал ролл Чураско|339">Биг Спешиал ролл Чураско — 339 ₽</option>
                      <option value="R003|Биг Спешиал Демиглас Ролл|349">Биг Спешиал Демиглас Ролл — 349 ₽</option>
                      <option value="R004|Цезарь Ролл|289">Цезарь Ролл — 289 ₽</option>
                      <option value="R005|Цезарь Ролл с беконом|319">Цезарь Ролл с беконом — 319 ₽</option>
                      <option value="R006|Фреш Ролл|269">Фреш Ролл — 269 ₽</option>
                      <option value="R007|Шримп Ролл|299">Шримп Ролл — 299 ₽</option>
                      <option value="R008|Салат Цезарь|219">Салат Цезарь — 219 ₽</option>
                      <option value="R009|Салат Цезарь с креветками|299">Салат Цезарь с креветками — 299 ₽</option>
                      <option value="R010|Овощной салат|89">Овощной салат — 89 ₽</option>
                    </optgroup>
                    <optgroup label="— ЗАВТРАКИ —">
                      <option value="Z001|Тост с сыром|71">Тост с сыром — 71 ₽</option>
                      <option value="Z002|Тост с ветчиной|91">Тост с ветчиной — 91 ₽</option>
                      <option value="Z003|Маффин с яйцом и сыром|122">Маффин с яйцом и сыром — 122 ₽</option>
                      <option value="Z004|Маффин со свиной котлетой|105">Маффин со свиной котлетой — 105 ₽</option>
                      <option value="Z005|Картофельный оладушек (3 шт)|55">Картофельный оладушек (3 шт) — 55 ₽</option>
                      <option value="Z006|Большой завтрак|269">Большой завтрак — 269 ₽</option>
                    </optgroup>
                    <optgroup label="— ДЕСЕРТЫ И ВЫПЕЧКА —">
                      <option value="D001|Вишневый пирожок|89">Вишневый пирожок — 89 ₽</option>
                      <option value="D002|Пирожок Черная смородина|89">Пирожок Черная смородина — 89 ₽</option>
                      <option value="D003|Пирожок Пряное яблоко|89">Пирожок Пряное яблоко — 89 ₽</option>
                      <option value="D004|Пирожок Норвежские ягоды|99">Пирожок Норвежские ягоды — 99 ₽</option>
                      <option value="D005|Пирожок Манго-кремчиз|99">Пирожок Манго-кремчиз — 99 ₽</option>
                      <option value="D006|Пирожок Клубника-малина|99">Пирожок Клубника-малина — 99 ₽</option>
                      <option value="D007|Печенье Малина-белый шоколад|129">Печенье Малина-белый шоколад — 129 ₽</option>
                      <option value="D008|Клубничный чизкейк|199">Клубничный чизкейк — 199 ₽</option>
                      <option value="D009|Эклер Апельсиновый Чебурашка|149">Эклер Апельсиновый Чебурашка — 149 ₽</option>
                      <option value="D010|Макарони Матча-кокос|159">Макарони Матча-кокос — 159 ₽</option>
                      <option value="D011|Мороженое ванильное|49">Мороженое ванильное — 49 ₽</option>
                      <option value="D012|Вафельный рожок|39">Вафельный рожок — 39 ₽</option>
                      <option value="D013|Мороженое Карамельное|59">Мороженое Карамельное — 59 ₽</option>
                      <option value="D014|Мороженое Шоколадное|59">Мороженое Шоколадное — 59 ₽</option>
                      <option value="D015|Мороженое Клубничное|59">Мороженое Клубничное — 59 ₽</option>
                      <option value="D016|Мороженое Черничное|69">Мороженое Черничное — 69 ₽</option>
                      <option value="D017|Айс Де Люкс (маленький)|99">Айс Де Люкс (маленький) — 99 ₽</option>
                      <option value="D018|Айс Де Люкс (большой)|149">Айс Де Люкс (большой) — 149 ₽</option>
                    </optgroup>
                    <optgroup label="— НАПИТКИ ХОЛОДНЫЕ —">
                      <option value="N001|Кока-Кола (маленькая)|69">Кока-Кола (маленькая) — 69 ₽</option>
                      <option value="N002|Кока-Кола (средняя)|89">Кока-Кола (средняя) — 89 ₽</option>
                      <option value="N003|Кока-Кола (большая)|119">Кока-Кола (большая) — 119 ₽</option>
                      <option value="N004|Фанта (маленькая)|69">Фанта (маленькая) — 69 ₽</option>
                      <option value="N005|Фанта (средняя)|89">Фанта (средняя) — 89 ₽</option>
                      <option value="N006|Фанта (большая)|119">Фанта (большая) — 119 ₽</option>
                      <option value="N007|Липтон Айс Ти (средний)|89">Липтон Айс Ти (средний) — 89 ₽</option>
                      <option value="N008|Липтон Айс Ти (большой)|119">Липтон Айс Ти (большой) — 119 ₽</option>
                      <option value="N009|Апельсиновый сок|119">Апельсиновый сок — 119 ₽</option>
                      <option value="N010|Лимонад Капри|129">Лимонад Капри — 129 ₽</option>
                      <option value="N011|Пунш Смородина-малина|139">Пунш Смородина-малина — 139 ₽</option>
                      <option value="N012|Пунш Брусника-можжевельник|139">Пунш Брусника-можжевельник — 139 ₽</option>
                      <option value="N013|Пунш Апельсин-спелые ягоды|139">Пунш Апельсин-спелые ягоды — 139 ₽</option>
                      <option value="N014|Бабл Айс Кофе Красный дракон|199">Бабл Айс Кофе Красный дракон — 199 ₽</option>
                    </optgroup>
                    <optgroup label="— НАПИТКИ ГОРЯЧИЕ —">
                      <option value="H001|Капучино (маленький)|69">Капучино (маленький) — 69 ₽</option>
                      <option value="H002|Капучино (средний)|109">Капучино (средний) — 109 ₽</option>
                      <option value="H003|Капучино (большой)|129">Капучино (большой) — 129 ₽</option>
                      <option value="H004|Капучино Красный дракон|165">Капучино Красный дракон — 165 ₽</option>
                      <option value="H005|Латте (маленький)|79">Латте (маленький) — 79 ₽</option>
                      <option value="H006|Латте (средний)|119">Латте (средний) — 119 ₽</option>
                      <option value="H007|Латте (большой)|139">Латте (большой) — 139 ₽</option>
                      <option value="H008|Латте Красный дракон|175">Латте Красный дракон — 175 ₽</option>
                      <option value="H009|Латте с сиропом Печенье с орехами|149">Латте с сиропом Печенье с орехами — 149 ₽</option>
                      <option value="H010|Апельсиновый Раф|189">Апельсиновый Раф — 189 ₽</option>
                      <option value="H011|Айс Кофе Карамель|155">Айс Кофе Карамель — 155 ₽</option>
                      <option value="H012|Эспрессо-тоник|129">Эспрессо-тоник — 129 ₽</option>
                      <option value="H013|Айс Какао|149">Айс Какао — 149 ₽</option>
                      <option value="H014|Какао (средний)|99">Какао (средний) — 99 ₽</option>
                      <option value="H015|Какао (большой)|119">Какао (большой) — 119 ₽</option>
                      <option value="H016|Чай (черный/зеленый)|59">Чай (черный/зеленый) — 59 ₽</option>
                    </optgroup>
                    <optgroup label="— СОУСЫ —">
                      <option value="S001|Соус Йогуртовый с огурчиками|35">Соус Йогуртовый с огурчиками — 35 ₽</option>
                      <option value="S002|Соус Сырный|35">Соус Сырный — 35 ₽</option>
                      <option value="S003|Соус Кисло-Сладкий|35">Соус Кисло-Сладкий — 35 ₽</option>
                      <option value="S004|Соус Терияки|35">Соус Терияки — 35 ₽</option>
                      <option value="S005|Соус 1000 Островов|35">Соус 1000 Островов — 35 ₽</option>
                      <option value="S006|Соус Чесночный|35">Соус Чесночный — 35 ₽</option>
                      <option value="S007|Кетчуп|25">Кетчуп — 25 ₽</option>
                      <option value="S008|Соус Барбекю|35">Соус Барбекю — 35 ₽</option>
                      <option value="S009|Соус Пекинский барбекю|45">Соус Пекинский барбекю — 45 ₽</option>
                    </optgroup>
                    <optgroup label="— КОМБО-НАБОРЫ —">
                      <option value="C001|Праздничное комбо (Биг Хит)|595">Праздничное комбо со стаканом-хамелеоном (Биг Хит) — 595 ₽</option>
                      <option value="C002|Праздничное комбо (Биг Спешиал)|630">Праздничное комбо со стаканом-хамелеоном (Биг Спешиал) — 630 ₽</option>
                      <option value="C003|Кидз Комбо (Ам Ням)|0">Кидз Комбо — игрушка Ам Ням (цена уточн.)</option>
                      <option value="C004|Кидз Комбо (Звездные лошадки)|0">Кидз Комбо — Звездные лошадки (цена уточн.)</option>
                      <option value="C005|Кидз Комбо (благотворит.)|0">Кидз Комбо благотворит. — зверята (цена уточн.)</option>
                      <option value="C006|Зимнее Комбо (Биг Хит)|0">Зимнее Комбо с носками (Биг Хит, цена уточн.)</option>
                    </optgroup>
                  </select>
                  <input class="formInput" type="text" id="saleQty" value="1" style="width:40px;" placeholder="Кол.">
                  <button class="toolBtn" onclick="addSaleItem()">Добавить</button>
                  <button class="toolBtn" onclick="clearSaleItems()">Очистить</button>
                </div>
                <div class="formRow"><label>Итого:</label><strong id="saleTotalDisp" style="font-size:13px;font-family:'Courier New';">0 &#8381;</strong></div>
                <div class="formRow"><label>Тип оплаты:</label><select class="formSelect" id="salePayType"><option>Наличные</option><option>Карта</option><option>QR/СБП</option></select></div>
                <div style="margin-top:8px;display:flex;gap:4px;">
                  <button class="toolBtn" onclick="submitSale()">Оформить продажу</button>
                  <button class="toolBtn" onclick="clearSaleItems()">Сбросить</button>
                </div>
              </div>
            </div>
            <div id="sal3" class="tabContent">
              <div style="max-width:420px;">
                <div class="formRow"><label>Чек № для возврата:</label><input class="formInput" type="text" style="width:120px;" id="refundNum" placeholder="№ чека"></div>
                <div class="formRow"><label>Причина возврата:</label><select class="formSelect" style="width:200px;"><option>Ненадлежащее качество</option><option>Ошибка кассира</option><option>Отказ от товара</option></select></div>
                <div class="formRow"><label>Сумма возврата:</label><input class="formInput" type="text" style="width:100px;" id="refundSum"></div>
                <div class="formRow"><label>Подтверждение PIN:</label><input class="formInput" type="password" style="width:80px;" maxlength="4"></div>
                <button class="toolBtn" style="margin-top:5px;" onclick="processRefund()">Оформить возврат</button>
              </div>
              <hr style="border-color:#808080;margin:8px 0;">
              <div style="font-size:10px;font-weight:bold;margin-bottom:3px;">История возвратов за смену:</div>
              <table class="dataTable">
                <tr><th>Время</th><th>Чек №</th><th>Причина</th><th class="num">Сумма &#8381;</th><th>Менеджер</th></tr>
                <tr><td>16:00</td><td>#4892</td><td>Ошибка кассира</td><td class="num red">-250</td><td>Смирнова Е.В.</td></tr>
              </table>
            </div>
            <div id="sal4" class="tabContent">
              <table class="dataTable" style="margin-bottom:6px;">
                <tr><th>Код купона</th><th>Описание</th><th>Скидка</th><th>Активен до</th><th>Исп.</th><th>Лимит</th><th>Статус</th></tr>
                <tr><td>VIT10</td><td>10% на весь заказ</td><td>10%</td><td>28.02.26</td><td>142</td><td>500</td><td class="green">Активен</td></tr>
                <tr><td>FRIES</td><td>Картофель бесплатно при заказе 350+</td><td>Продукт</td><td>01.03.26</td><td>67</td><td>200</td><td class="green">Активен</td></tr>
                <tr><td>BDAY25</td><td>День рождения — 25%</td><td>25%</td><td>28.02.26</td><td>8</td><td>50</td><td class="orange">Почти исчерп.</td></tr>
                <tr><td>CORP15</td><td>Корпоративная карта</td><td>15%</td><td>31.12.26</td><td>312</td><td>—</td><td class="green">Активен</td></tr>
              </table>
              <button class="toolBtn" onclick="showMsg('Добавление купона — только через ЦО')">Добавить купон</button>
            </div>
          </div>
        </div>

        <!-- ===== CASH ===== -->
        <div id="sec-cash" class="contentPanel section">
          <div class="panelTitle">Касса и денежные средства <span id="cashPanelBal">Наличные: 47 820 &#8381;</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'csh1')">Сводка</div>
              <div class="tab" onclick="swTab(this,'csh2')">Изъятие / Внесение</div>
              <div class="tab" onclick="swTab(this,'csh3')">История операций</div>
              <div class="tab" onclick="swTab(this,'csh4')">Инкассация</div>
            </div>
            <div id="csh1" class="tabContent active">
              <div class="kpiGrid" style="grid-template-columns:repeat(3,1fr);">
                <div class="kpiCard kwarn"><div class="kpiLabel">НАЛИЧНЫЕ В КАССАХ</div><div class="kpiVal" id="cshKpi1">47 820 &#8381;</div><div class="kpiSub">Лимит: 50 000 &#8381;</div></div>
                <div class="kpiCard"><div class="kpiLabel">БЕЗНАЛИЧНЫЕ</div><div class="kpiVal">135 600 &#8381;</div><div class="kpiSub">Карты + QR</div></div>
                <div class="kpiCard kok"><div class="kpiLabel">ИТОГО ВЫРУЧКА</div><div class="kpiVal">183 420 &#8381;</div><div class="kpiSub">С начала смены</div></div>
              </div>
              <table class="dataTable">
                <tr><th>Терминал</th><th class="num">Нач. смены &#8381;</th><th class="num">Приход &#8381;</th><th class="num">Изъято &#8381;</th><th class="num">Остаток &#8381;</th><th>Статус</th></tr>
                <tr><td>POS-01</td><td class="num">5 000</td><td class="num">14 820</td><td class="num">15 000</td><td class="num">4 820</td><td class="green">OK</td></tr>
                <tr><td>POS-02</td><td class="num">5 000</td><td class="num">12 450</td><td class="num">0</td><td class="num">17 450</td><td class="orange">Выше нормы</td></tr>
                <tr><td>POS-03</td><td class="num">5 000</td><td class="num">19 340</td><td class="num">10 000</td><td class="num">14 340</td><td class="green">OK</td></tr>
                <tr><td>POS-04</td><td class="num">5 000</td><td class="num">0</td><td class="num">0</td><td class="num">5 000</td><td class="red">OFFLINE</td></tr>
                <tr><td>POS-05…10</td><td class="num">25 000</td><td class="num">21 210</td><td class="num">40 000</td><td class="num">6 210</td><td class="green">OK</td></tr>
              </table>
            </div>
            <div id="csh2" class="tabContent">
              <div style="display:flex;gap:10px;">
                <div style="flex:1;">
                  <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:5px;">ИЗЪЯТИЕ НАЛИЧНЫХ</div>
                  <div class="formRow"><label>Терминал:</label><select class="formSelect" id="cashOutPos"><option>POS-01</option><option>POS-02</option><option>POS-03</option></select></div>
                  <div class="formRow"><label>Сумма (&#8381;):</label><input class="formInput" type="text" id="cashOutSum" style="width:100px;"></div>
                  <div class="formRow"><label>Причина:</label><select class="formSelect" style="width:170px;"><option>Плановое изъятие</option><option>Сверхлимит</option><option>Инкассация</option></select></div>
                  <div class="formRow"><label>Примечание:</label><input class="formInput" type="text" style="width:200px;"></div>
                  <div class="formRow"><label>PIN менеджера:</label><input class="formInput" type="password" id="cashOutPin" maxlength="4" style="width:70px;"></div>
                  <button class="toolBtn" style="margin-top:5px;" onclick="doCashOp('out')">Оформить изъятие</button>
                </div>
                <div style="flex:1;">
                  <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:5px;">ВНЕСЕНИЕ / РАЗМЕН</div>
                  <div class="formRow"><label>Терминал:</label><select class="formSelect" id="cashInPos"><option>POS-01</option><option>POS-02</option><option>POS-03</option></select></div>
                  <div class="formRow"><label>Сумма (&#8381;):</label><input class="formInput" type="text" id="cashInSum" style="width:100px;"></div>
                  <div class="formRow"><label>Тип:</label><select class="formSelect" style="width:150px;"><option>Размен</option><option>Стартовая сумма</option><option>Коррекция</option></select></div>
                  <div class="formRow"><label>PIN менеджера:</label><input class="formInput" type="password" id="cashInPin" maxlength="4" style="width:70px;"></div>
                  <button class="toolBtn" style="margin-top:5px;" onclick="doCashOp('in')">Оформить внесение</button>
                </div>
              </div>
            </div>
            <div id="csh3" class="tabContent">
              <table class="dataTable" id="cashHistTable">
                <tr><th>№</th><th>Дата/Время</th><th>Терм.</th><th>Тип</th><th class="num">Сумма &#8381;</th><th>Менеджер</th><th>Примечание</th></tr>
                <tr><td>4821</td><td>27.02 15:57</td><td>POS-01</td><td>Изъятие</td><td class="num">15 000</td><td>Смирнова Е.В.</td><td>Плановое</td></tr>
                <tr><td>4820</td><td>27.02 13:10</td><td>POS-03</td><td>Изъятие</td><td class="num">10 000</td><td>Смирнова Е.В.</td><td>Плановое</td></tr>
                <tr><td>4819</td><td>27.02 09:00</td><td>Все</td><td>Внесение</td><td class="num">30 000</td><td>Смирнова Е.В.</td><td>Размен</td></tr>
              </table>
            </div>
            <div id="csh4" class="tabContent">
              <div style="margin-bottom:6px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Акт инкассации сформирован для печати')">Сформировать акт инкассации</button>
                <button class="toolBtn" onclick="showMsg('Вызов инкассаторской службы отправлен')">Вызвать инкассаторов</button>
              </div>
              <table class="dataTable">
                <tr><th>Дата</th><th>Смена</th><th class="num">Сумма &#8381;</th><th>Инкассатор</th><th>Время</th><th>Статус</th></tr>
                <tr><td>26.02.26</td><td>#0846</td><td class="num">142 500</td><td>ГК «Армада»</td><td>21:44</td><td class="green">Подтверждено</td></tr>
                <tr><td>25.02.26</td><td>#0845</td><td class="num">168 300</td><td>ГК «Армада»</td><td>21:58</td><td class="green">Подтверждено</td></tr>
                <tr><td>27.02.26</td><td>#0847</td><td class="num">—</td><td>—</td><td>—</td><td class="orange">Смена открыта</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== EXPENSES ===== -->
        <div id="sec-expenses" class="contentPanel section">
          <div class="panelTitle">Учёт расходов <span>Февраль 2026</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'exp1')">Расходы</div>
              <div class="tab" onclick="swTab(this,'exp2')">Добавить расход</div>
              <div class="tab" onclick="swTab(this,'exp3')">Бюджет</div>
            </div>
            <div id="exp1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:5px;">
                <select class="formSelect"><option>Все категории</option><option>Хоз.расходы</option><option>Техобслуж.</option><option>Транспорт</option></select>
                <input class="formInput" type="text" placeholder="Поиск..." style="width:130px;">
                <button class="toolBtn">Найти</button>
              </div>
              <table class="dataTable" id="expTable">
                <tr><th>Дата</th><th>Код</th><th>Статья</th><th>Категория</th><th class="num">Сумма &#8381;</th><th>Документ</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>27.02</td><td>EXP-4812</td><td>Моющие средства</td><td>Хоз.</td><td class="num">3 420</td><td>Накл.№1248</td><td class="green">Проведён</td><td><button class="toolBtn">Ред.</button></td></tr>
                <tr><td>27.02</td><td>EXP-4811</td><td>Замена фильтра</td><td>Техобслуж.</td><td class="num">8 900</td><td>АКТ-1019</td><td class="green">Проведён</td><td><button class="toolBtn">Ред.</button></td></tr>
                <tr><td>26.02</td><td>EXP-4810</td><td>Канцелярия</td><td>Офисные</td><td class="num">1 250</td><td>Чек №884</td><td class="green">Проведён</td><td><button class="toolBtn">Ред.</button></td></tr>
                <tr><td>26.02</td><td>EXP-4809</td><td>ТО холодильного об.</td><td>Техобслуж.</td><td class="num">15 600</td><td>АКТ-1018</td><td class="orange">На согласов.</td><td><button class="toolBtn">Ред.</button></td></tr>
              </table>
              <div style="margin-top:5px;font-size:10px;border-top:1px solid #808080;padding-top:3px;">Итого за период: <strong>284 710 &#8381;</strong> | Бюджет: 310 000 &#8381; | Остаток: <span class="green bold">25 290 &#8381;</span></div>
            </div>
            <div id="exp2" class="tabContent">
              <div style="max-width:400px;">
                <div class="formRow"><label>Дата:</label><input class="formInput" type="text" id="expDate" value="27.02.2026" style="width:100px;"></div>
                <div class="formRow"><label>Статья:</label><select class="formSelect" id="expCat" style="width:200px;"><option>Хозяйственные расходы</option><option>Техническое обслуживание</option><option>Транспорт</option><option>Офисные расходы</option><option>HR / Обучение</option><option>Прочее</option></select></div>
                <div class="formRow"><label>Описание:</label><input class="formInput" type="text" id="expDesc" style="width:240px;"></div>
                <div class="formRow"><label>Сумма (&#8381;):</label><input class="formInput" type="text" id="expSum" style="width:100px;"></div>
                <div class="formRow"><label>Документ №:</label><input class="formInput" type="text" id="expDoc" style="width:140px;"></div>
                <div class="formRow"><label>Примечание:</label><input class="formInput" type="text" id="expNote" style="width:240px;"></div>
                <div style="margin-top:6px;display:flex;gap:4px;">
                  <button class="toolBtn" onclick="saveExpense()">Сохранить</button>
                  <button class="toolBtn" onclick="clearExpForm()">Очистить</button>
                </div>
              </div>
            </div>
            <div id="exp3" class="tabContent">
              <table class="dataTable">
                <tr><th>Статья</th><th class="num">Бюджет &#8381;</th><th class="num">Факт &#8381;</th><th class="num">Остаток &#8381;</th><th style="width:120px;">% использ.</th></tr>
                <tr><td>Хозяйственные</td><td class="num">80 000</td><td class="num">71 440</td><td class="num green">8 560</td><td><div class="progress"><div class="progressFill" style="width:89%"></div></div></td></tr>
                <tr><td>Техобслуживание</td><td class="num">90 000</td><td class="num">88 200</td><td class="num orange">1 800</td><td><div class="progress"><div class="progressFill porange" style="width:98%"></div></div></td></tr>
                <tr><td>Транспорт</td><td class="num">30 000</td><td class="num">18 400</td><td class="num green">11 600</td><td><div class="progress"><div class="progressFill pgreen" style="width:61%"></div></div></td></tr>
                <tr><td>Офисные</td><td class="num">20 000</td><td class="num">14 870</td><td class="num green">5 130</td><td><div class="progress"><div class="progressFill pgreen" style="width:74%"></div></div></td></tr>
                <tr><td>HR / Обучение</td><td class="num">50 000</td><td class="num">55 800</td><td class="num red">-5 800</td><td><div class="progress"><div class="progressFill pred" style="width:100%"></div></div></td></tr>
                <tr><td><strong>ИТОГО</strong></td><td class="num"><strong>310 000</strong></td><td class="num"><strong>284 710</strong></td><td class="num green bold">25 290</td><td>91.8%</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== INVENTORY ===== -->
        <div id="sec-inventory" class="contentPanel section">
          <div class="panelTitle">Инвентаризация и складской учёт <span>ПБО 23702</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'inv1')">Остатки</div>
              <div class="tab" onclick="swTab(this,'inv2')">Приход товара</div>
              <div class="tab" onclick="swTab(this,'inv3')">Списание</div>
              <div class="tab" onclick="swTab(this,'inv4')">Инвентаризация</div>
              <div class="tab" onclick="swTab(this,'inv5')">Накладные</div>
              <div class="tab" onclick="swTab(this,'inv6')">Нормы расхода</div>
            </div>
            <div id="inv1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:4px;flex-wrap:wrap;">
                <select class="formSelect" id="invFilter"><option value="">Все позиции</option><option value="crit">Только критические</option><option value="low">Мало (ниже нормы)</option></select>
                <input class="formInput" type="text" id="invSearch" placeholder="Поиск по наим./коду..." style="width:160px;">
                <button class="toolBtn" onclick="filterInv()">Показать</button>
                <button class="toolBtn" onclick="nav('orders')">Оформить заявку</button>
                <div style="flex:1;"></div>
                <button class="toolBtn" onclick="showMsg('Отчёт об остатках сформирован')">Распечатать остатки</button>
              </div>
              <table class="dataTable" id="invTable">
                <tr><th>Код</th><th>Наименование</th><th>Ед.</th><th class="num">Норма</th><th class="num">Факт</th><th>Срок год.</th><th>Поставщик</th><th>Статус</th><th>Действие</th></tr>
              </table>
            </div>
            <div id="inv2" class="tabContent">
              <div style="max-width:480px;">
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:5px;">ПРИХОД ТОВАРА</div>
                <div class="formRow"><label>Дата прихода:</label><input class="formInput" type="text" id="rcvDate" value="27.02.2026" style="width:100px;"></div>
                <div class="formRow"><label>Поставщик:</label><select class="formSelect" id="rcvSupplier" style="width:200px;"><option>АО "SPAR Россия"</option><option>ООО "Прод-Сервис"</option><option>ООО "МакСнаб"</option><option>ООО "Протэк-Центр"</option></select></div>
                <div class="formRow"><label>Накладная №:</label><input class="formInput" type="text" id="rcvDoc" style="width:130px;"></div>
                <div style="border:2px solid;border-color:#808080 #fff #fff #808080;background:#fff;padding:4px;margin-bottom:5px;min-height:70px;font-size:10px;" id="rcvItems"><div style="color:#888;font-style:italic;">Добавьте позиции...</div></div>
                <div style="display:flex;gap:4px;margin-bottom:5px;">
                  <select class="formSelect" id="rcvProdSel" style="width:180px;">
                    <option value="P0042|Булочки б/г|шт">Булочки б/г (шт)</option>
                    <option value="M0010|Котлета говяжья|кг">Котлета говяжья (кг)</option>
                    <option value="D0031|Coca-Cola 0.5л|шт">Coca-Cola 0.5л (шт)</option>
                    <option value="F0018|Масло фритюр|л">Масло фритюр (л)</option>
                    <option value="C0001|Смесь МакФлури|кг">Смесь МакФлури (кг)</option>
                    <option value="P0088|Картофель фри|кг">Картофель фри замор. (кг)</option>
                  </select>
                  <input class="formInput" type="text" id="rcvQty" placeholder="Кол-во" style="width:60px;">
                  <input class="formInput" type="text" id="rcvExpiry" placeholder="Срок год." style="width:80px;">
                  <button class="toolBtn" onclick="addRcvItem()">Добавить</button>
                </div>
                <div class="formRow"><label>Примечание:</label><input class="formInput" type="text" style="width:240px;"></div>
                <div style="display:flex;gap:4px;margin-top:5px;">
                  <button class="toolBtn" onclick="saveReceiving()">Оприходовать</button>
                  <button class="toolBtn" onclick="showMsg('Форма очищена')">Очистить</button>
                </div>
              </div>
            </div>
            <div id="inv3" class="tabContent">
              <div style="max-width:440px;">
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin-bottom:5px;">СПИСАНИЕ ПРОДУКЦИИ</div>
                <div class="formRow"><label>Дата:</label><input class="formInput" type="text" value="27.02.2026" style="width:100px;"></div>
                <div class="formRow"><label>Причина:</label><select class="formSelect" style="width:200px;"><option>Истечение срока годности</option><option>Порча / бой</option><option>Технологические потери</option><option>Производственный брак</option><option>Кража / недостача</option></select></div>
                <div style="border:2px solid;border-color:#808080 #fff #fff #808080;background:#fff;padding:4px;margin-bottom:5px;min-height:60px;font-size:10px;" id="writeoffItems"><div style="color:#888;font-style:italic;">Добавьте позиции для списания...</div></div>
                <div style="display:flex;gap:4px;margin-bottom:5px;">
                  <select class="formSelect" id="woSel" style="width:180px;">
                    <option value="P0042|Булочки б/г|шт">Булочки б/г (шт)</option>
                    <option value="M0010|Котлета говяжья|кг">Котлета говяжья (кг)</option>
                    <option value="C0001|Смесь МакФлури|кг">Смесь МакФлури (кг)</option>
                    <option value="F0018|Масло фритюр|л">Масло фритюр (л)</option>
                  </select>
                  <input class="formInput" type="text" id="woQty" placeholder="Кол-во" style="width:60px;">
                  <button class="toolBtn" onclick="addWOItem()">Добавить</button>
                </div>
                <div class="formRow"><label>PIN менеджера:</label><input class="formInput" type="password" id="woPin" maxlength="4" style="width:70px;"></div>
                <div class="formRow"><label>Примечание:</label><input class="formInput" type="text" style="width:240px;"></div>
                <button class="toolBtn" style="margin-top:5px;" onclick="saveWriteoff()">Оформить списание</button>
              </div>
              <hr style="border-color:#808080;margin:8px 0;">
              <div style="font-size:10px;font-weight:bold;margin-bottom:3px;">История списаний за смену:</div>
              <table class="dataTable" id="woHistTable">
                <tr><th>Время</th><th>Позиция</th><th class="num">Кол-во</th><th>Причина</th><th>Менеджер</th></tr>
              </table>
            </div>
            <div id="inv4" class="tabContent">
              <div style="display:flex;gap:4px;margin-bottom:6px;">
                <button class="toolBtn" onclick="startInventory()">Начать инвентаризацию</button>
                <button class="toolBtn" onclick="showMsg('Отчёт инвентаризации сформирован')">Сформировать отчёт</button>
                <button class="toolBtn" onclick="showMsg('Акт инвентаризации распечатан')">Печать акта</button>
              </div>
              <div style="background:#fff8e0;border:1px solid #b05000;padding:4px 8px;margin-bottom:5px;font-size:10px;">Последняя инвентаризация: 27.02.2026 09:00 | Инициатор: Смирнова Е.В. | Статус: <span class="green bold">Завершена</span></div>
              <table class="dataTable" id="invCheckTable">
                <tr><th>Код</th><th>Наименование</th><th>Ед.</th><th class="num">Учётный остаток</th><th class="num">Фактический остаток</th><th class="num">Отклонение</th><th>Статус</th></tr>
              </table>
            </div>
            <div id="inv5" class="tabContent">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <select class="formSelect"><option>Все типы</option><option>Приходная</option><option>Расходная</option><option>Возврат</option></select>
                <input class="formInput" type="text" placeholder="№ накладной" style="width:110px;">
                <button class="toolBtn">Найти</button>
                <button class="toolBtn" onclick="showMsg('Новая накладная — откройте раздел Приход')">Новая накладная</button>
              </div>
              <table class="dataTable" id="waybillTable">
                <tr><th>Дата</th><th>№ накладной</th><th>Тип</th><th>Поставщик</th><th class="num">Сумма &#8381;</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>27.02.26</td><td>П-4472</td><td>Приходная</td><td>АО "SPAR"</td><td class="num">48 400</td><td class="green">Проведена</td><td><button class="toolBtn" onclick="showMsg('Накладная П-4472')">Открыть</button></td></tr>
                <tr><td>26.02.26</td><td>П-4471</td><td>Приходная</td><td>АО "SPAR"</td><td class="num">84 200</td><td class="green">Проведена</td><td><button class="toolBtn" onclick="showMsg('Накладная П-4471')">Открыть</button></td></tr>
                <tr><td>25.02.26</td><td>СП-1012</td><td>Списание</td><td>—</td><td class="num">3 800</td><td class="green">Проведена</td><td><button class="toolBtn" onclick="showMsg('Акт списания СП-1012')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="inv6" class="tabContent">
              <div style="margin-bottom:4px;display:flex;gap:3px;">
                <button class="toolBtn" onclick="showMsg('Нормы расхода сохранены')">Сохранить нормы</button>
                <button class="toolBtn" onclick="showMsg('Нормы по умолчанию восстановлены')">Сбросить к умолч.</button>
              </div>
              <table class="dataTable">
                <tr><th>Код</th><th>Позиция</th><th>Ед.</th><th class="num">Норма/день</th><th class="num">Норма/смена</th><th class="num">Мин.остаток</th><th>Действие</th></tr>
                <tr><td>P0042</td><td>Булочки б/г</td><td>шт</td><td class="num">240</td><td class="num">120</td><td><input class="formInput" type="text" value="50" style="width:50px;"></td><td><button class="toolBtn" onclick="showMsg('Сохранено')">Сохр.</button></td></tr>
                <tr><td>M0010</td><td>Котлета говяжья</td><td>кг</td><td class="num">30</td><td class="num">15</td><td><input class="formInput" type="text" value="5" style="width:50px;"></td><td><button class="toolBtn" onclick="showMsg('Сохранено')">Сохр.</button></td></tr>
                <tr><td>D0031</td><td>Coca-Cola 0.5л</td><td>шт</td><td class="num">400</td><td class="num">200</td><td><input class="formInput" type="text" value="80" style="width:50px;"></td><td><button class="toolBtn" onclick="showMsg('Сохранено')">Сохр.</button></td></tr>
                <tr><td>F0018</td><td>Масло фритюр</td><td>л</td><td class="num">10</td><td class="num">5</td><td><input class="formInput" type="text" value="3" style="width:50px;"></td><td><button class="toolBtn" onclick="showMsg('Сохранено')">Сохр.</button></td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== ORDERS ===== -->
        <div id="sec-orders" class="contentPanel section">
          <div class="panelTitle">Заявки на поставку <span>Активных: 3</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'ord1')">Активные заявки</div>
              <div class="tab" onclick="swTab(this,'ord2')">Создать заявку</div>
              <div class="tab" onclick="swTab(this,'ord3')">История</div>
            </div>
            <div id="ord1" class="tabContent active">
              <table class="dataTable">
                <tr><th>№ заявки</th><th>Поставщик</th><th>Состав</th><th>Подана</th><th>Поставка</th><th class="num">Сумма &#8381;</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>З-1142</td><td>АО "SPAR"</td><td>Булочки, котлеты</td><td>26.02</td><td>28.02</td><td class="num">48 400</td><td class="orange">Подтверждена</td><td><button class="toolBtn" onclick="showMsg('Заявка З-1142')">Открыть</button></td></tr>
                <tr><td>З-1143</td><td>ООО "Прод-Сервис"</td><td>Cola, Sprite</td><td>27.02</td><td>28.02</td><td class="num">21 600</td><td class="orange">В обработке</td><td><button class="toolBtn" onclick="showMsg('Заявка З-1143')">Открыть</button></td></tr>
                <tr><td>З-1144</td><td>ООО "МакСнаб"</td><td>Масло, соусы</td><td>27.02</td><td>01.03</td><td class="num">18 800</td><td class="orange">Ожидает</td><td><button class="toolBtn" onclick="showMsg('Заявка З-1144')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="ord2" class="tabContent">
              <div style="max-width:460px;">
                <div class="formRow"><label>Поставщик:</label><select class="formSelect" style="width:200px;"><option>АО "SPAR Россия"</option><option>ООО "Прод-Сервис"</option><option>ООО "МакСнаб"</option></select></div>
                <div class="formRow"><label>Дата поставки:</label><input class="formInput" type="text" style="width:100px;" placeholder="дд.мм.гггг"></div>
                <div class="formRow"><label>Срочность:</label><select class="formSelect" style="width:150px;"><option>Плановая</option><option>Срочная</option><option>Экстренная</option></select></div>
                <div style="background:#000080;color:#fff;font-size:10px;font-weight:bold;padding:2px 5px;margin:5px 0 3px;">СОСТАВ ЗАЯВКИ</div>
                <table class="dataTable" id="newOrderTable">
                  <tr><th>Позиция</th><th>Ед.</th><th class="num">Кол-во</th><th>Удалить</th></tr>
                </table>
                <div style="display:flex;gap:3px;margin-top:4px;">
                  <select class="formSelect" id="ordProdSel" style="width:180px;"><option value="Булочки б/г|шт">Булочки б/г</option><option value="Котлета говяжья|кг">Котлета говяжья</option><option value="Coca-Cola 0.5л|шт">Coca-Cola 0.5л</option><option value="Масло фритюр|л">Масло фритюр</option><option value="Картофель фри|кг">Картофель фри</option></select>
                  <input class="formInput" type="text" id="ordQty" placeholder="Кол-во" style="width:60px;">
                  <button class="toolBtn" onclick="addOrderItem()">Добавить</button>
                </div>
                <div class="formRow" style="margin-top:5px;"><label>Примечание:</label><input class="formInput" type="text" style="width:240px;"></div>
                <button class="toolBtn" style="margin-top:5px;" onclick="submitOrder()">Отправить заявку</button>
              </div>
            </div>
            <div id="ord3" class="tabContent">
              <table class="dataTable">
                <tr><th>№</th><th>Поставщик</th><th>Состав</th><th>Подана</th><th>Получена</th><th class="num">Сумма &#8381;</th><th>Статус</th></tr>
                <tr><td>З-1141</td><td>АО "SPAR"</td><td>Мороженое, молочные</td><td>24.02</td><td>26.02</td><td class="num">34 200</td><td class="green">Получена</td></tr>
                <tr><td>З-1140</td><td>ООО "Прод-Сервис"</td><td>Напитки</td><td>22.02</td><td>24.02</td><td class="num">28 800</td><td class="green">Получена</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== MENU SETTINGS ===== -->
        <div id="sec-menu-settings" class="contentPanel section">
          <div class="panelTitle">Настройка меню <span>ПБО 23702</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'mnu1')">Позиции меню</div>
              <div class="tab" onclick="swTab(this,'mnu2')">Стоп-лист</div>
              <div class="tab" onclick="swTab(this,'mnu3')">Цены</div>
              <div class="tab" onclick="swTab(this,'mnu4')">Комбо / Наборы</div>
              <div class="tab" onclick="swTab(this,'mnu5')">Акции</div>
            </div>

            <!-- TAB 1: ПОЗИЦИИ МЕНЮ -->
            <div id="mnu1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:4px;flex-wrap:wrap;">
                <select class="formSelect" id="mnuCatFilter" onchange="filterMenuTable()">
                  <option value="">Все категории</option>
                  <option value="Бургеры">Бургеры</option>
                  <option value="Картофель и стартеры">Картофель и стартеры</option>
                  <option value="Роллы и салаты">Роллы и салаты</option>
                  <option value="Завтраки">Завтраки</option>
                  <option value="Десерты и выпечка">Десерты и выпечка</option>
                  <option value="Напитки холодные">Напитки холодные</option>
                  <option value="Напитки горячие">Напитки горячие</option>
                  <option value="Соусы">Соусы</option>
                </select>
                <input class="formInput" type="text" id="mnuSearch" placeholder="Поиск позиции..." style="width:150px;" oninput="filterMenuTable()">
                <button class="toolBtn" onclick="filterMenuTable()">Найти</button>
                <div style="flex:1;"></div>
                <button class="toolBtn" onclick="showMsg('Меню синхронизировано с POS-терминалами')">Синхронизировать с POS</button>
              </div>
              <div style="overflow:auto;max-height:380px;">
                <table class="dataTable menuItemRow" id="fullMenuTable">
                  <tr><th>Код</th><th>Наименование</th><th>Категория</th><th class="num">Цена &#8381;</th><th>Активна</th><th>Печать</th><th>Отображ.</th><th>Действие</th></tr>
                </table>
              </div>
            </div>

            <!-- TAB 2: СТОП-ЛИСТ -->
            <div id="mnu2" class="tabContent">
              <div style="background:#fff0e0;border:1px solid #c06000;padding:4px 8px;margin-bottom:5px;font-size:10px;">Стоп-лист — позиции, недоступные для продажи. Изменения применяются немедленно ко всем активным POS.</div>
              <div style="display:flex;gap:4px;margin-bottom:5px;flex-wrap:wrap;">
                <select class="formSelect" id="stopMenuSel" style="width:240px;"></select>
                <input class="formInput" type="text" id="stopReason" placeholder="Причина (обязательно)" style="width:180px;">
                <button class="toolBtn" onclick="addStopItem()">Добавить в стоп</button>
              </div>
              <table class="dataTable" id="stopTable">
                <tr><th>Код</th><th>Позиция</th><th>Причина</th><th>Добавлено</th><th>Менеджер</th><th>Действие</th></tr>
              </table>
            </div>

            <!-- TAB 3: ЦЕНЫ -->
            <div id="mnu3" class="tabContent">
              <div style="background:#e0f0ff;border:1px solid #0060a0;padding:4px 8px;margin-bottom:5px;font-size:10px;">Изменение цен требует подтверждения PIN и синхронизации с ЦО. Вступают в силу после применения.</div>
              <div style="display:flex;gap:4px;margin-bottom:4px;">
                <input class="formInput" type="text" id="priceSearch" placeholder="Поиск..." style="width:150px;" oninput="filterPriceTable()">
                <button class="toolBtn" onclick="filterPriceTable()">Найти</button>
                <button class="toolBtn" onclick="showMsg('Все изменённые цены применены и синхронизированы с POS')">Применить все изменения</button>
              </div>
              <div style="overflow:auto;max-height:370px;">
                <table class="dataTable" id="priceTable">
                  <tr><th>Код</th><th>Наименование</th><th>Категория</th><th class="num">Текущая цена &#8381;</th><th class="num">Новая цена &#8381;</th><th>Дата изм.</th><th>Действие</th></tr>
                </table>
              </div>
            </div>

            <!-- TAB 4: КОМБО / НАБОРЫ -->
            <div id="mnu4" class="tabContent">
              <div style="overflow:auto;max-height:400px;">
                <table class="dataTable" id="comboTable">
                  <tr>
                    <th>Код</th><th>Название набора</th><th>Тип</th><th>Состав</th>
                    <th class="num">Цена &#8381;</th><th>Доступные бургеры</th>
                    <th>Акт. с</th><th>Активен</th><th>Примечание</th><th>Действие</th>
                  </tr>
                  <!-- ПРАЗДНИЧНОЕ КОМБО 595 -->
                  <tr>
                    <td>C-PR1</td>
                    <td><strong>Праздничное комбо</strong><br><span style="font-size:9px;color:#555;">со стаканом-хамелеоном</span></td>
                    <td>Сезонное</td>
                    <td style="font-size:9px;">Бургер + Фри (мал.) + Напиток (ср.) + Стакан-хамелеон</td>
                    <td class="num bold">595</td>
                    <td style="font-size:9px;">Биг Хит, Гранд, Чикен Хит Пек.б/б</td>
                    <td style="font-size:9px;">—</td>
                    <td><input type="checkbox" checked></td>
                    <td style="font-size:9px;color:#555;">Цена 595 ₽</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-PR1')">Подробно</button></td>
                  </tr>
                  <!-- ПРАЗДНИЧНОЕ КОМБО 630 -->
                  <tr style="background:#f0f4ff;">
                    <td>C-PR2</td>
                    <td><strong>Праздничное комбо+</strong><br><span style="font-size:9px;color:#555;">со стаканом-хамелеоном</span></td>
                    <td>Сезонное</td>
                    <td style="font-size:9px;">Бургер + Фри (мал.) + Напиток (ср.) + Стакан-хамелеон</td>
                    <td class="num bold">630</td>
                    <td style="font-size:9px;">Биг Спешиал, Двойной Чизбургер, Гранд Де Люкс Чипотл, Чикен Премьер Пек.б/б</td>
                    <td style="font-size:9px;">—</td>
                    <td><input type="checkbox" checked></td>
                    <td style="font-size:9px;color:#555;">Цена 630 ₽</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-PR2')">Подробно</button></td>
                  </tr>
                  <!-- КИДЗ КОМБО Ам Ням -->
                  <tr>
                    <td>C-KD1</td>
                    <td><strong>Кидз Комбо</strong><br><span style="font-size:9px;color:#555;">игрушка Cut the Rope: Ам Ням / Ам Няша</span></td>
                    <td>Детский</td>
                    <td style="font-size:9px;">Детский набор + коллекционная игрушка</td>
                    <td class="num orange">уточн.</td>
                    <td style="font-size:9px;">—</td>
                    <td style="font-size:9px;">с 06.01.2026</td>
                    <td><input type="checkbox" checked></td>
                    <td style="font-size:9px;color:#555;">Серия Cut the Rope</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-KD1')">Подробно</button></td>
                  </tr>
                  <!-- КИДЗ КОМБО Звездные лошадки -->
                  <tr style="background:#f0f4ff;">
                    <td>C-KD2</td>
                    <td><strong>Кидз Комбо</strong><br><span style="font-size:9px;color:#555;">Звездные лошадки и друзья</span></td>
                    <td>Детский</td>
                    <td style="font-size:9px;">Детский набор + игрушка коллекция (Чоко, Зифи, Брут, Мими, Эджи, Бубу)</td>
                    <td class="num orange">уточн.</td>
                    <td style="font-size:9px;">—</td>
                    <td style="font-size:9px;">с 10.02.2026</td>
                    <td><input type="checkbox" checked></td>
                    <td style="font-size:9px;color:#555;">6 игрушек в коллекции</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-KD2')">Подробно</button></td>
                  </tr>
                  <!-- КИДЗ КОМБО Благотворительный -->
                  <tr>
                    <td>C-KD3</td>
                    <td><strong>Кидз Комбо</strong><br><span style="font-size:9px;color:#d06000;">Благотворительная коллекция</span></td>
                    <td>Детский</td>
                    <td style="font-size:9px;">Детский набор + держатель для фото в виде зверят (лягушонок, лисенок, волчонок, медвежонок)</td>
                    <td class="num orange">уточн.</td>
                    <td style="font-size:9px;">—</td>
                    <td style="font-size:9px;">с 10.03.2026</td>
                    <td><input type="checkbox"></td>
                    <td style="font-size:9px;color:#007000;font-weight:bold;">15 ₽ → Фонд «Семья вместе»</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-KD3')">Подробно</button></td>
                  </tr>
                  <!-- ЗИМНЕЕ КОМБО -->
                  <tr style="background:#f0f4ff;">
                    <td>C-ZM1</td>
                    <td><strong>Зимнее Комбо</strong><br><span style="font-size:9px;color:#555;">новогодняя коллекция</span></td>
                    <td>Сезонное</td>
                    <td style="font-size:9px;">Бургер + Фри + Напиток + Новогодние носки (коллекционные)</td>
                    <td class="num orange">уточн.</td>
                    <td style="font-size:9px;">Биг Хит (самый популярный), другие бургеры</td>
                    <td style="font-size:9px;">Зима 2025–26</td>
                    <td><input type="checkbox"></td>
                    <td style="font-size:9px;color:#555;">Продано 388 000 наборов</td>
                    <td><button class="toolBtn" onclick="showComboDetail('C-ZM1')">Подробно</button></td>
                  </tr>
                </table>
              </div>
              <div style="margin-top:5px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Новый набор','<div style=\"max-width:360px;\"><div class=\"formRow\"><label style=\"min-width:90px;\">Название:</label><input class=\"formInput\" type=\"text\" id=\"newComboName\" style=\"width:200px;\"></div><div class=\"formRow\"><label style=\"min-width:90px;\">Тип:</label><select class=\"formSelect\"><option>Постоянный</option><option>Сезонный</option><option>Детский</option></select></div><div class=\"formRow\"><label style=\"min-width:90px;\">Состав:</label><input class=\"formInput\" type=\"text\" id=\"newComboComp\" style=\"width:200px;\"></div><div class=\"formRow\"><label style=\"min-width:90px;\">Цена ₽:</label><input class=\"formInput\" type=\"text\" id=\"newComboPrice\" style=\"width:80px;\"></div></div>','<button class=\"dlgBtn\" onclick=\"saveNewCombo()\">Создать</button><button class=\"dlgBtn\" onclick=\"closeDlg()\">Отмена</button>')">Добавить набор</button>
                <button class="toolBtn" onclick="showMsg('Все изменения в комбо-наборах синхронизированы с POS')">Синхронизировать с POS</button>
              </div>
            </div>

            <!-- TAB 5: АКЦИИ -->
            <div id="mnu5" class="tabContent">
              <div style="background:#e8f8e8;border:1px solid #007000;padding:4px 8px;margin-bottom:5px;font-size:10px;">Активные акции и специальные предложения ПБО 23702</div>
              <table class="dataTable">
                <tr><th>Код</th><th>Название акции</th><th>Условие</th><th>Скидка / Бонус</th><th>Период</th><th>Прим.</th><th>Статус</th></tr>
                <tr><td>A001</td><td>Праздничное комбо (стакан-хамелеон)</td><td>Покупка набора C-PR1/C-PR2</td><td>Коллекционный стакан в подарок</td><td>Актуально</td><td>—</td><td class="green">Активна</td></tr>
                <tr><td>A002</td><td>Кидз Комбо — Cut the Rope</td><td>Покупка Кидз Комбо C-KD1</td><td>Игрушка Ам Ням / Ам Няша</td><td>с 06.01.26</td><td>—</td><td class="green">Активна</td></tr>
                <tr><td>A003</td><td>Кидз Комбо — Звездные лошадки</td><td>Покупка Кидз Комбо C-KD2</td><td>Игрушка из коллекции (6 видов)</td><td>с 10.02.26</td><td>6 игрушек</td><td class="green">Активна</td></tr>
                <tr><td>A004</td><td>Кидз Комбо благотворит. — Зверята</td><td>Покупка Кидз Комбо C-KD3</td><td>Держатель-зверёнок + 15 ₽ в фонд</td><td>с 10.03.26</td><td>Фонд «Семья вместе»</td><td class="orange">Предстоит</td></tr>
                <tr><td>A005</td><td>Зимнее Комбо</td><td>Покупка Зимнего Комбо C-ZM1</td><td>Коллекционные новогодние носки</td><td>Зима 2025–26</td><td>388 000 набор. продано</td><td class="orange">Завершена</td></tr>
                <tr><td>A006</td><td>Купон VIT10 — 10% на всё</td><td>Ввод промокода VIT10</td><td>10% скидка</td><td>до 28.02.26</td><td>—</td><td class="green">Активна</td></tr>
                <tr><td>A007</td><td>Купон BDAY25 — день рождения</td><td>Купон + документ</td><td>25% скидка</td><td>до 28.02.26</td><td>Лимит 50 шт</td><td class="orange">Почти исчерп.</td></tr>
              </table>
              <div style="margin-top:5px;"><button class="toolBtn" onclick="showMsg('Новая акция — только через ЦО (маркетинговый отдел)')">Создать акцию</button></div>
            </div>

          </div>
        </div>

        <!-- ===== STAFF ===== -->
        <div id="sec-staff" class="contentPanel section">
          <div class="panelTitle">Персонал — ПБО 23702 <span>На смене: 14 чел.</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'stf1')">Смена</div>
              <div class="tab" onclick="swTab(this,'stf2')">Сотрудники</div>
              <div class="tab" onclick="swTab(this,'stf3')">Табель</div>
              <div class="tab" onclick="swTab(this,'stf4')">KPI</div>
            </div>
            <div id="stf1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <button class="toolBtn" onclick="showMsg('Выход сотрудника оформлен')">Выход сотрудника</button>
                <button class="toolBtn" onclick="showMsg('Перерыв оформлен')">Перерыв</button>
                <button class="toolBtn" onclick="showMsg('Замена назначена')">Назначить замену</button>
              </div>
              <table class="dataTable">
                <tr><th>Таб.№</th><th>ФИО</th><th>Должность</th><th>Начало</th><th>Конец</th><th>Зона</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>1042</td><td>Смирнова Е.В.</td><td>Менеджер смены</td><td>08:00</td><td>20:00</td><td>Весь рест.</td><td><span style="background:#000080;color:#fff;padding:1px 3px;font-size:9px;">МЕНЕДЖЕР</span></td><td><button class="toolBtn" onclick="showMsg('Профиль Смирнова Е.В.')">Профиль</button></td></tr>
                <tr><td>2077</td><td>Плехов Л.А.</td><td>Менеджер смены</td><td>08:00</td><td>20:00</td><td>Весь рест.</td><td><span style="background:#000080;color:#fff;padding:1px 3px;font-size:9px;">МЕНЕДЖЕР</span></td><td><button class="toolBtn" onclick="showMsg('Профиль Плехов Л.А.')">Профиль</button></td></tr>
                <tr><td>1055</td><td>Петров С.А.</td><td>Кассир</td><td>08:00</td><td>16:00</td><td>POS-01</td><td class="green">На посту</td><td><button class="toolBtn" onclick="showMsg('Профиль Петров С.А.')">Профиль</button></td></tr>
                <tr><td>1063</td><td>Иванова А.М.</td><td>Кассир</td><td>08:00</td><td>16:00</td><td>POS-03</td><td class="green">На посту</td><td><button class="toolBtn" onclick="showMsg('Профиль Иванова А.М.')">Профиль</button></td></tr>
                <tr><td>1091</td><td>Николаева О.С.</td><td>Работник кухни</td><td>08:12</td><td>16:00</td><td>Кухня</td><td class="orange">Опоздание</td><td><button class="toolBtn" onclick="showMsg('Нарушение записано')">Нарушение</button></td></tr>
                <tr><td>1104</td><td>Козлов Д.И.</td><td>Работник кухни</td><td>08:00</td><td>16:00</td><td>Кухня</td><td class="green">На посту</td><td><button class="toolBtn" onclick="showMsg('Профиль Козлов Д.И.')">Профиль</button></td></tr>
                <tr><td>1117</td><td>Морозова Т.Н.</td><td>Работник зала</td><td>08:00</td><td>16:00</td><td>Зал</td><td class="orange">Перерыв</td><td><button class="toolBtn" onclick="showMsg('Перерыв завершён')">Вернуть</button></td></tr>
              </table>
            </div>
            <div id="stf2" class="tabContent">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <button class="toolBtn" onclick="showMsg('Добавление сотрудника — только через HR-систему')">Добавить сотрудника</button>
                <input class="formInput" type="text" placeholder="Поиск по ФИО / таб.№..." style="width:180px;">
                <button class="toolBtn">Найти</button>
              </div>
              <table class="dataTable">
                <tr><th>Таб.№</th><th>ФИО</th><th>Должность</th><th>Дата приёма</th><th>Ставка &#8381;/ч</th><th>Доступ</th><th>Действие</th></tr>
                <tr><td>1042</td><td>Смирнова Е.В.</td><td>Менеджер смены</td><td>15.03.2022</td><td class="num">280</td><td><span style="background:#000080;color:#fff;padding:1px 3px;font-size:9px;">МГР</span></td><td><button class="toolBtn" onclick="showMsg('Профиль')">Ред.</button></td></tr>
                <tr><td>2077</td><td>Плехов Лев Александрович</td><td>Менеджер смены</td><td>01.09.2023</td><td class="num">280</td><td><span style="background:#000080;color:#fff;padding:1px 3px;font-size:9px;">МГР</span></td><td><button class="toolBtn" onclick="showMsg('Профиль Плехов Л.А.')">Ред.</button></td></tr>
                <tr><td>1055</td><td>Петров С.А.</td><td>Кассир</td><td>10.06.2023</td><td class="num">220</td><td><span style="background:#606060;color:#fff;padding:1px 3px;font-size:9px;">КАС</span></td><td><button class="toolBtn" onclick="showMsg('Профиль')">Ред.</button></td></tr>
                <tr><td>1063</td><td>Иванова А.М.</td><td>Кассир</td><td>22.08.2023</td><td class="num">220</td><td><span style="background:#606060;color:#fff;padding:1px 3px;font-size:9px;">КАС</span></td><td><button class="toolBtn" onclick="showMsg('Профиль')">Ред.</button></td></tr>
                <tr><td>1091</td><td>Николаева О.С.</td><td>Работник кухни</td><td>14.01.2024</td><td class="num">200</td><td><span style="background:#606060;color:#fff;padding:1px 3px;font-size:9px;">ЭКИ</span></td><td><button class="toolBtn" onclick="showMsg('Профиль')">Ред.</button></td></tr>
              </table>
            </div>
            <div id="stf3" class="tabContent">
              <table class="dataTable">
                <tr><th>Таб.№</th><th>ФИО</th><th class="num">Норма ч/ч</th><th class="num">Факт ч/ч</th><th class="num">Перераб.</th><th class="num">Отсутствие</th><th>Действие</th></tr>
                <tr><td>1042</td><td>Смирнова Е.В.</td><td class="num">168</td><td class="num">172</td><td class="num green">+4</td><td class="num">0</td><td><button class="toolBtn" onclick="showMsg('Табель Смирнова')">Подробно</button></td></tr>
                <tr><td>2077</td><td>Плехов Л.А.</td><td class="num">168</td><td class="num">164</td><td class="num">—</td><td class="num orange">4</td><td><button class="toolBtn" onclick="showMsg('Табель Плехов')">Подробно</button></td></tr>
                <tr><td>1055</td><td>Петров С.А.</td><td class="num">160</td><td class="num">158</td><td class="num">—</td><td class="num orange">2</td><td><button class="toolBtn" onclick="showMsg('Табель Петров')">Подробно</button></td></tr>
                <tr><td>1091</td><td>Николаева О.С.</td><td class="num">160</td><td class="num">152</td><td class="num">—</td><td class="num red">8</td><td><button class="toolBtn" onclick="showMsg('Зафиксировано нарушение')">Нарушение</button></td></tr>
              </table>
            </div>
            <div id="stf4" class="tabContent">
              <table class="dataTable">
                <tr><th>ФИО</th><th class="num">Скорость</th><th class="num">Качество</th><th class="num">Гигиена</th><th class="num">Дисципл.</th><th class="num">Итог</th><th>Оценка</th></tr>
                <tr><td>Смирнова Е.В.</td><td class="num">95</td><td class="num">98</td><td class="num">97</td><td class="num">100</td><td class="num green bold">97.5</td><td class="green">Отлично</td></tr>
                <tr><td>Плехов Л.А.</td><td class="num">92</td><td class="num">94</td><td class="num">96</td><td class="num">98</td><td class="num green bold">95.0</td><td class="green">Отлично</td></tr>
                <tr><td>Петров С.А.</td><td class="num">88</td><td class="num">90</td><td class="num">92</td><td class="num">95</td><td class="num green bold">91.3</td><td class="green">Хорошо</td></tr>
                <tr><td>Николаева О.С.</td><td class="num">75</td><td class="num">80</td><td class="num">85</td><td class="num orange">70</td><td class="num orange bold">77.5</td><td class="orange">Удовл.</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== SHIFT ===== -->
        <div id="sec-shift" class="contentPanel section">
          <div class="panelTitle">Управление сменой #0847 <span>27.02.2026 | 08:00 — текущая</span></div>
          <div class="panelBody">
            <div class="kpiGrid">
              <div class="kpiCard kok"><div class="kpiLabel">СТАТУС</div><div class="kpiVal" style="font-size:10px;color:green;">АКТИВНА</div></div>
              <div class="kpiCard"><div class="kpiLabel">ПРОДОЛЖ.</div><div class="kpiVal" id="shiftDur">8ч 14м</div></div>
              <div class="kpiCard kok"><div class="kpiLabel">ВЫРУЧКА</div><div class="kpiVal">183 420&#8381;</div></div>
              <div class="kpiCard"><div class="kpiLabel">ЧЕКОВ</div><div class="kpiVal">429</div></div>
            </div>
            <div style="display:flex;gap:4px;margin-bottom:7px;flex-wrap:wrap;">
              <button class="toolBtn" onclick="transferShift()">Передать смену</button>
              <button class="toolBtn" onclick="printZReport()">Сформировать Z-отчёт</button>
              <button class="toolBtn" onclick="showMsg('X-отчёт напечатан')">X-отчёт</button>
              <button class="toolBtn" onclick="showMsg('Пересчёт кассы инициирован')">Пересчёт кассы</button>
              <button class="toolBtnEmg" onclick="emergencyCloseShift()">!! ЭКСТРЕННОЕ ЗАКРЫТИЕ СМЕНЫ</button>
            </div>
            <div style="font-size:10px;font-weight:bold;padding:2px 5px;background:#000080;color:#fff;margin-bottom:3px;">ЖУРНАЛ СМЕНЫ</div>
            <table class="dataTable" id="shiftLog">
              <tr><th>Время</th><th>Событие</th><th>Пользователь</th><th>Описание</th></tr>
            </table>
          </div>
        </div>

        <!-- ===== ACCOUNTING ===== -->
        <div id="sec-accounting" class="contentPanel section">
          <div class="panelTitle">Бухгалтерский учёт <span>01.02.2026–27.02.2026</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'acc1')">ОСВ</div>
              <div class="tab" onclick="swTab(this,'acc2')">Проводки</div>
              <div class="tab" onclick="swTab(this,'acc3')">Акты сверки</div>
              <div class="tab" onclick="swTab(this,'acc4')">Налоги</div>
            </div>
            <div id="acc1" class="tabContent active">
              <div class="reportHeader"><table><tr><td><strong>Оборотно-сальдовая ведомость</strong></td><td>ООО «ВИТ Регион 7» | ПБО 23702</td></tr><tr><td>Период: 01.02.2026–27.02.2026</td><td>Валюта: RUB</td></tr></table></div>
              <table class="dataTable">
                <tr><th>Счёт</th><th>Наименование</th><th class="num">Сальдо нач. Дт</th><th class="num">Сальдо нач. Кт</th><th class="num">Оборот Дт</th><th class="num">Оборот Кт</th><th class="num">Сальдо кон. Дт</th><th class="num">Сальдо кон. Кт</th></tr>
                <tr><td>50</td><td>Касса</td><td class="num">35 000</td><td class="num">—</td><td class="num">1 842 400</td><td class="num">1 829 580</td><td class="num">47 820</td><td class="num">—</td></tr>
                <tr><td>51</td><td>Расч. счёт</td><td class="num">248 000</td><td class="num">—</td><td class="num">3 246 800</td><td class="num">3 180 200</td><td class="num">314 600</td><td class="num">—</td></tr>
                <tr><td>41</td><td>Товары</td><td class="num">184 200</td><td class="num">—</td><td class="num">1 120 400</td><td class="num">980 600</td><td class="num">324 000</td><td class="num">—</td></tr>
                <tr><td>60</td><td>Расчёты с поставщиками</td><td class="num">—</td><td class="num">142 000</td><td class="num">980 600</td><td class="num">1 048 000</td><td class="num">—</td><td class="num">209 400</td></tr>
                <tr><td>70</td><td>Расчёты с персоналом</td><td class="num">—</td><td class="num">284 100</td><td class="num">284 100</td><td class="num">348 600</td><td class="num">—</td><td class="num">348 600</td></tr>
                <tr><td>90</td><td>Продажи</td><td class="num">—</td><td class="num">—</td><td class="num">4 284 200</td><td class="num">4 980 600</td><td class="num">—</td><td class="num">696 400</td></tr>
                <tr><td>44</td><td>Расходы на продажу</td><td class="num">18 400</td><td class="num">—</td><td class="num">284 710</td><td class="num">284 710</td><td class="num">18 400</td><td class="num">—</td></tr>
              </table>
            </div>
            <div id="acc2" class="tabContent">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <button class="toolBtn" onclick="showMsg('Новая проводка — только для главного бухгалтера')">Новая проводка</button>
                <input class="formInput" type="text" placeholder="Поиск по счёту..." style="width:130px;">
                <button class="toolBtn">Найти</button>
              </div>
              <table class="dataTable">
                <tr><th>№</th><th>Дата</th><th>Содержание</th><th>Дт</th><th>Кт</th><th class="num">Сумма &#8381;</th></tr>
                <tr><td>4912</td><td>27.02.26</td><td>Выручка смена #0847</td><td>50,51</td><td>90.1</td><td class="num">183 420</td></tr>
                <tr><td>4911</td><td>27.02.26</td><td>Списание себестоимости</td><td>90.2</td><td>41</td><td class="num">68 400</td></tr>
                <tr><td>4910</td><td>27.02.26</td><td>Расходы на оплату труда</td><td>44</td><td>70</td><td class="num">14 200</td></tr>
                <tr><td>4909</td><td>27.02.26</td><td>Хоз.расходы (моющие)</td><td>44</td><td>60</td><td class="num">3 420</td></tr>
                <tr><td>4908</td><td>26.02.26</td><td>Выручка смена #0846</td><td>50,51</td><td>90.1</td><td class="num">172 800</td></tr>
              </table>
            </div>
            <div id="acc3" class="tabContent">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <button class="toolBtn" onclick="showMsg('Новый акт сверки сформирован')">Новый акт</button>
                <button class="toolBtn" onclick="showMsg('Акт отправлен контрагенту')">Отправить контрагенту</button>
              </div>
              <table class="dataTable">
                <tr><th>Контрагент</th><th>ИНН</th><th class="num">Долг наш &#8381;</th><th class="num">Долг их &#8381;</th><th>Дата акта</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>ООО "Протэк-Центр"</td><td>7712345678</td><td class="num">—</td><td class="num">42 000</td><td>31.01.26</td><td class="green">Подписан</td><td><button class="toolBtn" onclick="showMsg('Акт сверки — Протэк')">Открыть</button></td></tr>
                <tr><td>АО "SPAR Россия"</td><td>7812345678</td><td class="num">84 200</td><td class="num">—</td><td>28.01.26</td><td class="orange">На подписи</td><td><button class="toolBtn" onclick="showMsg('Акт сверки — SPAR')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="acc4" class="tabContent">
              <table class="dataTable">
                <tr><th>Налог</th><th class="num">База &#8381;</th><th>Ставка</th><th class="num">Начислено &#8381;</th><th class="num">Уплачено &#8381;</th><th>Срок</th><th>Статус</th></tr>
                <tr><td>НДС</td><td class="num">4 980 600</td><td class="num">20%</td><td class="num">830 100</td><td class="num">830 100</td><td>25.02.26</td><td class="green">Уплачен</td></tr>
                <tr><td>Налог на прибыль</td><td class="num">696 400</td><td class="num">20%</td><td class="num">139 280</td><td class="num">0</td><td>28.03.26</td><td class="orange">Не уплачен</td></tr>
                <tr><td>НДФЛ</td><td class="num">348 600</td><td class="num">13%</td><td class="num">45 318</td><td class="num">45 318</td><td>28.02.26</td><td class="green">Уплачен</td></tr>
                <tr><td>СФР (взносы)</td><td class="num">348 600</td><td class="num">30.2%</td><td class="num">105 277</td><td class="num">105 277</td><td>28.02.26</td><td class="green">Уплачен</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== REPORTS ===== -->
        <div id="sec-reports" class="contentPanel section">
          <div class="panelTitle">Отчёты <span>ПБО 23702</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'rep1')">Список</div>
              <div class="tab" onclick="swTab(this,'rep2')">Сменный</div>
              <div class="tab" onclick="swTab(this,'rep3')">Месячный</div>
              <div class="tab" onclick="swTab(this,'rep4')">СПУР</div>
            </div>
            <div id="rep1" class="tabContent active">
              <table class="dataTable">
                <tr><th>Код</th><th>Отчёт</th><th>Период</th><th>Последнее форм.</th><th>Действие</th></tr>
                <tr><td>RPT-001</td><td>Сменный отчёт (Z-отчёт)</td><td>Смена</td><td>26.02.26 20:14</td><td><button class="toolBtn" onclick="swTab(document.querySelector('#sec-reports .tabRow .tab:nth-child(2)'),'rep2')">Открыть</button></td></tr>
                <tr><td>RPT-002</td><td>Суточный по продажам</td><td>День</td><td>26.02.26 23:59</td><td><button class="toolBtn" onclick="showMsg('Суточный отчёт за 26.02.26')">Открыть</button></td></tr>
                <tr><td>RPT-003</td><td>По позициям меню</td><td>Смена</td><td>26.02.26 20:14</td><td><button class="toolBtn" onclick="showMsg('Отчёт по позициям меню')">Открыть</button></td></tr>
                <tr><td>RPT-010</td><td>СПУР (сводный план/факт)</td><td>Месяц</td><td>25.02.26</td><td><button class="toolBtn" onclick="swTab(document.querySelector('#sec-reports .tabRow .tab:nth-child(4)'),'rep4')">Открыть</button></td></tr>
                <tr><td>RPT-020</td><td>Форма КМ-6</td><td>День</td><td>26.02.26</td><td><button class="toolBtn" onclick="showMsg('Форма КМ-6 за 26.02.26')">Открыть</button></td></tr>
                <tr><td>RPT-030</td><td>Температурные нарушения</td><td>Смена</td><td>27.02.26 15:18</td><td><button class="toolBtn" onclick="showMsg('Отчёт по температурным нарушениям')">Открыть</button></td></tr>
                <tr><td>RPT-040</td><td>Персонал / Табель</td><td>Месяц</td><td>01.02.26</td><td><button class="toolBtn" onclick="showMsg('Табель за февраль 2026')">Открыть</button></td></tr>
                <tr><td>RPT-050</td><td>Инвентаризационный</td><td>Дата</td><td>27.02.26 09:00</td><td><button class="toolBtn" onclick="showMsg('Инвентаризация 27.02.26')">Открыть</button></td></tr>
                <tr><td>RPT-060</td><td>Экстренные ситуации</td><td>Период</td><td>27.02.26</td><td><button class="toolBtn" onclick="nav('emergency')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="rep2" class="tabContent">
              <div class="reportHeader"><table><tr><td><strong>СМЕННЫЙ ОТЧЁТ — ПБО 23702</strong></td><td>Смена: #0847</td></tr><tr><td>Менеджер: Смирнова Е.В. / Плехов Л.А.</td><td>27.02.2026, 08:00 — текущая</td></tr></table></div>
              <table class="dataTable">
                <tr><th colspan="2" style="background:#4060a0;">ВЫРУЧКА</th></tr>
                <tr><td>Наличные</td><td class="num">47 820 &#8381;</td></tr>
                <tr><td>Карты</td><td class="num">108 400 &#8381;</td></tr>
                <tr><td>QR/СБП</td><td class="num">27 200 &#8381;</td></tr>
                <tr><td><strong>ИТОГО</strong></td><td class="num bold">183 420 &#8381;</td></tr>
                <tr><th colspan="2" style="background:#4060a0;">ЧЕКИ</th></tr>
                <tr><td>Количество</td><td class="num">429</td></tr>
                <tr><td>Средний чек</td><td class="num">427.55 &#8381;</td></tr>
                <tr><td>Возвратов</td><td class="num">2 (−250 &#8381;)</td></tr>
                <tr><th colspan="2" style="background:#4060a0;">КАССА</th></tr>
                <tr><td>Стартовая сумма</td><td class="num">30 000 &#8381;</td></tr>
                <tr><td>Изъятий</td><td class="num">3 (−35 000 &#8381;)</td></tr>
                <tr><td>Остаток</td><td class="num">47 820 &#8381;</td></tr>
              </table>
              <button class="toolBtn" style="margin-top:6px;" onclick="showMsg('Z-отчёт отправлен на печать')">Печать Z-отчёта</button>
            </div>
            <div id="rep3" class="tabContent">
              <div class="reportHeader"><table><tr><td><strong>МЕСЯЧНЫЙ ОТЧЁТ — ПБО 23702</strong></td><td>Февраль 2026</td></tr></table></div>
              <table class="dataTable">
                <tr><th>Показатель</th><th class="num">План</th><th class="num">Факт</th><th class="num">%</th></tr>
                <tr><td>Выручка, &#8381;</td><td class="num">4 800 000</td><td class="num">4 980 600</td><td class="num green">103.8</td></tr>
                <tr><td>Кол-во чеков</td><td class="num">11 000</td><td class="num">11 642</td><td class="num green">105.8</td></tr>
                <tr><td>Средний чек, &#8381;</td><td class="num">436</td><td class="num">428</td><td class="num orange">98.2</td></tr>
                <tr><td>Себестоимость, &#8381;</td><td class="num">1 700 000</td><td class="num">1 843 400</td><td class="num red">108.4</td></tr>
                <tr><td>Расходы, &#8381;</td><td class="num">310 000</td><td class="num">284 710</td><td class="num green">91.8</td></tr>
                <tr><td>Валовая прибыль, &#8381;</td><td class="num">2 790 000</td><td class="num">2 852 490</td><td class="num green">102.2</td></tr>
              </table>
            </div>
            <div id="rep4" class="tabContent">
              <div class="reportHeader"><table><tr><td><strong>СПУР — ПБО 23702 — Февраль 2026</strong></td><td>Менеджер: Смирнова Е.В. / Плехов Л.А.</td></tr></table></div>
              <table class="dataTable">
                <tr><th>Период</th><th class="num">Выручка &#8381;</th><th class="num">Чеков</th><th class="num">Ср.чек &#8381;</th><th class="num">% к плану</th></tr>
                <tr><td>Неделя 1 (01–07)</td><td class="num">1 142 400</td><td class="num">2 721</td><td class="num">420</td><td class="num green">102.1</td></tr>
                <tr><td>Неделя 2 (08–14)</td><td class="num">1 284 600</td><td class="num">2 984</td><td class="num">430</td><td class="num green">104.8</td></tr>
                <tr><td>Неделя 3 (15–21)</td><td class="num">1 188 200</td><td class="num">2 808</td><td class="num">423</td><td class="num green">101.1</td></tr>
                <tr><td>Неделя 4 (22–27)</td><td class="num">1 365 400</td><td class="num">3 129</td><td class="num">436</td><td class="num green">107.3</td></tr>
                <tr><td><strong>ИТОГО</strong></td><td class="num bold">4 980 600</td><td class="num bold">11 642</td><td class="num bold">428</td><td class="num green bold">103.8</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== DOCUMENTS ===== -->
        <div id="sec-documents" class="contentPanel section">
          <div class="panelTitle">Документы <span>ПБО 23702</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'doc1')">Все документы</div>
              <div class="tab" onclick="swTab(this,'doc2')">Регламенты</div>
              <div class="tab" onclick="swTab(this,'doc3')">Журналы</div>
              <div class="tab" onclick="swTab(this,'doc4')">Создать документ</div>
            </div>
            <div id="doc1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <select class="formSelect"><option>Все типы</option><option>Приказ</option><option>Акт</option><option>Накладная</option><option>Регламент</option><option>Журнал</option></select>
                <input class="formInput" type="text" placeholder="Поиск документа..." style="width:160px;">
                <button class="toolBtn">Найти</button>
                <button class="toolBtn" onclick="swTab(document.querySelector('#sec-documents .tabRow .tab:last-child'),'doc4')">Создать</button>
              </div>
              <table class="dataTable">
                <tr><th>Дата</th><th>№</th><th>Тип</th><th>Наименование</th><th>Автор</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>27.02.26</td><td>АКТ-1019</td><td>Акт</td><td>Замена фильтра вытяжки</td><td>Смирнова Е.В.</td><td class="green">Подписан</td><td><button class="toolBtn" onclick="showMsg('Документ АКТ-1019')">Открыть</button></td></tr>
                <tr><td>27.02.26</td><td>П-4472</td><td>Накладная</td><td>Приходная накладная SPAR</td><td>Система</td><td class="green">Проведена</td><td><button class="toolBtn" onclick="showMsg('Накладная П-4472')">Открыть</button></td></tr>
                <tr><td>26.02.26</td><td>ПРК-118</td><td>Приказ</td><td>О проведении инвентаризации</td><td>Смирнова Е.В.</td><td class="green">Исполнен</td><td><button class="toolBtn" onclick="showMsg('Приказ ПРК-118')">Открыть</button></td></tr>
                <tr><td>26.02.26</td><td>ЖТН-027</td><td>Журнал</td><td>Журнал температурного контроля</td><td>Козлов Д.И.</td><td class="orange">Заполняется</td><td><button class="toolBtn" onclick="showMsg('Журнал ЖТН-027')">Открыть</button></td></tr>
                <tr><td>25.02.26</td><td>СП-1012</td><td>Акт</td><td>Акт списания продукции</td><td>Смирнова Е.В.</td><td class="green">Подписан</td><td><button class="toolBtn" onclick="showMsg('Акт СП-1012')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="doc2" class="tabContent">
              <table class="dataTable">
                <tr><th>Код</th><th>Наименование регламента</th><th>Версия</th><th>Дата обновл.</th><th>Обязателен</th><th>Действие</th></tr>
                <tr><td>REG-001</td><td>Санитарно-гигиенические нормы</td><td>v3.2</td><td>01.01.26</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-001')">Открыть</button></td></tr>
                <tr><td>REG-002</td><td>Пожарная безопасность</td><td>v2.1</td><td>01.09.25</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-002')">Открыть</button></td></tr>
                <tr><td>REG-003</td><td>Инструкция по работе с POS</td><td>v5.0</td><td>15.10.25</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-003')">Открыть</button></td></tr>
                <tr><td>REG-004</td><td>Порядок приёма поставок</td><td>v2.3</td><td>01.01.26</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-004')">Открыть</button></td></tr>
                <tr><td>REG-005</td><td>Температурный контроль продуктов</td><td>v1.8</td><td>01.01.26</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-005')">Открыть</button></td></tr>
                <tr><td>REG-006</td><td>Порядок экстренного закрытия</td><td>v1.0</td><td>01.01.26</td><td><input type="checkbox" checked disabled></td><td><button class="toolBtn" onclick="showMsg('Регламент REG-006')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="doc3" class="tabContent">
              <table class="dataTable">
                <tr><th>Журнал</th><th>Ответственный</th><th>Последняя запись</th><th>Статус</th><th>Действие</th></tr>
                <tr><td>Журнал температурного контроля</td><td>Козлов Д.И.</td><td>27.02.26 14:00</td><td class="green">Ведётся</td><td><button class="toolBtn" onclick="showMsg('Журнал температур открыт')">Открыть</button></td></tr>
                <tr><td>Журнал инструктажей по ТБ</td><td>Смирнова Е.В.</td><td>01.02.26</td><td class="orange">Требует записи</td><td><button class="toolBtn" onclick="showMsg('Журнал ТБ открыт')">Открыть</button></td></tr>
                <tr><td>Журнал уборки</td><td>Морозова Т.Н.</td><td>27.02.26 12:00</td><td class="green">Ведётся</td><td><button class="toolBtn" onclick="showMsg('Журнал уборки открыт')">Открыть</button></td></tr>
                <tr><td>Журнал кассовых операций</td><td>Смирнова Е.В.</td><td>27.02.26 15:57</td><td class="green">Ведётся</td><td><button class="toolBtn" onclick="nav('cash')">Открыть</button></td></tr>
                <tr><td>Журнал экстренных ситуаций</td><td>Смирнова Е.В.</td><td>27.02.26 10:00</td><td class="green">Ведётся</td><td><button class="toolBtn" onclick="nav('emergency')">Открыть</button></td></tr>
              </table>
            </div>
            <div id="doc4" class="tabContent">
              <div style="max-width:420px;">
                <div class="formRow"><label>Тип документа:</label><select class="formSelect" id="docType" style="width:180px;"><option>Акт</option><option>Приказ</option><option>Служебная записка</option><option>Заявление</option><option>Прочее</option></select></div>
                <div class="formRow"><label>Наименование:</label><input class="formInput" type="text" id="docName" style="width:250px;"></div>
                <div class="formRow"><label>Ответственный:</label><select class="formSelect" id="docResp" style="width:180px;"><option>Смирнова Е.В.</option><option>Плехов Л.А.</option><option>Козлов Д.И.</option></select></div>
                <div class="formRow"><label>Дата:</label><input class="formInput" type="text" id="docDate" value="27.02.2026" style="width:100px;"></div>
                <div style="margin-bottom:3px;font-size:10px;">Содержание:</div>
                <textarea class="formTextarea" id="docContent" style="width:100%;height:80px;"></textarea>
                <div style="margin-top:5px;display:flex;gap:4px;">
                  <button class="toolBtn" onclick="saveDocument()">Создать документ</button>
                  <button class="toolBtn" onclick="showMsg('Форма очищена')">Очистить</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ===== EMERGENCY ===== -->
        <div id="sec-emergency" class="contentPanel section">
          <div class="panelTitle" style="background:#a00000;">Экстренные ситуации — ПБО 23702 <span id="emgCount">Активных: 0</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'emg1')">Журнал ситуаций</div>
              <div class="tab" onclick="swTab(this,'emg2')">Внести ситуацию</div>
              <div class="tab" onclick="swTab(this,'emg3')">Экстренные контакты</div>
            </div>
            <div id="emg1" class="tabContent active">
              <div style="display:flex;gap:3px;margin-bottom:4px;">
                <select class="formSelect" id="emgTypeFilter"><option value="">Все типы</option><option value="fire">Пожар</option><option value="medical">Медицинская</option><option value="kitchen">Кухня</option><option value="safety">Безопасность</option><option value="tech">Техническая</option><option value="other">Прочее</option></select>
                <select class="formSelect" id="emgStatusFilter"><option value="">Все статусы</option><option value="open">Открытые</option><option value="closed">Закрытые</option></select>
                <button class="toolBtn" onclick="renderEmergencyList()">Обновить</button>
              </div>
              <table class="dataTable">
                <tr><th>Время</th><th>Тип</th><th>Место</th><th>Описание</th><th>Менеджер</th><th>Статус</th><th>Действие</th></tr>
              </table>
              <div id="emgListBody"></div>
            </div>
            <div id="emg2" class="tabContent">
              <div style="max-width:480px;">
                <div style="background:#a00000;color:#fff;font-size:10px;font-weight:bold;padding:3px 6px;margin-bottom:8px;">ВНЕСЕНИЕ ЭКСТРЕННОЙ СИТУАЦИИ</div>
                <div class="formRow"><label>Тип ситуации:</label><select class="formSelect" id="emgType" style="width:200px;">
                  <option value="fire">Пожар / Задымление</option>
                  <option value="medical">Медицинская ситуация</option>
                  <option value="kitchen" selected>Нарушение на кухне</option>
                  <option value="safety">Нарушение безопасности</option>
                  <option value="tech">Технический отказ</option>
                  <option value="hygiene">Санитарное нарушение</option>
                  <option value="theft">Кража / Недостача</option>
                  <option value="temp">Температурное нарушение</option>
                  <option value="conflict">Конфликт с посетителем</option>
                  <option value="other">Прочее</option>
                </select></div>
                <div class="formRow"><label>Место:</label><select class="formSelect" id="emgPlace" style="width:180px;">
                  <option>Кухня (горячий цех)</option>
                  <option>Кухня (холодный цех)</option>
                  <option>Зал для посетителей</option>
                  <option>Касса / POS</option>
                  <option>Склад / Холодильник</option>
                  <option>Drive-thru</option>
                  <option>Туалет</option>
                  <option>Служебное помещение</option>
                  <option>Весь ресторан</option>
                </select></div>
                <div class="formRow"><label>Уровень серьёзности:</label><select class="formSelect" id="emgSeverity" style="width:150px;">
                  <option value="low">Низкий</option>
                  <option value="medium" selected>Средний</option>
                  <option value="high">Высокий</option>
                  <option value="critical">КРИТИЧЕСКИЙ</option>
                </select></div>
                <div class="formRow"><label>Описание:</label></div>
                <textarea class="formTextarea" id="emgDesc" style="width:100%;height:70px;margin-bottom:5px;" placeholder="Подробное описание ситуации..."></textarea>
                <div class="formRow"><label>Принятые меры:</label></div>
                <textarea class="formTextarea" id="emgActions" style="width:100%;height:50px;margin-bottom:5px;" placeholder="Какие меры приняты..."></textarea>
                <div class="formRow"><label>Вызваны службы:</label>
                  <label><input type="checkbox" id="emgFireDept"> Пожарные</label>
                  <label><input type="checkbox" id="emgMedics"> Скорая</label>
                  <label><input type="checkbox" id="emgPolice"> Полиция</label>
                  <label><input type="checkbox" id="emgRosgvardiya"> Росгвардия</label>
                </div>
                <div class="formRow"><label>PIN менеджера:</label><input class="formInput" type="password" id="emgPin" maxlength="4" style="width:70px;"></div>
                <div style="display:flex;gap:4px;margin-top:6px;">
                  <button class="toolBtnEmg" onclick="submitEmergency()">ЗАФИКСИРОВАТЬ СИТУАЦИЮ</button>
                  <button class="toolBtn" onclick="clearEmgForm()">Очистить</button>
                </div>
              </div>
            </div>
            <div id="emg3" class="tabContent">
              <div style="background:#fff0e0;border:1px solid #c06000;padding:4px 8px;margin-bottom:5px;font-size:10px;font-weight:bold;">ЭКСТРЕННЫЕ НОМЕРА — ПБО 23702</div>
              <table class="dataTable">
                <tr><th>Служба</th><th>Телефон</th><th>Комментарий</th></tr>
                <tr><td class="red bold">Пожарные</td><td class="bold">01 / 101 (моб.)</td><td>При задымлении, пожаре</td></tr>
                <tr><td class="red bold">Скорая помощь</td><td class="bold">03 / 103 (моб.)</td><td>Медицинские ситуации</td></tr>
                <tr><td class="red bold">Полиция</td><td class="bold">02 / 102 (моб.)</td><td>Кражи, конфликты</td></tr>
                <tr><td class="bold">Единый экстр.</td><td class="bold">112</td><td>Все ситуации</td></tr>
                <tr><td>ЦО ВиТ (дежурный)</td><td>+7 (495) 741-00-01</td><td>Круглосуточно</td></tr>
                <tr><td>Технич. поддержка POS</td><td>+7 (495) 741-00-02</td><td>Пн-Вс 07:00-23:00</td></tr>
                <tr><td>Управляющий ПБО</td><td id="managerPhoneDisp">+7 (916) 234-56-78</td><td>Смирнова Е.В.</td></tr>
                <tr><td>Инкассация (Армада)</td><td>+7 (495) 123-45-67</td><td>Экстренная инкассация</td></tr>
                <tr><td>Газовая служба</td><td>04 / 104 (моб.)</td><td>Утечка газа</td></tr>
                <tr><td>Роспотребнадзор</td><td>+7 (495) 787-21-23</td><td>Пищевые инциденты</td></tr>
              </table>
            </div>
          </div>
        </div>

        <!-- ===== SETTINGS ===== -->
        <div id="sec-settings" class="contentPanel section">
          <div class="panelTitle">Настройки системы HoReCaMGR <span>Администратор</span></div>
          <div class="panelBody">
            <div class="tabRow">
              <div class="tab active" onclick="swTab(this,'set1')">Общие</div>
              <div class="tab" onclick="swTab(this,'set2')">Пользователи</div>
              <div class="tab" onclick="swTab(this,'set3')">Печать</div>
              <div class="tab" onclick="swTab(this,'set4')">Уведомления</div>
              <div class="tab" onclick="swTab(this,'set5')">Резервные копии</div>
            </div>
            <div id="set1" class="tabContent active">
              <div class="formRow"><label>Название ПБО:</label><input class="formInput" type="text" value="ПБО 23702 — Москва" style="width:220px;"></div>
              <div class="formRow"><label>Адрес:</label><input class="formInput" type="text" value="г. Москва, ул. Примерная, д.1" style="width:280px;"></div>
              <div class="formRow"><label>ИНН:</label><input class="formInput" type="text" value="7712345678" style="width:110px;"></div>
              <div class="formRow"><label>КПП:</label><input class="formInput" type="text" value="771201001" style="width:90px;"></div>
              <div class="formRow"><label>Часовой пояс:</label><select class="formSelect" style="width:160px;"><option selected>Europe/Moscow (UTC+3)</option></select></div>
              <div class="formRow"><label>Лимит кассы (&#8381;):</label><input class="formInput" type="text" value="50000" style="width:80px;"></div>
              <div class="formRow"><label>Авто-изъятие при:</label><input class="formInput" type="text" value="45000" style="width:80px;"><span style="margin-left:4px;font-size:10px;">&#8381; (0 = отключено)</span></div>
              <div class="formRow"><label>Версия HoReCaMGR:</label><span style="font-size:10px;font-family:'Courier New';">v5.2.1 (build 2026.02.27)</span></div>
              <div style="margin-top:6px;display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Настройки сохранены')">Сохранить</button>
                <button class="toolBtn" onclick="showMsg('Настройки сброшены к умолчаниям')">Сбросить</button>
              </div>
            </div>
            <div id="set2" class="tabContent">
              <table class="dataTable">
                <tr><th>ID</th><th>ФИО</th><th>Роль</th><th>PIN</th><th>Активен</th><th>Последний вход</th><th>Действие</th></tr>
                <tr><td>001042</td><td>Смирнова Е.В.</td><td>Менеджер</td><td>****</td><td><input type="checkbox" checked></td><td>27.02.26 08:00</td><td><button class="toolBtn" onclick="showMsg('Редактирование пользователя')">Ред.</button></td></tr>
                <tr><td>002077</td><td>Плехов Лев Александрович</td><td>Менеджер</td><td>****</td><td><input type="checkbox" checked></td><td>27.02.26 08:00</td><td><button class="toolBtn" onclick="showMsg('Редактирование Плехов Л.А.')">Ред.</button></td></tr>
                <tr><td>001055</td><td>Петров С.А.</td><td>Кассир</td><td>****</td><td><input type="checkbox" checked></td><td>27.02.26 08:05</td><td><button class="toolBtn" onclick="showMsg('Редактирование пользователя')">Ред.</button></td></tr>
                <tr><td>000001</td><td>Администратор системы</td><td>Суперадмин</td><td>****</td><td><input type="checkbox" checked></td><td>01.01.26</td><td><button class="toolBtn" onclick="showMsg('Недостаточно прав')">Ред.</button></td></tr>
              </table>
              <button class="toolBtn" style="margin-top:5px;" onclick="showMsg('Новый пользователь добавлен')">Добавить пользователя</button>
            </div>
            <div id="set3" class="tabContent">
              <div class="formRow"><label>Принтер чеков:</label><select class="formSelect" style="width:200px;"><option>АТОЛ 11Ф (COM1)</option><option>АТОЛ 30Ф (COM2)</option></select></div>
              <div class="formRow"><label>Шрифт чека:</label><select class="formSelect" style="width:120px;"><option>Стандартный</option><option>Крупный</option></select></div>
              <div class="formRow"><label>Логотип на чеке:</label><input type="checkbox" checked> <span style="font-size:10px;">Печатать логотип</span></div>
              <div class="formRow"><label>Слоган на чеке:</label><input class="formInput" type="text" value="Вкусно — и точка!" style="width:200px;"></div>
              <div class="formRow"><label>Принтер отчётов:</label><select class="formSelect" style="width:200px;"><option>HP LaserJet (LPT1)</option><option>Сетевой принтер (\\print01)</option></select></div>
              <button class="toolBtn" style="margin-top:5px;" onclick="showMsg('Настройки печати сохранены')">Сохранить</button>
            </div>
            <div id="set4" class="tabContent">
              <table class="dataTable">
                <tr><th>Событие</th><th>SMS</th><th>Email</th><th>Экран</th><th>Звук</th></tr>
                <tr><td>Лимит кассы превышен</td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
                <tr><td>Остаток склада критический</td><td><input type="checkbox"></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
                <tr><td>POS-терминал отключился</td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
                <tr><td>Температурное нарушение</td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
                <tr><td>Экстренная ситуация</td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td></tr>
              </table>
              <button class="toolBtn" style="margin-top:5px;" onclick="showMsg('Настройки уведомлений сохранены')">Сохранить</button>
            </div>
            <div id="set5" class="tabContent">
              <div class="formRow"><label>Расписание резервной копии:</label><select class="formSelect" style="width:180px;"><option>Ежечасно</option><option selected>Каждые 4 часа</option><option>Ежедневно</option></select></div>
              <div class="formRow"><label>Путь сохранения:</label><input class="formInput" type="text" value="\\backup-srv\pbo23702\" style="width:220px;"></div>
              <div class="formRow"><label>Хранить копий:</label><input class="formInput" type="text" value="30" style="width:50px;"></div>
              <div style="margin-bottom:5px;font-size:10px;">Последняя резервная копия: 27.02.2026 12:00 | Размер: 284 МБ | Статус: <span class="green">OK</span></div>
              <div style="display:flex;gap:4px;">
                <button class="toolBtn" onclick="showMsg('Резервная копия создаётся...')">Создать копию сейчас</button>
                <button class="toolBtn" onclick="showMsg('Список резервных копий')">Список копий</button>
                <button class="toolBtn" onclick="showMsg('Настройки сохранены')">Сохранить настройки</button>
              </div>
            </div>
          </div>
        </div>

      </div><!-- end relative wrapper -->

      <!-- BOTTOM ROW -->
      <div class="bottomRow">
        <div class="infoPanel">
          <div class="panelTitle">Статус системы</div>
          <div class="infoBody">
            <div class="infoRow"><span>ФМ:</span><span class="val green">ONLINE</span></div>
            <div class="infoRow"><span>Сервер БД:</span><span class="val green">ONLINE</span></div>
            <div class="infoRow"><span>1С-синхр.:</span><span class="val green">ОК 16:00</span></div>
            <div class="infoRow"><span>Связь с ЦО:</span><span class="val green">ONLINE</span></div>
            <div class="infoRow"><span>Рез. копия:</span><span class="val orange">12:00</span></div>
          </div>
        </div>
        <div class="infoPanel">
          <div class="panelTitle">Касса</div>
          <div class="infoBody">
            <div class="infoRow"><span>Наличные:</span><span class="val orange" id="btmCash">47 820 &#8381;</span></div>
            <div class="infoRow"><span>Лимит:</span><span class="val">50 000 &#8381;</span></div>
            <div class="infoRow"><span>Безнал:</span><span class="val">108 400 &#8381;</span></div>
            <div class="infoRow"><span>QR/СБП:</span><span class="val">27 200 &#8381;</span></div>
            <div class="infoRow"><span>Итого:</span><span class="val green">183 420 &#8381;</span></div>
          </div>
        </div>
        <div class="infoPanel">
          <div class="panelTitle">Алерты <span id="alertCountBtm"></span></div>
          <div class="infoBody" id="alertsBody">
            <div class="infoRow"><span class="red">!! Витрина #2: +6.8°C</span></div>
            <div class="infoRow"><span class="red">! POS-04: Ошибка ФР</span></div>
            <div class="infoRow"><span class="orange">Булочки б/г: 28 шт</span></div>
            <div class="infoRow"><span class="orange">Масло фритюр: замена</span></div>
            <div class="infoRow"><span class="orange">Рекомендовано изъятие</span></div>
          </div>
        </div>
        <div class="infoPanel">
          <div class="panelTitle">Смена #0847</div>
          <div class="infoBody">
            <div class="infoRow"><span>На смене:</span><span class="val">14 / 16</span></div>
            <div class="infoRow"><span>Чеков:</span><span class="val" id="btmChecks">429</span></div>
            <div class="infoRow"><span>Ср.обслуж.:</span><span class="val green">2:34</span></div>
            <div class="infoRow"><span>Изъятий:</span><span class="val">3</span></div>
            <div class="infoRow"><span>Экстренных:</span><span class="val" id="btmEmg">0</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MENU BAR (BOTTOM) -->
  <div class="menuBar">
    <div style="font-size:10px;font-weight:bold;padding:2px 8px;border-right:1px solid #808080;margin-right:4px;">HoReCaMGR</div>
    <div class="menuItem" id="mi-file">Файл
      <div class="dropdown">
        <div class="dropItem" onclick="printZReport()">Z-отчёт...</div>
        <div class="dropItem" onclick="showMsg('X-отчёт напечатан')">X-отчёт...</div>
        <div class="dropSep"></div>
        <div class="dropItem" onclick="showMsg('Экспорт данных в Excel')">Экспорт в Excel...</div>
        <div class="dropItem" onclick="showMsg('Печать')">Печать...</div>
        <div class="dropSep"></div>
        <div class="dropItem" onclick="logout()">Выход из системы</div>
      </div>
    </div>
    <div class="menuItem" id="mi-mgmt">Управление
      <div class="dropdown">
        <div class="dropItem" onclick="nav('pos')">Терминалы POS</div>
        <div class="dropItem" onclick="nav('pos-settings')">Настройка POS</div>
        <div class="dropSep"></div>
        <div class="dropItem" onclick="openCashModal('out')">Изъятие наличных...</div>
        <div class="dropItem" onclick="openCashModal('in')">Внесение наличных...</div>
        <div class="dropSep"></div>
        <div class="dropItem" onclick="transferShift()">Передача смены...</div>
        <div class="dropItem" onclick="emergencyCloseShift()">Экстренное закрытие смены...</div>
      </div>
    </div>
    <div class="menuItem" id="mi-fin">Финансы
      <div class="dropdown">
        <div class="dropItem" onclick="nav('cash')">Касса</div>
        <div class="dropItem" onclick="nav('expenses')">Учёт расходов</div>
        <div class="dropItem" onclick="nav('accounting')">Бухгалтерия</div>
        <div class="dropItem" onclick="nav('reports')">Отчёты</div>
      </div>
    </div>
    <div class="menuItem" id="mi-stock">Склад
      <div class="dropdown">
        <div class="dropItem" onclick="nav('inventory')">Инвентаризация</div>
        <div class="dropItem" onclick="nav('orders')">Заявки / Поставки</div>
        <div class="dropItem" onclick="swTabAndNav('inventory','inv3')">Списание продуктов...</div>
      </div>
    </div>
    <div class="menuItem" id="mi-sales">Продажи
      <div class="dropdown">
        <div class="dropItem" onclick="nav('sales')">Лента чеков</div>
        <div class="dropItem" onclick="swTabAndNav('sales','sal2')">Внести покупку...</div>
        <div class="dropItem" onclick="nav('menu-settings')">Настройка меню</div>
      </div>
    </div>
    <div class="menuItem" id="mi-hr">Персонал
      <div class="dropdown">
        <div class="dropItem" onclick="nav('staff')">Сотрудники</div>
        <div class="dropItem" onclick="nav('shift')">Управление сменой</div>
      </div>
    </div>
    <div class="menuItem" id="mi-emg">!! Экстренные
      <div class="dropdown">
        <div class="dropItem" onclick="nav('emergency')" style="color:#c00000;font-weight:bold;">Журнал ситуаций</div>
        <div class="dropItem" onclick="swTabAndNav('emergency','emg2')" style="color:#c00000;">Внести ситуацию...</div>
        <div class="dropSep"></div>
        <div class="dropItem" onclick="emergencyCloseShift()">Экстренное закрытие...</div>
      </div>
    </div>
    <div class="menuItem" id="mi-srv">Сервис
      <div class="dropdown">
        <div class="dropItem" onclick="nav('settings')">Настройки системы...</div>
        <div class="dropItem" onclick="showMsg('Журнал событий системы')">Журнал событий...</div>
        <div class="dropItem" onclick="showMsg('Диагностика: все системы OK')">Диагностика...</div>
        <div class="dropItem" onclick="showMsg('HoReCaMGR v5.2.1 — Система управления рестораном ПБО 23702')">О программе...</div>
      </div>
    </div>
    <div style="flex:1;"></div>
    <div style="font-size:10px;padding:2px 8px;display:flex;align-items:center;">
      <span id="clockDisplayBottom" style="font-family:'Courier New',monospace;"></span>
    </div>
  </div>

  <!-- STATUS BAR -->
  <div class="statusBar">
    <div class="cell" id="statusLeft">Готово</div>
    <div class="cell">ПБО 23702 | <span id="statusMgr">—</span></div>
    <div class="cell">Смена #0847</div>
    <div class="cell" id="statusTime">—</div>
    <div style="flex:1;"></div>
    <div class="cell">RU-MSK-POS-07</div>
    <div class="cell">HoReCaMGR v5.2.1</div>
  </div>

  <!-- HELP BAR -->
  <div class="helpBar" id="helpBar">F1=Справка | F2=POS-терминалы | F3=Касса | F5=Обновить | F7=Поиск | F9=Экстренная ситуация | F10=Меню</div>

</div><!-- end app -->

<!-- ===== DIALOG ===== -->
<div class="dlg" id="mainDlg">
  <div class="dlgBox" id="dlgBox">
    <div class="titleBar" id="dlgTitle">Сообщение</div>
    <div class="dlgBody" id="dlgBody"></div>
    <div class="dlgBtns" id="dlgBtns">
      <button class="dlgBtn" onclick="closeDlg()">ОК</button>
    </div>
  </div>
</div>

<script>
// ===================================================================
//  DATA LAYER (localStorage)
// ===================================================================
const LS = {
  get: k => { try { return JSON.parse(localStorage.getItem('horecamgr_'+k)||'null'); } catch(e){return null;} },
  set: (k,v) => { try { localStorage.setItem('horecamgr_'+k, JSON.stringify(v)); } catch(e){} },
};

function initData() {
  if (!LS.get('inventory')) {
    LS.set('inventory', [
      {code:'P0042', name:'Булочки б/г', unit:'шт', norm:120, qty:28, expiry:'27.02.26', supplier:'АО "SPAR"'},
      {code:'P0043', name:'Булочки с/з', unit:'шт', norm:80, qty:74, expiry:'28.02.26', supplier:'АО "SPAR"'},
      {code:'M0010', name:'Котлета говяжья 57г', unit:'кг', norm:15, qty:18.4, expiry:'01.03.26', supplier:'АО "SPAR"'},
      {code:'M0011', name:'Куриное филе', unit:'кг', norm:12, qty:14.8, expiry:'28.02.26', supplier:'АО "SPAR"'},
      {code:'D0031', name:'Coca-Cola 0.5л', unit:'шт', norm:200, qty:52, expiry:'01.12.26', supplier:'ООО "Прод-Сервис"'},
      {code:'D0032', name:'Sprite 0.5л', unit:'шт', norm:100, qty:88, expiry:'01.12.26', supplier:'ООО "Прод-Сервис"'},
      {code:'S0004', name:'Кетчуп порционный', unit:'шт', norm:500, qty:421, expiry:'01.09.26', supplier:'ООО "МакСнаб"'},
      {code:'F0018', name:'Масло фритюр', unit:'л', norm:20, qty:6.2, expiry:'—', supplier:'ООО "МакСнаб"'},
      {code:'C0001', name:'Смесь МакФлури', unit:'кг', norm:8, qty:1.8, expiry:'27.02.26', supplier:'АО "SPAR"'},
      {code:'P0088', name:'Картофель фри заморож.', unit:'кг', norm:50, qty:42.6, expiry:'01.06.26', supplier:'АО "SPAR"'},
    ]);
  }
  if (!LS.get('emergencies')) LS.set('emergencies', []);
  if (!LS.get('cashHistory')) LS.set('cashHistory', [
    {id:4821, dt:'27.02 15:57', pos:'POS-01', type:'Изъятие', sum:15000, mgr:'Смирнова Е.В.', note:'Плановое'},
    {id:4820, dt:'27.02 13:10', pos:'POS-03', type:'Изъятие', sum:10000, mgr:'Смирнова Е.В.', note:'Плановое'},
    {id:4819, dt:'27.02 09:00', pos:'Все', type:'Внесение', sum:30000, mgr:'Смирнова Е.В.', note:'Размен'},
  ]);
  if (!LS.get('shiftLog')) LS.set('shiftLog', [
    {time:'09:00:00', event:'ОТКРЫТИЕ', user:'Смирнова Е.В.', desc:'Смена #0847 открыта, внесено 30 000 ₽'},
    {time:'09:05:12', event:'АКТИВАЦИЯ POS', user:'Система', desc:'Запущены терминалы POS-01…10'},
    {time:'10:15:33', event:'ИЗЪЯТИЕ', user:'Смирнова Е.В.', desc:'Изъятие с POS-05: 10 000 ₽'},
    {time:'11:30:08', event:'ПРИХОД', user:'Смирнова Е.В.', desc:'Накладная №П-4471 принята'},
    {time:'13:10:14', event:'ИЗЪЯТИЕ', user:'Смирнова Е.В.', desc:'Изъятие с POS-03: 10 000 ₽'},
    {time:'14:18:44', event:'АЛЕРТ ТЕМП', user:'Система', desc:'Витрина #2: превышение температуры +6.8°C'},
    {time:'14:55:02', event:'АЛЕРТ POS', user:'Система', desc:'POS-04: потеря связи с ФР'},
    {time:'15:57:41', event:'ИЗЪЯТИЕ', user:'Смирнова Е.В.', desc:'Изъятие с POS-01: 15 000 ₽'},
  ]);
  if (!LS.get('sales')) LS.set('sales', [
    {num:4910, time:'16:03', pos:'POS-03', cashier:'Иванова А.М.', sum:512, pay:'Карта', status:'OK'},
    {num:4909, time:'16:02', pos:'POS-01', cashier:'Петров С.А.', sum:380, pay:'Наличные', status:'OK'},
    {num:4908, time:'16:01', pos:'POS-05', cashier:'Самообс.', sum:690, pay:'Карта', status:'OK'},
    {num:4907, time:'16:00', pos:'POS-02', cashier:'Сидорова М.', sum:-250, pay:'Карта', status:'ВОЗВРАТ'},
    {num:4906, time:'15:58', pos:'POS-06', cashier:'Самообс.', sum:1240, pay:'QR', status:'OK'},
    {num:4905, time:'15:55', pos:'POS-03', cashier:'Иванова А.М.', sum:349, pay:'Наличные', status:'OK'},
  ]);
  if (!LS.get('stopList')) LS.set('stopList', []);
  if (!LS.get('woHistory')) LS.set('woHistory', []);
  if (!LS.get('orderItems')) LS.set('orderItems', []);
  if (!LS.get('documents')) LS.set('documents', []);
  if (!LS.get('expenses')) LS.set('expenses', [
    {date:'27.02', code:'EXP-4812', desc:'Моющие средства', cat:'Хоз.', sum:3420, doc:'Накл.№1248', status:'Проведён'},
    {date:'27.02', code:'EXP-4811', desc:'Замена фильтра', cat:'Техобслуж.', sum:8900, doc:'АКТ-1019', status:'Проведён'},
    {date:'26.02', code:'EXP-4810', desc:'Канцелярия', cat:'Офисные', sum:1250, doc:'Чек №884', status:'Проведён'},
    {date:'26.02', code:'EXP-4809', desc:'ТО холодильного об.', cat:'Техобслуж.', sum:15600, doc:'АКТ-1018', status:'На согласов.'},
  ]);
}

// ===================================================================
//  AUTH
// ===================================================================
let pinValue = '';
let loginAttempts = 0;
let currentMgrId = '';
let currentMgrName = '';
const MANAGERS = {
  '001042': {pin:'1042', name:'Смирнова Евгения Владимировна', short:'Смирнова Е.В.'},
  '002077': {pin:'7722', name:'Плехов Лев Александрович', short:'Плехов Л.А.'},
  '001055': {pin:'5566', name:'Петров Сергей Алексеевич', short:'Петров С.А.'},
  '000001': {pin:'1234', name:'Администратор системы', short:'Администратор'},
};

function pinPress(d) {
  if (pinValue.length < 4) { pinValue += d; document.getElementById('pinInput').value = '*'.repeat(pinValue.length); }
  if (pinValue.length === 4) setTimeout(pinConfirm, 80);
}
function pinBackspace() { pinValue = pinValue.slice(0,-1); document.getElementById('pinInput').value = '*'.repeat(pinValue.length); }
function pinClear() { pinValue=''; document.getElementById('pinInput').value=''; document.getElementById('pinError').textContent=''; }
function pinCancel() { pinClear(); document.getElementById('managerID').value=''; }

function pinConfirm() {
  const id = document.getElementById('managerID').value.trim();
  if (!id) { document.getElementById('pinError').textContent='Введите ID менеджера!'; return; }
  const mgr = MANAGERS[id];
  if (mgr && pinValue === mgr.pin) {
    currentMgrId = id; currentMgrName = mgr.short;
    document.getElementById('mgrName').textContent = mgr.short + ' (#'+id+')';
    document.getElementById('managerDisplay').textContent = mgr.name + ' | ID: '+id;
    document.getElementById('statusMgr').textContent = mgr.short;
    document.getElementById('pinOverlay').style.display='none';
    document.getElementById('app').style.display='flex';
    initData();
    startClock();
    buildPOSGrid();
    renderSalesTable();
    renderInvTable();
    renderShiftLog();
    renderCashHistory();
    renderEmergencyList();
    renderWOHistory();
    renderInvCheckTable();
    loginAttempts = 0;
    logShift(currentNow(),'ВХОД',''+mgr.short,'Авторизация в системе ID:'+id);
  } else {
    loginAttempts++;
    const msg = loginAttempts >= 3 ? 'Аккаунт заблокирован. Обратитесь к администратору.' : 'Неверный ID или PIN. Попытка '+loginAttempts+'/3.';
    document.getElementById('pinError').textContent = msg;
    pinValue=''; document.getElementById('pinInput').value='';
  }
}

function logout() {
  logShift(currentNow(),'ВЫХОД',''+currentMgrName,'Выход из системы');
  pinValue=''; loginAttempts=0; currentMgrId=''; currentMgrName='';
  document.getElementById('pinInput').value=''; document.getElementById('pinError').textContent='';
  document.getElementById('managerID').value='';
  document.getElementById('pinOverlay').style.display='flex';
  document.getElementById('app').style.display='none';
}

// ===================================================================
//  CLOCK
// ===================================================================
let clockInterval = null;
function startClock() {
  if (clockInterval) clearInterval(clockInterval);
  updateClock();
  clockInterval = setInterval(updateClock, 1000);
}
function updateClock() {
  const now = new Date();
  const t = now.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  const d = now.toLocaleDateString('ru-RU');
  document.getElementById('clockDisplay').textContent = d+' '+t;
  document.getElementById('clockDisplayBottom').textContent = d+' '+t;
  document.getElementById('statusTime').textContent = t;
  const h=now.getHours(), m=now.getMinutes();
  const start=8*60, cur=h*60+m, dur=cur-start;
  if(dur>=0) document.getElementById('shiftDur').textContent=Math.floor(dur/60)+'ч '+('0'+(dur%60)).slice(-2)+'м';
}
function currentNow() {
  const now=new Date();
  return now.toLocaleTimeString('ru-RU',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}

// ===================================================================
//  NAVIGATION
// ===================================================================
function nav(id) {
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  const el = document.getElementById('sec-'+id);
  if(el) el.classList.add('active');
  document.querySelectorAll('.navItem').forEach(n=>n.classList.remove('active'));
  const ni = document.getElementById('nav-'+id);
  if(ni) ni.classList.add('active');
  document.getElementById('statusLeft').textContent = 'Раздел: '+id;
  document.getElementById('helpBar').textContent = 'Раздел: '+id.toUpperCase()+' | F1=Справка | F5=Обновить | F9=Экстренная ситуация | F10=Меню';
  closeMenus();
  if(id==='menu-settings') {
    setTimeout(()=>{
      renderFullMenuTable();
      renderPriceTable();
      fillStopMenuSel();
      renderStopList();
    }, 30);
  }
}
function swTabAndNav(section, tabId) { nav(section); setTimeout(()=>{ const tab=document.getElementById(tabId); if(tab) { const allTabs=tab.parentElement?.previousElementSibling?.querySelectorAll('.tab'); if(allTabs){allTabs.forEach(t=>t.classList.remove('active')); const ts=tab.parentElement?.previousElementSibling?.querySelectorAll('.tab'); } const allC=tab.parentElement?.querySelectorAll('.tabContent'); if(allC)allC.forEach(c=>c.classList.remove('active')); tab.classList.add('active'); } },50); }

function swTab(tabEl, contentId) {
  const parent = tabEl.parentElement;
  parent.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  tabEl.classList.add('active');
  const container = parent.parentElement;
  container.querySelectorAll('.tabContent').forEach(c=>c.classList.remove('active'));
  const target = document.getElementById(contentId);
  if(target) target.classList.add('active');
}

// ===================================================================
//  MENUS
// ===================================================================
function closeMenus() { document.querySelectorAll('.menuItem').forEach(m=>m.classList.remove('mopen')); }
document.querySelectorAll('.menuItem').forEach(mi=>{
  mi.addEventListener('click', e => {
    const isOpen = mi.classList.contains('mopen');
    closeMenus();
    if(!isOpen) mi.classList.add('mopen');
    e.stopPropagation();
  });
});
document.addEventListener('click', closeMenus);

// ===================================================================
//  DIALOG
// ===================================================================
function showMsg(msg, body='', btns=null) {
  document.getElementById('dlgTitle').textContent = msg;
  document.getElementById('dlgBody').innerHTML = body || '<p>'+msg+'</p>';
  const bb = document.getElementById('dlgBtns');
  if(btns) { bb.innerHTML = btns; }
  else { bb.innerHTML = '<button class="dlgBtn" onclick="closeDlg()">ОК</button>'; }
  document.getElementById('mainDlg').classList.add('dlgOpen');
}
function closeDlg() { document.getElementById('mainDlg').classList.remove('dlgOpen'); }

// ===================================================================
//  POS GRID
// ===================================================================
const POS_DATA = [
  {id:'POS-01',status:'online',zone:'Касса 1',checks:52},
  {id:'POS-02',status:'online',zone:'Касса 2',checks:48},
  {id:'POS-03',status:'online',zone:'Drive-thru',checks:71},
  {id:'POS-04',status:'offline',zone:'Касса 4',checks:0,err:'Ошибка ФР'},
  {id:'POS-05',status:'online',zone:'Самообс. 1',checks:63},
  {id:'POS-06',status:'online',zone:'Самообс. 2',checks:57},
  {id:'POS-07',status:'online',zone:'Самообс. 3',checks:44},
  {id:'POS-08',status:'idle',zone:'МакДоставка',checks:0},
  {id:'POS-09',status:'offline',zone:'Касса 9',checks:0,err:'Нет связи'},
  {id:'POS-10',status:'online',zone:'Только карта',checks:29},
];
let selectedPOS = null;
function buildPOSGrid() {
  const g = document.getElementById('posGrid');
  g.innerHTML = '';
  POS_DATA.forEach(p=>{
    const d=document.createElement('div');
    d.className='posTerminal'+(p.status==='offline'?' posOff':'');
    d.setAttribute('data-pos',p.id);
    const color = p.status==='online'?'#00a000':p.status==='offline'?'#c00000':'#b05000';
    const label = p.status==='online'?'ONLINE':p.status==='offline'?'OFFLINE':'IDLE';
    const lc = p.status==='online'?'green':p.status==='offline'?'red':'orange';
    d.innerHTML=`<div class="posNum">${p.id}</div><div class="posDot" style="background:${color}"></div><div class="${lc}">${label}</div><div>${p.zone}</div><div>Чеков: ${p.checks}</div>${p.err?`<div class="red">${p.err}</div>`:''}`;
    d.onclick=()=>{ document.querySelectorAll('.posTerminal').forEach(x=>x.classList.remove('selPOS')); d.classList.add('selPOS'); selectedPOS=p.id; document.getElementById('statusLeft').textContent='Выбран: '+p.id; };
    g.appendChild(d);
  });
}
function posAction(action) {
  if(!selectedPOS && action!=='update') { showMsg('Выберите терминал','<p>Сначала выберите терминал из сетки POS.</p>'); return; }
  const msgs = {restart:'Терминал '+selectedPOS+' перезагружается...',block:'Терминал '+selectedPOS+' заблокирован',unblock:'Терминал '+selectedPOS+' разблокирован',cashout:'Изъятие с '+selectedPOS,print:'X-отчёт напечатан на '+selectedPOS,update:'Обновление ПО запущено',test:'Тест ФР на '+selectedPOS+': ОК'};
  showMsg(msgs[action]||action);
  logShift(currentNow(),'POS '+action.toUpperCase(),''+currentMgrName,'Терминал: '+selectedPOS);
}

// ===================================================================
//  SALES TABLE
// ===================================================================
function renderSalesTable() {
  const sales = LS.get('sales') || [];
  const tb = document.getElementById('salesTable');
  if(!tb) return;
  const rows = sales.map(s=>`<tr><td>${s.num}</td><td>${s.time}</td><td>${s.pos}</td><td>${s.cashier}</td><td class="num ${s.sum<0?'red':''}">${s.sum<0?s.sum+' &#8381;':s.sum+' &#8381;'}</td><td>${s.pay}</td><td class="${s.status==='OK'?'green':s.status==='ВОЗВРАТ'?'orange':'red'}">${s.status}</td><td><button class="toolBtn" onclick="showMsg('Чек #${s.num}')">Открыть</button></td></tr>`).join('');
  tb.innerHTML = '<tr><th>Чек №</th><th>Время</th><th>Терминал</th><th>Кассир</th><th class="num">Сумма &#8381;</th><th>Оплата</th><th>Статус</th><th>Действие</th></tr>' + rows;
}

let saleItems = [];
function addSaleItem() {
  const sel = document.getElementById('saleMenuSel').value.split('|');
  const qty = parseInt(document.getElementById('saleQty').value)||1;
  saleItems.push({code:sel[0],name:sel[1],price:parseInt(sel[2]),qty:qty});
  renderSaleItems();
}
function renderSaleItems() {
  const box = document.getElementById('saleItems');
  if(!saleItems.length){box.innerHTML='<div style="color:#888;font-style:italic;">Позиции не добавлены</div>'; document.getElementById('saleTotalDisp').innerHTML='0 &#8381;'; return;}
  let total=0, html='<table style="width:100%;font-size:10px;"><tr><th>Код</th><th>Наименование</th><th>Цена</th><th>Кол.</th><th>Сумма</th><th></th></tr>';
  saleItems.forEach((item,i)=>{const sum=item.price*item.qty;total+=sum;html+=`<tr><td>${item.code}</td><td>${item.name}</td><td>${item.price} &#8381;</td><td>${item.qty}</td><td>${sum} &#8381;</td><td><button class="toolBtn" onclick="removeSaleItem(${i})">X</button></td></tr>`;});
  html+='</table>';
  box.innerHTML=html;
  document.getElementById('saleTotalDisp').innerHTML=total+' &#8381;';
}
function removeSaleItem(i){saleItems.splice(i,1);renderSaleItems();}
function clearSaleItems(){saleItems=[];renderSaleItems();}
function submitSale() {
  if(!saleItems.length){showMsg('Нет позиций','<p>Добавьте позиции перед оформлением продажи.</p>');return;}
  const total = saleItems.reduce((a,b)=>a+b.price*b.qty,0);
  const pay = document.getElementById('salePayType').value;
  const num = 4900+Math.floor(Math.random()*100);
  const sales = LS.get('sales')||[];
  sales.unshift({num,time:currentNow().slice(0,5),pos:'POS-01',cashier:document.getElementById('saleCashier').value.split(' ')[0],sum:total,pay,status:'OK'});
  LS.set('sales',sales);
  renderSalesTable();
  logShift(currentNow(),'ПРОДАЖА',''+currentMgrName,'Чек #'+num+', '+total+' ₽, '+pay);
  showMsg('Продажа оформлена','<p>Чек #'+num+' на сумму <strong>'+total+' ₽</strong> ('+pay+') успешно проведён.</p>');
  clearSaleItems();
}
function processRefund() {
  const num = document.getElementById('refundNum').value.trim();
  const sum = document.getElementById('refundSum').value.trim();
  if(!num||!sum){showMsg('Заполните все поля','<p>Укажите номер чека и сумму возврата.</p>');return;}
  showMsg('Возврат оформлен','<p>Возврат по чеку #'+num+' на сумму <strong>'+sum+' ₽</strong> проведён.</p>');
  logShift(currentNow(),'ВОЗВРАТ',''+currentMgrName,'Чек #'+num+', '+sum+' ₽');
}

// ===================================================================
//  INVENTORY
// ===================================================================
function renderInvTable() {
  const inv = LS.get('inventory')||[];
  const tb = document.getElementById('invTable');
  if(!tb) return;
  const f = (document.getElementById('invFilter')||{}).value||'';
  const s = ((document.getElementById('invSearch')||{}).value||'').toLowerCase();
  let data = inv;
  if(f==='crit') data = inv.filter(i=>i.qty<=i.norm*0.3);
  else if(f==='low') data = inv.filter(i=>i.qty<i.norm);
  if(s) data = data.filter(i=>i.name.toLowerCase().includes(s)||i.code.toLowerCase().includes(s));
  const rows = data.map(i=>{
    const pct = i.qty/i.norm;
    const st = pct<=0.3?'<span class="red">КРИТИЧНО</span>':pct<1?'<span class="orange">Мало</span>':'<span class="green">OK</span>';
    const qcl = pct<=0.3?'red':pct<1?'orange':'green';
    return `<tr><td>${i.code}</td><td>${i.name}</td><td>${i.unit}</td><td class="num">${i.norm}</td><td class="num ${qcl}">${i.qty}</td><td>${i.expiry}</td><td>${i.supplier}</td><td>${st}</td><td><button class="toolBtn" onclick="editInvItem('${i.code}')">Ред.</button></td></tr>`;
  }).join('');
  tb.innerHTML = '<tr><th>Код</th><th>Наименование</th><th>Ед.</th><th class="num">Норма</th><th class="num">Факт</th><th>Срок год.</th><th>Поставщик</th><th>Статус</th><th>Действие</th></tr>'+rows;
}
function filterInv() { renderInvTable(); }
function editInvItem(code) { showMsg('Редактирование: '+code,'<p>Редактирование позиции '+code+'.<br><br>Функция требует прав менеджера склада.</p>'); }
function renderInvCheckTable() {
  const inv = LS.get('inventory')||[];
  const tb = document.getElementById('invCheckTable');
  if(!tb) return;
  const rows = inv.map(i=>{
    const diff = (Math.random()*4-2).toFixed(1);
    const dcl = diff<0?'red':diff>0?'orange':'green';
    return `<tr><td>${i.code}</td><td>${i.name}</td><td>${i.unit}</td><td class="num">${i.qty}</td><td class="num"><input class="formInput" type="text" value="${i.qty}" style="width:60px;"></td><td class="num ${dcl}">${diff>0?'+':''}${diff}</td><td class="${dcl}">${Math.abs(diff)<0.5?'<span class="green">Норма</span>':'<span class="orange">Откл.</span>'}</td></tr>`;
  }).join('');
  tb.innerHTML='<tr><th>Код</th><th>Наименование</th><th>Ед.</th><th class="num">Учётный остаток</th><th class="num">Фактический остаток</th><th class="num">Отклонение</th><th>Статус</th></tr>'+rows;
}
function startInventory() { showMsg('Инвентаризация начата','<p>Инвентаризация #'+Math.floor(Math.random()*100+200)+' начата.<br>Заполните фактические остатки и нажмите "Сформировать отчёт".</p>'); renderInvCheckTable(); }
let rcvItems = [];
function addRcvItem() {
  const v=document.getElementById('rcvProdSel').value.split('|');
  const qty=document.getElementById('rcvQty').value.trim();
  const exp=document.getElementById('rcvExpiry').value.trim();
  if(!qty){showMsg('Укажите количество');return;}
  rcvItems.push({code:v[0],name:v[1],unit:v[2],qty,expiry:exp});
  renderRcvItems();
}
function renderRcvItems() {
  const box=document.getElementById('rcvItems');
  if(!rcvItems.length){box.innerHTML='<div style="color:#888;font-style:italic;">Добавьте позиции...</div>';return;}
  box.innerHTML='<table style="width:100%;font-size:10px;"><tr><th>Код</th><th>Наим.</th><th>Ед.</th><th>Кол-во</th><th>Срок год.</th></tr>'+rcvItems.map(r=>`<tr><td>${r.code}</td><td>${r.name}</td><td>${r.unit}</td><td>${r.qty}</td><td>${r.expiry||'—'}</td></tr>`).join('')+'</table>';
}
function saveReceiving() {
  if(!rcvItems.length){showMsg('Нет позиций');return;}
  const inv=LS.get('inventory')||[];
  rcvItems.forEach(r=>{const idx=inv.findIndex(i=>i.code===r.code);if(idx>=0)inv[idx].qty+=parseFloat(r.qty)||0;});
  LS.set('inventory',inv);
  logShift(currentNow(),'ПРИХОД',''+currentMgrName,'Накл. '+document.getElementById('rcvDoc').value+', '+rcvItems.length+' позиций');
  showMsg('Товар оприходован','<p>'+rcvItems.length+' позиций успешно оприходованы на склад.</p>');
  rcvItems=[]; renderRcvItems(); renderInvTable();
}
let woItems = [];
function addWOItem() {
  const v=document.getElementById('woSel').value.split('|');
  const qty=document.getElementById('woQty').value.trim();
  if(!qty){showMsg('Укажите количество');return;}
  woItems.push({code:v[0],name:v[1],unit:v[2],qty});
  renderWOItems();
}
function renderWOItems() {
  const box=document.getElementById('writeoffItems');
  if(!woItems.length){box.innerHTML='<div style="color:#888;font-style:italic;">Добавьте позиции для списания...</div>';return;}
  box.innerHTML='<table style="width:100%;font-size:10px;"><tr><th>Код</th><th>Наим.</th><th>Ед.</th><th>Кол-во</th></tr>'+woItems.map(w=>`<tr><td>${w.code}</td><td>${w.name}</td><td>${w.unit}</td><td>${w.qty}</td></tr>`).join('')+'</table>';
}
function saveWriteoff() {
  if(!woItems.length){showMsg('Нет позиций');return;}
  const pin=document.getElementById('woPin').value;
  const mgr=MANAGERS[currentMgrId];
  if(!mgr||pin!==mgr.pin){showMsg('Неверный PIN','<p>Введите корректный PIN менеджера.</p>');return;}
  const inv=LS.get('inventory')||[];
  woItems.forEach(w=>{const idx=inv.findIndex(i=>i.code===w.code);if(idx>=0){inv[idx].qty=Math.max(0,inv[idx].qty-parseFloat(w.qty)||0);}});
  LS.set('inventory',inv);
  const woH=LS.get('woHistory')||[];
  const t=currentNow();
  woItems.forEach(w=>woH.unshift({time:t,name:w.name,qty:w.qty,reason:'Списание',mgr:currentMgrName}));
  LS.set('woHistory',woH);
  logShift(t,'СПИСАНИЕ',''+currentMgrName,woItems.length+' позиций');
  showMsg('Списание оформлено','<p>'+woItems.length+' позиций списано.</p>');
  woItems=[]; renderWOItems(); renderInvTable(); renderWOHistory();
}
function renderWOHistory() {
  const woH=LS.get('woHistory')||[];
  const tb=document.getElementById('woHistTable');
  if(!tb) return;
  tb.innerHTML='<tr><th>Время</th><th>Позиция</th><th class="num">Кол-во</th><th>Причина</th><th>Менеджер</th></tr>'+woH.map(w=>`<tr><td>${w.time}</td><td>${w.name}</td><td class="num">${w.qty}</td><td>${w.reason}</td><td>${w.mgr}</td></tr>`).join('');
}

// ===================================================================
//  CASH
// ===================================================================
function doCashOp(type) {
  const isOut = type==='out';
  const pinId = isOut?'cashOutPin':'cashInPin';
  const sumId = isOut?'cashOutSum':'cashInSum';
  const posId = isOut?'cashOutPos':'cashInPos';
  const pin = document.getElementById(pinId).value;
  const sum = document.getElementById(sumId).value.trim();
  const pos = document.getElementById(posId).value;
  const mgr = MANAGERS[currentMgrId];
  if(!mgr||pin!==mgr.pin){showMsg('Неверный PIN','<p>Введите корректный PIN менеджера.</p>');return;}
  if(!sum||isNaN(sum)){showMsg('Укажите сумму');return;}
  const hist = LS.get('cashHistory')||[];
  const newId = (hist[0]?.id||4821)+1;
  const dt = new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'2-digit'}).slice(0,5)+' '+currentNow().slice(0,5);
  hist.unshift({id:newId,dt,pos,type:isOut?'Изъятие':'Внесение',sum:parseInt(sum),mgr:currentMgrName,note:''});
  LS.set('cashHistory',hist);
  renderCashHistory();
  logShift(currentNow(),isOut?'ИЗЪЯТИЕ':'ВНЕСЕНИЕ',''+currentMgrName,(isOut?'Изъятие':'Внесение')+' '+sum+' ₽ с '+pos);
  showMsg((isOut?'Изъятие':'Внесение')+' оформлено','<p>Операция на сумму <strong>'+sum+' ₽</strong> с '+pos+' проведена.</p>');
  document.getElementById(pinId).value='';
  document.getElementById(sumId).value='';
}
function renderCashHistory() {
  const hist=LS.get('cashHistory')||[];
  const tb=document.getElementById('cashHistTable');
  if(!tb) return;
  tb.innerHTML='<tr><th>№</th><th>Дата/Время</th><th>Терм.</th><th>Тип</th><th class="num">Сумма &#8381;</th><th>Менеджер</th><th>Примечание</th></tr>'+hist.map(h=>`<tr><td>${h.id}</td><td>${h.dt}</td><td>${h.pos}</td><td>${h.type}</td><td class="num">${h.sum.toLocaleString()}</td><td>${h.mgr}</td><td>${h.note}</td></tr>`).join('');
}
function openCashModal(type) { nav('cash'); setTimeout(()=>{ const tab=document.getElementById('csh2'); const parent=tab.parentElement.previousElementSibling; parent.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); parent.querySelectorAll('.tab')[1].classList.add('active'); document.querySelectorAll('#sec-cash .tabContent').forEach(c=>c.classList.remove('active')); tab.classList.add('active'); },50); }

// ===================================================================
//  EXPENSES
// ===================================================================
function saveExpense() {
  const date=document.getElementById('expDate').value;
  const cat=document.getElementById('expCat').value;
  const desc=document.getElementById('expDesc').value.trim();
  const sum=document.getElementById('expSum').value.trim();
  const doc2=document.getElementById('expDoc').value.trim();
  const note=document.getElementById('expNote').value.trim();
  if(!desc||!sum){showMsg('Заполните обязательные поля');return;}
  const exps=LS.get('expenses')||[];
  const code='EXP-'+(4820+exps.length+1);
  exps.unshift({date,code,desc,cat,sum:parseInt(sum),doc:doc2,status:'На согласов.',note});
  LS.set('expenses',exps);
  showMsg('Расход сохранён','<p>Расход <strong>'+desc+'</strong> на сумму '+sum+' ₽ записан со статусом "На согласовании".</p>');
  clearExpForm();
}
function clearExpForm(){['expDate','expDesc','expSum','expDoc','expNote'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=id==='expDate'?'27.02.2026':'';})}

// ===================================================================
//  SHIFT LOG
// ===================================================================
function logShift(time, event, user, desc) {
  const sl=LS.get('shiftLog')||[];
  sl.unshift({time,event,user,desc});
  LS.set('shiftLog',sl);
  renderShiftLog();
}
function renderShiftLog() {
  const sl=LS.get('shiftLog')||[];
  const tb=document.getElementById('shiftLog');
  if(!tb) return;
  tb.innerHTML='<tr><th>Время</th><th>Событие</th><th>Пользователь</th><th>Описание</th></tr>'+sl.map(e=>`<tr><td>${e.time}</td><td>${e.event}</td><td>${e.user}</td><td>${e.desc}</td></tr>`).join('');
}
function transferShift() {
  showMsg('Передача смены','<div><div class="formRow"><label style="min-width:120px;">ID нового менеджера:</label><input class="formInput" type="text" id="newMgrId" style="width:100px;"></div><div class="formRow"><label style="min-width:120px;">PIN нового менеджера:</label><input class="formInput" type="password" id="newMgrPin" maxlength="4" style="width:70px;"></div><div class="formRow"><label style="min-width:120px;">Примечание:</label><input class="formInput" type="text" id="transferNote" style="width:200px;"></div></div>','<button class="dlgBtn dlgBtnRed" onclick="confirmTransfer()">Передать</button><button class="dlgBtn" onclick="closeDlg()">Отмена</button>');
}
function confirmTransfer() {
  const newId=document.getElementById('newMgrId').value.trim();
  const newPin=document.getElementById('newMgrPin').value;
  const mgr=MANAGERS[newId];
  if(!mgr||newPin!==mgr.pin){showMsg('Неверные данные нового менеджера');return;}
  logShift(currentNow(),'ПЕРЕДАЧА СМЕНЫ',''+currentMgrName,'Смена передана: '+mgr.short);
  closeDlg();
  showMsg('Смена передана','<p>Смена #0847 передана менеджеру <strong>'+mgr.name+'</strong>.</p>');
}
function emergencyCloseShift() {
  showMsg('!! ЭКСТРЕННОЕ ЗАКРЫТИЕ СМЕНЫ','<p class="red bold">ВНИМАНИЕ! Это действие немедленно закроет смену без формирования полных отчётов.</p><p>Используйте только в случае чрезвычайных обстоятельств.</p><div class="formRow" style="margin-top:8px;"><label style="min-width:100px;">PIN менеджера:</label><input class="formInput" type="password" id="emgClosePIN" maxlength="4" style="width:70px;"></div><div class="formRow"><label style="min-width:100px;">Причина:</label><input class="formInput" type="text" id="emgCloseReason" style="width:220px;"></div>','<button class="dlgBtn dlgBtnRed" onclick="doEmergencyClose()">ЗАКРЫТЬ ЭКСТРЕННО</button><button class="dlgBtn" onclick="closeDlg()">Отмена</button>');
}
function doEmergencyClose() {
  const pin=document.getElementById('emgClosePIN').value;
  const reason=document.getElementById('emgCloseReason').value.trim();
  const mgr=MANAGERS[currentMgrId];
  if(!mgr||pin!==mgr.pin){showMsg('Неверный PIN');return;}
  if(!reason){showMsg('Укажите причину');return;}
  logShift(currentNow(),'!! ЭКСТРЕННОЕ ЗАКРЫТИЕ',''+currentMgrName,'Причина: '+reason);
  closeDlg();
  showMsg('Смена экстренно закрыта','<p>Смена #0847 экстренно закрыта в '+currentNow()+'.<br>Причина: <strong>'+reason+'</strong>.<br><br>Сформированы: Z-отчёт (упрощённый), акт экстренного закрытия.<br>Уведомление отправлено в ЦО и управляющему.</p>');
}
function printZReport() {
  logShift(currentNow(),'Z-ОТЧЁТ',''+currentMgrName,'Z-отчёт сформирован и распечатан');
  showMsg('Z-отчёт','<p>Z-отчёт за смену #0847 сформирован и отправлен на принтер.</p><pre style="font-size:9px;font-family:Courier New;border:1px solid #808080;padding:6px;margin-top:6px;background:#fff;">==== Z-ОТЧЁТ ====\nПБО 23702 | 27.02.2026\nСмена #0847\n-----------------\nВыручка НАЛ:  47820 р\nВыручка БНАЛ:135600 р\nИТОГО:       183420 р\nЧеков: 429\nСр. чек: 427.55 р\nВозвраты: 2 (-250 р)\n-----------------\nНДС 20%:  30570 р\n=================</pre>');
}

// ===================================================================
//  EMERGENCY
// ===================================================================
function submitEmergency() {
  const type=document.getElementById('emgType').value;
  const place=document.getElementById('emgPlace').value;
  const sev=document.getElementById('emgSeverity').value;
  const desc=document.getElementById('emgDesc').value.trim();
  const actions=document.getElementById('emgActions').value.trim();
  const pin=document.getElementById('emgPin').value;
  const mgr=MANAGERS[currentMgrId];
  if(!desc){showMsg('Введите описание ситуации');return;}
  if(!mgr||pin!==mgr.pin){showMsg('Неверный PIN менеджера');return;}
  const services=[];
  if(document.getElementById('emgFireDept').checked) services.push('Пожарные');
  if(document.getElementById('emgMedics').checked) services.push('Скорая');
  if(document.getElementById('emgPolice').checked) services.push('Полиция');
  if(document.getElementById('emgRosgvardiya').checked) services.push('Росгвардия');
  const emgs=LS.get('emergencies')||[];
  const id=emgs.length+1;
  const entry={id,time:currentNow(),type,place,sev,desc,actions,services:services.join(', ')||'—',mgr:currentMgrName,status:'open'};
  emgs.unshift(entry);
  LS.set('emergencies',emgs);
  document.getElementById('emergBadge').style.display='';
  document.getElementById('btmEmg').textContent=emgs.filter(e=>e.status==='open').length;
  document.getElementById('emgCount').textContent='Активных: '+emgs.filter(e=>e.status==='open').length;
  logShift(entry.time,'!! ЭКСТРЕННАЯ СИТУАЦИЯ',''+currentMgrName,type+' — '+place+' ('+sev+')');
  renderEmergencyList();
  clearEmgForm();
  showMsg('Ситуация зафиксирована','<p>Экстренная ситуация #'+id+' зафиксирована в '+entry.time+'.<br>Тип: <strong>'+type+'</strong><br>Место: '+place+'<br>Уровень: '+sev+(services.length?'<br>Вызваны: '+services.join(', '):'')+'</p>');
}
function clearEmgForm() {
  ['emgDesc','emgActions','emgPin'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
  ['emgFireDept','emgMedics','emgPolice','emgRosgvardiya'].forEach(id=>{const el=document.getElementById(id);if(el)el.checked=false;});
}
function renderEmergencyList() {
  const emgs=LS.get('emergencies')||[];
  const tf=(document.getElementById('emgTypeFilter')||{}).value||'';
  const sf=(document.getElementById('emgStatusFilter')||{}).value||'';
  let data=emgs;
  if(tf) data=data.filter(e=>e.type.toLowerCase().includes(tf)||e.type===tf);
  if(sf) data=data.filter(e=>e.status===sf);
  const sevColors={low:'green',medium:'orange',high:'red',critical:'red bold'};
  const sevNames={low:'Низкий',medium:'Средний',high:'Высокий',critical:'КРИТИЧЕСКИЙ'};
  const rows=data.map(e=>`<tr><td>${e.time}</td><td>${e.type}</td><td>${e.place}</td><td>${e.desc.slice(0,50)}${e.desc.length>50?'...':''}</td><td>${e.mgr}</td><td>${e.status==='open'?'<span class="esOpen">ОТКРЫТА</span>':'<span class="esClosed">ЗАКРЫТА</span>'}</td><td><button class="toolBtn" onclick="viewEmg(${e.id})">Открыть</button>${e.status==='open'?` <button class="toolBtn" onclick="closeEmg(${e.id})">Закрыть</button>`:''}</td></tr>`).join('');
  const lb=document.getElementById('emgListBody');
  if(lb) lb.innerHTML='<table class="dataTable"><tr><th>Время</th><th>Тип</th><th>Место</th><th>Описание</th><th>Менеджер</th><th>Статус</th><th>Действие</th></tr>'+rows+'</table>';
  const cnt=emgs.filter(e=>e.status==='open').length;
  const ec=document.getElementById('emgCount');
  if(ec) ec.textContent='Активных: '+cnt;
  const btmE=document.getElementById('btmEmg');
  if(btmE) btmE.textContent=cnt;
}
function viewEmg(id) {
  const emgs=LS.get('emergencies')||[];
  const e=emgs.find(x=>x.id===id);
  if(!e) return;
  showMsg('Экстренная ситуация #'+id,'<table style="font-size:10px;width:100%;"><tr><td><strong>Время:</strong></td><td>'+e.time+'</td></tr><tr><td><strong>Тип:</strong></td><td>'+e.type+'</td></tr><tr><td><strong>Место:</strong></td><td>'+e.place+'</td></tr><tr><td><strong>Уровень:</strong></td><td>'+e.sev+'</td></tr><tr><td><strong>Описание:</strong></td><td>'+e.desc+'</td></tr><tr><td><strong>Меры:</strong></td><td>'+e.actions+'</td></tr><tr><td><strong>Вызваны:</strong></td><td>'+e.services+'</td></tr><tr><td><strong>Менеджер:</strong></td><td>'+e.mgr+'</td></tr><tr><td><strong>Статус:</strong></td><td>'+(e.status==='open'?'ОТКРЫТА':'ЗАКРЫТА')+'</td></tr></table>');
}
function closeEmg(id) {
  const emgs=LS.get('emergencies')||[];
  const idx=emgs.findIndex(x=>x.id===id);
  if(idx>=0){emgs[idx].status='closed';LS.set('emergencies',emgs);}
  logShift(currentNow(),'СИТУАЦИЯ ЗАКРЫТА',''+currentMgrName,'#'+id);
  renderEmergencyList();
  const cnt=emgs.filter(e=>e.status==='open').length;
  if(cnt===0) document.getElementById('emergBadge').style.display='none';
  showMsg('Ситуация #'+id+' закрыта');
}

// ===================================================================
//  ORDERS
// ===================================================================
let newOrderItems = [];
function addOrderItem() {
  const v=document.getElementById('ordProdSel').value.split('|');
  const qty=document.getElementById('ordQty').value.trim();
  if(!qty){showMsg('Укажите количество');return;}
  newOrderItems.push({name:v[0],unit:v[1],qty});
  renderOrderItems();
}
function renderOrderItems() {
  const tb=document.getElementById('newOrderTable');
  if(!tb) return;
  tb.innerHTML='<tr><th>Позиция</th><th>Ед.</th><th class="num">Кол-во</th><th>Удалить</th></tr>'+newOrderItems.map((item,i)=>`<tr><td>${item.name}</td><td>${item.unit}</td><td class="num">${item.qty}</td><td><button class="toolBtn" onclick="removeOrderItem(${i})">X</button></td></tr>`).join('');
}
function removeOrderItem(i){newOrderItems.splice(i,1);renderOrderItems();}
function submitOrder() {
  if(!newOrderItems.length){showMsg('Добавьте позиции');return;}
  const n='З-'+(1145+Math.floor(Math.random()*10));
  logShift(currentNow(),'ЗАЯВКА',''+currentMgrName,'Заявка '+n+', '+newOrderItems.length+' позиций');
  showMsg('Заявка отправлена','<p>Заявка <strong>'+n+'</strong> на '+newOrderItems.length+' позиций отправлена поставщику.</p>');
  newOrderItems=[]; renderOrderItems();
}

// ===================================================================
//  STOP LIST
// ===================================================================
function addStopItem() {
  const sel=document.getElementById('stopMenuSel');
  const reason=document.getElementById('stopReason').value.trim();
  if(!reason){showMsg('Укажите причину');return;}
  const sl=LS.get('stopList')||[];
  const code=sel.value, name=sel.options[sel.selectedIndex].text;
  sl.unshift({code,name,reason,time:currentNow(),mgr:currentMgrName});
  LS.set('stopList',sl);
  renderStopList();
  logShift(currentNow(),'СТОП-ЛИСТ',''+currentMgrName,name+': '+reason);
  showMsg('Добавлено в стоп-лист','<p>Позиция <strong>'+name+'</strong> добавлена в стоп-лист.<br>Недоступна на всех активных POS.</p>');
  document.getElementById('stopReason').value='';
}
function renderStopList() {
  const sl=LS.get('stopList')||[];
  const tb=document.getElementById('stopTable');
  if(!tb) return;
  tb.innerHTML='<tr><th>Код</th><th>Позиция</th><th>Причина</th><th>Добавлено</th><th>Менеджер</th><th>Действие</th></tr>'+sl.map((s,i)=>`<tr><td>${s.code}</td><td>${s.name}</td><td>${s.reason}</td><td>${s.time}</td><td>${s.mgr}</td><td><button class="toolBtn" onclick="removeStopItem(${i})">Убрать</button></td></tr>`).join('');
}
function removeStopItem(i) { const sl=LS.get('stopList')||[]; sl.splice(i,1); LS.set('stopList',sl); renderStopList(); showMsg('Позиция убрана из стоп-листа'); }

// ===================================================================
//  DOCUMENTS
// ===================================================================
function saveDocument() {
  const type=document.getElementById('docType').value;
  const name=document.getElementById('docName').value.trim();
  const resp=document.getElementById('docResp').value;
  const date=document.getElementById('docDate').value;
  const content=document.getElementById('docContent').value.trim();
  if(!name){showMsg('Введите наименование документа');return;}
  const docs=LS.get('documents')||[];
  const n='ДОК-'+String(docs.length+1001).padStart(4,'0');
  docs.unshift({n,date,type,name,resp,content,status:'Создан'});
  LS.set('documents',docs);
  logShift(currentNow(),'ДОКУМЕНТ',''+currentMgrName,'Создан: '+n+' '+name);
  showMsg('Документ создан','<p>Документ <strong>'+n+'</strong> «'+name+'» создан и сохранён.</p>');
  ['docName','docContent'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
}

// ===================================================================
//  FULL MENU DATA
// ===================================================================
const FULL_MENU = [
  // БУРГЕРЫ
  {code:'B001',name:'Гамбургер',cat:'Бургеры',price:55},
  {code:'B002',name:'Чизбургер',cat:'Бургеры',price:65},
  {code:'B003',name:'Биг Хит',cat:'Бургеры',price:201},
  {code:'B004',name:'Двойной Биг Хит',cat:'Бургеры',price:285},
  {code:'B005',name:'Биг Хит Бекон',cat:'Бургеры',price:279},
  {code:'B006',name:'Биг Спешиал',cat:'Бургеры',price:399},
  {code:'B007',name:'Биг Спешиал Перец гриль',cat:'Бургеры',price:419},
  {code:'B008',name:'Двойной Биг Спешиал',cat:'Бургеры',price:549},
  {code:'B009',name:'Биг Спешиал Три Сыра',cat:'Бургеры',price:439},
  {code:'B010',name:'Гранд',cat:'Бургеры',price:249},
  {code:'B011',name:'Гранд Чипотл',cat:'Бургеры',price:289},
  {code:'B012',name:'Гранд Де Люкс Чипотл',cat:'Бургеры',price:295},
  {code:'B013',name:'Чикен Хит Пекинский барбекю',cat:'Бургеры',price:199},
  {code:'B014',name:'Чикен Премьер Пекинский барбекю',cat:'Бургеры',price:239},
  // КАРТОФЕЛЬ И СТАРТЕРЫ
  {code:'F001',name:'Картофель фри (средний)',cat:'Картофель и стартеры',price:75},
  {code:'F002',name:'Картофель фри (большой)',cat:'Картофель и стартеры',price:89},
  {code:'F003',name:'Картофель фри (двойной)',cat:'Картофель и стартеры',price:179},
  {code:'F004',name:'Картофель фри Сметана и лук',cat:'Картофель и стартеры',price:129},
  {code:'F005',name:'Картофель по-деревенски Сметана и лук',cat:'Картофель и стартеры',price:139},
  {code:'F006',name:'Наггетсы (4 шт)',cat:'Картофель и стартеры',price:59},
  {code:'F007',name:'Наггетсы (6 шт)',cat:'Картофель и стартеры',price:85},
  {code:'F008',name:'Наггетсы (9 шт)',cat:'Картофель и стартеры',price:125},
  {code:'F009',name:'Куриные крылышки (6 шт)',cat:'Картофель и стартеры',price:199},
  {code:'F010',name:'Куриные крылышки (9 шт)',cat:'Картофель и стартеры',price:279},
  {code:'F011',name:'Снэк Бокс с крыльями',cat:'Картофель и стартеры',price:289},
  {code:'F012',name:'Большой Снэк Бокс с Крыльями',cat:'Картофель и стартеры',price:399},
  {code:'F013',name:'Большой Снэк Бокс со Стрипсами',cat:'Картофель и стартеры',price:379},
  {code:'F014',name:'Мега Бокс',cat:'Картофель и стартеры',price:599},
  // РОЛЛЫ И САЛАТЫ
  {code:'R001',name:'Биг Спешиал ролл Перец гриль',cat:'Роллы и салаты',price:329},
  {code:'R002',name:'Биг Спешиал ролл Чураско',cat:'Роллы и салаты',price:339},
  {code:'R003',name:'Биг Спешиал Демиглас Ролл',cat:'Роллы и салаты',price:349},
  {code:'R004',name:'Цезарь Ролл',cat:'Роллы и салаты',price:289},
  {code:'R005',name:'Цезарь Ролл с беконом',cat:'Роллы и салаты',price:319},
  {code:'R006',name:'Фреш Ролл',cat:'Роллы и салаты',price:269},
  {code:'R007',name:'Шримп Ролл',cat:'Роллы и салаты',price:299},
  {code:'R008',name:'Салат Цезарь (стандарт)',cat:'Роллы и салаты',price:219},
  {code:'R009',name:'Салат Цезарь с креветками',cat:'Роллы и салаты',price:299},
  {code:'R010',name:'Овощной салат',cat:'Роллы и салаты',price:89},
  // ЗАВТРАКИ
  {code:'Z001',name:'Тост с сыром',cat:'Завтраки',price:71},
  {code:'Z002',name:'Тост с ветчиной',cat:'Завтраки',price:91},
  {code:'Z003',name:'Маффин с яйцом и сыром',cat:'Завтраки',price:122},
  {code:'Z004',name:'Маффин со свиной котлетой',cat:'Завтраки',price:105},
  {code:'Z005',name:'Картофельный оладушек (3 шт)',cat:'Завтраки',price:55},
  {code:'Z006',name:'Большой завтрак',cat:'Завтраки',price:269},
  // ДЕСЕРТЫ И ВЫПЕЧКА
  {code:'D001',name:'Вишневый пирожок',cat:'Десерты и выпечка',price:89},
  {code:'D002',name:'Пирожок Черная смородина',cat:'Десерты и выпечка',price:89},
  {code:'D003',name:'Пирожок Пряное яблоко',cat:'Десерты и выпечка',price:89},
  {code:'D004',name:'Пирожок Норвежские ягоды',cat:'Десерты и выпечка',price:99},
  {code:'D005',name:'Пирожок Манго-кремчиз',cat:'Десерты и выпечка',price:99},
  {code:'D006',name:'Пирожок Клубника-малина',cat:'Десерты и выпечка',price:99},
  {code:'D007',name:'Печенье Малина-белый шоколад',cat:'Десерты и выпечка',price:129},
  {code:'D008',name:'Клубничный чизкейк',cat:'Десерты и выпечка',price:199},
  {code:'D009',name:'Эклер Апельсиновый Чебурашка',cat:'Десерты и выпечка',price:149},
  {code:'D010',name:'Макарони Матча-кокос с иероглифом',cat:'Десерты и выпечка',price:159},
  {code:'D011',name:'Мороженое ванильное (стаканчик)',cat:'Десерты и выпечка',price:49},
  {code:'D012',name:'Вафельный рожок',cat:'Десерты и выпечка',price:39},
  {code:'D013',name:'Мороженое Карамельное (стаканчик)',cat:'Десерты и выпечка',price:59},
  {code:'D014',name:'Мороженое Шоколадное (стаканчик)',cat:'Десерты и выпечка',price:59},
  {code:'D015',name:'Мороженое Клубничное (стаканчик)',cat:'Десерты и выпечка',price:59},
  {code:'D016',name:'Мороженое Черничное (стаканчик)',cat:'Десерты и выпечка',price:69},
  {code:'D017',name:'Айс Де Люкс (маленький)',cat:'Десерты и выпечка',price:99},
  {code:'D018',name:'Айс Де Люкс (большой)',cat:'Десерты и выпечка',price:149},
  // НАПИТКИ ХОЛОДНЫЕ
  {code:'N001',name:'Кока-Кола (маленькая)',cat:'Напитки холодные',price:69},
  {code:'N002',name:'Кока-Кола (средняя)',cat:'Напитки холодные',price:89},
  {code:'N003',name:'Кока-Кола (большая)',cat:'Напитки холодные',price:119},
  {code:'N004',name:'Фанта (маленькая)',cat:'Напитки холодные',price:69},
  {code:'N005',name:'Фанта (средняя)',cat:'Напитки холодные',price:89},
  {code:'N006',name:'Фанта (большая)',cat:'Напитки холодные',price:119},
  {code:'N007',name:'Липтон Айс Ти (средний)',cat:'Напитки холодные',price:89},
  {code:'N008',name:'Липтон Айс Ти (большой)',cat:'Напитки холодные',price:119},
  {code:'N009',name:'Апельсиновый сок',cat:'Напитки холодные',price:119},
  {code:'N010',name:'Лимонад Капри',cat:'Напитки холодные',price:129},
  {code:'N011',name:'Пунш Смородина-малина',cat:'Напитки холодные',price:139},
  {code:'N012',name:'Пунш Брусника-можжевельник',cat:'Напитки холодные',price:139},
  {code:'N013',name:'Пунш Апельсин-спелые ягоды',cat:'Напитки холодные',price:139},
  {code:'N014',name:'Бабл Айс Кофе Красный дракон',cat:'Напитки холодные',price:199},
  // НАПИТКИ ГОРЯЧИЕ
  {code:'H001',name:'Капучино (маленький)',cat:'Напитки горячие',price:69},
  {code:'H002',name:'Капучино (средний)',cat:'Напитки горячие',price:109},
  {code:'H003',name:'Капучино (большой)',cat:'Напитки горячие',price:129},
  {code:'H004',name:'Капучино Красный дракон',cat:'Напитки горячие',price:165},
  {code:'H005',name:'Латте (маленький)',cat:'Напитки горячие',price:79},
  {code:'H006',name:'Латте (средний)',cat:'Напитки горячие',price:119},
  {code:'H007',name:'Латте (большой)',cat:'Напитки горячие',price:139},
  {code:'H008',name:'Латте Красный дракон',cat:'Напитки горячие',price:175},
  {code:'H009',name:'Латте с сиропом Печенье с орехами',cat:'Напитки горячие',price:149},
  {code:'H010',name:'Апельсиновый Раф',cat:'Напитки горячие',price:189},
  {code:'H011',name:'Айс Кофе Карамель',cat:'Напитки горячие',price:155},
  {code:'H012',name:'Эспрессо-тоник',cat:'Напитки горячие',price:129},
  {code:'H013',name:'Айс Какао',cat:'Напитки горячие',price:149},
  {code:'H014',name:'Какао (средний)',cat:'Напитки горячие',price:99},
  {code:'H015',name:'Какао (большой)',cat:'Напитки горячие',price:119},
  {code:'H016',name:'Чай (черный/зеленый)',cat:'Напитки горячие',price:59},
  // СОУСЫ
  {code:'S001',name:'Соус Йогуртовый с огурчиками',cat:'Соусы',price:35},
  {code:'S002',name:'Соус Сырный',cat:'Соусы',price:35},
  {code:'S003',name:'Соус Кисло-Сладкий',cat:'Соусы',price:35},
  {code:'S004',name:'Соус Терияки',cat:'Соусы',price:35},
  {code:'S005',name:'Соус «1000 Островов»',cat:'Соусы',price:35},
  {code:'S006',name:'Соус Чесночный',cat:'Соусы',price:35},
  {code:'S007',name:'Кетчуп',cat:'Соусы',price:25},
  {code:'S008',name:'Соус Барбекю',cat:'Соусы',price:35},
  {code:'S009',name:'Соус Пекинский барбекю',cat:'Соусы',price:45},
];

const COMBO_DETAILS = {
  'C-PR1': {
    name: 'Праздничное комбо — 595 ₽ (со стаканом-хамелеоном)',
    comp: 'Любой бургер из списка + Картофель фри (маленький) + Напиток (средний) + Коллекционный стакан-хамелеон',
    burgers: 'Биг Хит, Гранд, Гранд Де Люкс Чипотл, Чикен Хит Пекинский барбекю',
    price: '595 ₽',
    note: 'Стакан-хамелеон меняет цвет от температуры напитка. Коллекционный предмет.',
  },
  'C-PR2': {
    name: 'Праздничное комбо+ — 630 ₽ (со стаканом-хамелеоном)',
    comp: 'Любой бургер из списка + Картофель фри (маленький) + Напиток (средний) + Коллекционный стакан-хамелеон',
    burgers: 'Биг Спешиал, Двойной Чизбургер, Гранд Де Люкс Чипотл, Чикен Премьер (классический), Чикен Премьер Пекинский барбекю',
    price: '630 ₽',
    note: 'Стакан-хамелеон — коллекционный. Состав дороже за счёт более дорогих бургеров.',
  },
  'C-KD1': {
    name: 'Кидз Комбо — Cut the Rope (Ам Ням / Ам Няша)',
    comp: 'Детский набор + коллекционная игрушка из серии Cut the Rope',
    burgers: '—',
    price: 'Уточняется',
    note: 'Выход серии: с 6 января 2026. Персонажи: Ам Ням и Ам Няша.',
  },
  'C-KD2': {
    name: 'Кидз Комбо — Звездные лошадки и друзья',
    comp: 'Детский набор + игрушка из коллекции Звездные лошадки и друзья',
    burgers: '—',
    price: 'Уточняется',
    note: 'Выход серии: с 10 февраля 2026. Коллекция: лошадки Чоко, Зифи; пегасы Брут, Мими; единорог Эджи; ослик Бубу. Всего 6 игрушек.',
  },
  'C-KD3': {
    name: 'Кидз Комбо — Благотворительная коллекция (Зверята)',
    comp: 'Детский набор + держатель для фото в виде зверят',
    burgers: '—',
    price: 'Уточняется',
    note: 'Выход серии: с 10 марта 2026. Зверята: лягушонок, лисенок, волчонок, медвежонок. 15 ₽ с каждого набора направляется в благотворительный фонд «Семья вместе».',
  },
  'C-ZM1': {
    name: 'Зимнее Комбо — Новогодняя коллекция',
    comp: 'Бургер + Картофель фри + Напиток + Коллекционные новогодние носки',
    burgers: 'Биг Хит (самый популярный), а также другие бургеры по выбору',
    price: 'Уточняется',
    note: 'Новогодний сезон 2025–2026. Продано 388 000 наборов за праздники. Самое популярное: Зимнее Комбо с Биг Хит.',
  },
};

function renderFullMenuTable() {
  const catF = (document.getElementById('mnuCatFilter')||{}).value||'';
  const srch = ((document.getElementById('mnuSearch')||{}).value||'').toLowerCase();
  let data = FULL_MENU;
  if (catF) data = data.filter(i=>i.cat===catF);
  if (srch) data = data.filter(i=>i.name.toLowerCase().includes(srch)||i.code.toLowerCase().includes(srch));
  const tb = document.getElementById('fullMenuTable');
  if (!tb) return;
  tb.innerHTML = '<tr><th>Код</th><th>Наименование</th><th>Категория</th><th class="num">Цена &#8381;</th><th>Активна</th><th>Печать</th><th>Отображ.</th><th>Действие</th></tr>' +
    data.map(item=>`<tr class="menuItemRow"><td>${item.code}</td><td>${item.name}</td><td>${item.cat}</td><td><input class="formInput" type="text" value="${item.price}" style="width:55px;" id="price_${item.code}"></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><input type="checkbox" checked></td><td><button class="toolBtn" onclick="saveMenuItemPrice('${item.code}','${item.name}')">Сохр.</button></td></tr>`).join('');
}

function saveMenuItemPrice(code, name) {
  const inp = document.getElementById('price_'+code);
  const val = inp ? inp.value : '?';
  showMsg('Позиция сохранена', '<p>Позиция <strong>'+name+'</strong> ('+code+'): цена '+val+' ₽ обновлена.<br>Ожидает синхронизации с POS.</p>');
  logShift(currentNow(),'МЕНЮ',''+currentMgrName,'Изменена цена: '+name+' → '+val+' ₽');
}

function filterMenuTable() { renderFullMenuTable(); }

function renderPriceTable() {
  const srch = ((document.getElementById('priceSearch')||{}).value||'').toLowerCase();
  let data = FULL_MENU;
  if (srch) data = data.filter(i=>i.name.toLowerCase().includes(srch)||i.code.toLowerCase().includes(srch));
  const tb = document.getElementById('priceTable');
  if (!tb) return;
  tb.innerHTML = '<tr><th>Код</th><th>Наименование</th><th>Категория</th><th class="num">Текущая цена &#8381;</th><th class="num">Новая цена &#8381;</th><th>Дата изм.</th><th>Действие</th></tr>' +
    data.map(item=>`<tr><td>${item.code}</td><td>${item.name}</td><td>${item.cat}</td><td class="num">${item.price}</td><td><input class="formInput" type="text" value="${item.price}" style="width:60px;" id="np_${item.code}"></td><td><input class="formInput" type="text" value="27.02.26" style="width:75px;"></td><td><button class="toolBtn" onclick="applyPrice('${item.code}','${item.name}')">Применить</button></td></tr>`).join('');
}

function applyPrice(code, name) {
  const inp = document.getElementById('np_'+code);
  const val = inp ? inp.value : '?';
  showMsg('Цена обновлена', '<p><strong>'+name+'</strong> ('+code+'): новая цена '+val+' ₽.<br>Изменение ожидает синхронизации с ЦО и POS-терминалами.</p>');
  logShift(currentNow(),'ЦЕНА',''+currentMgrName,'Изменена цена: '+name+' → '+val+' ₽');
}

function filterPriceTable() { renderPriceTable(); }

function fillStopMenuSel() {
  const sel = document.getElementById('stopMenuSel');
  if (!sel) return;
  sel.innerHTML = FULL_MENU.map(i=>`<option value="${i.code}">${i.name} — ${i.price} ₽</option>`).join('');
}

function showComboDetail(code) {
  const c = COMBO_DETAILS[code];
  if (!c) return;
  showMsg(c.name,
    '<table style="font-size:10px;width:100%;"><tr><td style="padding:3px 0;vertical-align:top;width:110px;font-weight:bold;">Состав:</td><td>'+c.comp+'</td></tr>'+
    '<tr><td style="padding:3px 0;vertical-align:top;font-weight:bold;">Бургеры:</td><td>'+c.burgers+'</td></tr>'+
    '<tr><td style="padding:3px 0;font-weight:bold;">Цена:</td><td><strong>'+c.price+'</strong></td></tr>'+
    '<tr><td style="padding:3px 0;vertical-align:top;font-weight:bold;">Примечание:</td><td>'+c.note+'</td></tr></table>'
  );
}

function saveNewCombo() {
  const name = (document.getElementById('newComboName')||{}).value||'Новый набор';
  showMsg('Набор создан', '<p>Набор <strong>'+name+'</strong> создан и добавлен в список. Ожидает синхронизации с POS.</p>');
  closeDlg();
}

// Patch nav() to also render tables when switching to menu-settings
const _origNav = nav;
// ===================================================================
//  KEYBOARD
// ===================================================================
document.addEventListener('keydown', e=>{
  const overlay=document.getElementById('pinOverlay');
  if(overlay.style.display!=='none'){
    if(e.key>='0'&&e.key<='9') pinPress(e.key);
    if(e.key==='Backspace') pinBackspace();
    if(e.key==='Enter') pinConfirm();
    if(e.key==='Escape') pinCancel();
    return;
  }
  if(e.key==='F1'){e.preventDefault();showMsg('Справка HoReCaMGR','<p>HoReCaMGR v5.2.1 — Система управления рестораном<br>ПБО 23702<br><br>F2=POS | F3=Касса | F5=Обновить<br>F7=Поиск | F9=Экстренная | F10=Меню</p>');}
  if(e.key==='F2'){e.preventDefault();nav('pos');}
  if(e.key==='F3'){e.preventDefault();nav('cash');}
  if(e.key==='F5'){e.preventDefault();renderInvTable();renderSalesTable();showMsg('Данные обновлены');}
  if(e.key==='F9'){e.preventDefault();nav('emergency');swTab(document.querySelector('#sec-emergency .tabRow .tab:nth-child(2)'),'emg2');}
  if(e.key==='F10'){e.preventDefault(); const mi=document.getElementById('mi-file'); mi.classList.toggle('mopen');}
});
</script>
</body>
</html>
